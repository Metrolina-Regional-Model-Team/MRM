Page 1           Source Listing                                                                
2017-10-16 10:05                                 tgmet2015_171013.for

tgmet2015_171013.for(2314): remark #8290: Recommended relationship between field width 'W' and the number of fractional digits 'D...
     1      ' ','Dorm zone flag: ',f2.0/' ','GQ Factors: ',8f7.4/
------------------------------------^
tgmet2015_171013.for(1608): remark #8290: Recommended relationship between field width 'W' and the number of fractional digits 'D...
 9003   format(' TGMET Trace 9003: taz=',i5,' inc ratio= ',f5.3,
------------------------------------------------------------^

Page 2           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

tgmet2015_171013.for(3785): remark #8290: Recommended relationship between field width 'W' and the number of fractional digits 'D...
 6140     format(' ',4x,a10,4x,4(f5.3,6x),f6.3)
----------------------------------^
tgmet2015_171013.for(3634): remark #8290: Recommended relationship between field width 'W' and the number of fractional digits 'D...
 5810       format(' ',a4,4x,a4,10x,f10.0,13x,f10.0,8x,f6.4,3x,a4)
--------------------------------------------------------^

Page 3           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

      1 $FIXEDFORMLINESIZE: 132
      2 C TGMET2013.FOR
      3 C  Fortran source code to perform trip generation
      4 C   for the Metrolina Travel Model 2013
      5 C  Written previously for the Metrolina Travel Model 2004
      6 C  Written originally 14 Mar 1995 as TGMET1.FOR and TGMET2.FOR for
      7 C   the Dulles Model.  Revised 23 Jan 96 for the I-66 MIS and
      8 C   Washington Western Bypass studies.  Revised 28 Mar 96 for the
      9 C   Berks County Travel Model.
     10 
     11 C  April 2013                   bill allen
     12 
     13 C Developed originally in MS Fortran PowerStation 1.0.  Now being
     14 C  compiled in Compaq Visual Fortran 6.6 (Standard Edition 6.6a).
     15 C Check the following compiler settings:
     16 C  under tab "Fortran":
     17 C   General: Debugging Level=Full, Optimization Level=Full Optimization
     18 C   Compatibility: Libraries, Other Run-Time Behaviour
     19 C   Compilation Diagnostics: Undeclared Symbols, Uninitiated Variables
     20 C   Listing Files: Source Listing, Source Map
     21 C
     22 C Or, use the following switches:
     23 C  /check:bounds /compile_only /dbglibs /debug:full /fpscomp:general
     24 C  /list:"Debug/" /nologo /optimize:4 /traceback /warn:argument_checking
     25 C  /warn:declarations /warn:nofileopt /module:"Debug/" /object:"Debug/"
     26 C  /pdbfile:"Debug/DF60.PDB"
     27 
     28 c Program Limitations:
     29 c - max. number of internal zones:              5,000
     30 c - highest TAZ or ext station number:          30000 (MAXZONE)
     31 c - max. number of external stations:             200
     32 c - max. number of counties (as determined by first 2
     33 c    digits of 5-digit TAZ):                       15
     34 c - max. number of fields in zonal data file:     196
     35 c - max. record length of zonal data file:      2,048 bytes
     36 c - max. special generator zones:                  30
     37 c - max. zones in the CBD:                        100
     38 c - max. number of variables on the zonal S/E
     39 c    file:					   50
     40 
     41 C Modifications:
     42 c 10 Jun 05  Revise E/I model to use parabolic function
     43 c 14 Jun 05  Mod AT-based adjustment factors to shrink the cliffs
     44 c 16 Jun 05  Mod AT-based adjustment factors for hwy assignment
     45 c               calibration
     46 c 22 Aug 05  Add switches to turn off GQ trips and non-resident NHB
     47 c               trips (DO_GQ, DO_NONRES)
     48 c 25 Aug 05  Edit BASVOL and BTHRUV arrays to reflect updated cordon
     49 c		volume data; remove DISTCBDFILE (no longer used)
     50 c Changes for 2013 version:
     51 c            Change format of input S/E file.  Use flexible comma-
     52 c		delimited format instead of DBF.
     53 c	     Size/income seed now stratified by PUMA.
     54 c	     Life cycle calculation now split by Uptown vs. rest of
     55 c		region.
     56 
     57 C--------------------------------------------------------------------

Page 4           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

     58 c Purpose codes:
     59 c 1 HBW      8 NHBNWK         15 I/E MTrk
     60 c 2 SCH      9 COM            16 I/E HTrk
     61 c 3 HBU     10 Med Trk        17 E/I Work Auto
     62 c 4 HBS     11 Hvy Trk        18 E/I NonWk Auto
     63 c 5 HBO     12 I/E Work Auto  19 E/I COM
     64 c 6 NHBJTW  13 I/E Nonwk Auto 20 E/I MTrk
     65 c 7 NHBATW  14 I/E COM        21 E/I HTrk
     66 
     67       program TGMET
     68 
     69 C  Initialize.
     70 
     71       implicit none
     72 
     73       INTEGER*4 ZONES,NSTA
     74       REAL*8    PROD,ATTR
     75 
     76 c DUM_01 is a dummy variable needed in order to make the 
     77 c  memory allocation for the PROD and ATTR variables in COMMON
     78 c  be OK.  A stupid Fortran thing.
     79 
     80 	INTEGER*4 DUM_01
     81 
     82       common /dattim/ yr,mon,day,hr,min,sec,hun,
     83      +                month(12),title(10),page
     84 
     85       common /rept/ tjointWIL(4,4,3),tjointSIL(5,4,3),tlife(3),
     86      + twkr(4),tinc(4),tsize(5),repo(8),zones,
     87      + xxfact(4,200),xxfile,totiiattr(11,4),tprod(21,4),
     88      + totextprod(21),totextattr(21),statripends(5,200),
     89      + regtot(5),purcode(21),totiiprod(11,4),DUM_01,prod(21,4),
     90      + attr(21,4),ttrip(21,4),nsta,fthruv(4,200)
     91 
     92       common /zd/ z(31,5000),intzones,begtr
     93 
     94       integer*2 zz,x,p,w,v,s,s2,i,j,k,m,n,l,istop,iz,t,c,
     95      + fil(5),atype,stat1,intzones,wr,ir,lr,sr,
     96      + lind,hind,begtr,endtr,p4,p5,
     97      + specgenzone(30,11),hdiff,incr,nfld,
     98      + totfil,bu,strlth,maxzone,tazpuma(5000),pumano,
     99      + zTAZ,zPOP_TOT,zPOP_HHS,zPOP_GRP,zHH,zMED_INC,zLOIND,zHIIND,
    100      + zRTL,zHWY,zLOSVC,zHISVC,zOFFGOV,zEDUC,zEMP_TOT,zSTU_K8,zSTU_HS,
    101      + zSTU_CU,zDORM,zAREA
    102 
    103       real*4 z,tinc,rinc(4),basvol(4,200),gqfact(8,2),yrl,
    104      + spct(5),ipct(4),csum,diff,siseed(4,5,15),ripct(4),bthruv(4,200),
    105      + rtot(5),negfac,sneg,incrat,joint(5,4),isum,y1,y4,y5,
    106      + size(5),income(4),regtotwkr,regavginc,life(3),wsum,sum,
    107      + perhh,sizinc(5,4),sizinclif(5,4,3),newtotwkr,copct(16,5,4),
    108      + cdiff(4),share(4),newtot,incdist(4,37),regtot,wfact,
    109      + sizedist(5,30),ratio,low,high,range,ctot(4),cfac,u(4),eu(4),
    110      + avg5per,extpctw,extpctn,wratio(4),eipsn,buck,
    111      + empfactor,empadjust,wkrdist(4,3,4,5),oldwkrhh,newwkrhh,
    112      + arate(11,16),lifedist(3,4,5),oldwrk(4),bthrup(4,200),
    113      + prate(8,5,3,4),tothh,sizinclifwkr(5,4,3,4),igroup(4),
    114      + pr1(8,5,3,2),pr2(8,5,3,2),acoefas(5,10),newwrk(4),ztotwkr,

Page 5           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    115      + tprod,wkrinclif(4,4,3),extvol(5,200),extw,extn,
    116      + tattr3(11,4),atfacta(11,5),npct(4),nhbtot,hbtot,nrtot,nhbadj,
    117      + tjointWIL,tjointSIL,tsize,tlife,tempp,tempa,
    118      + twkr,ttrip,atfactp(8,5),totiiprod,zdat(50),
    119      + pfact(8,4),tfactor(11),totiiattr,ld(3,4,5),
    120      + avg3wkr,sumeu,fthruv,extpctc,extpctm,extpcth,
    121      + totextprod,totextattr,extprod(5,200),
    122      + extattr(5,200),xxfact,statripends,iewrkavo,ienwkavo,
    123      + eiwrkavo,einwkavo,hh,hhpop,totemp,lcfac(3,4),lcf,
    124      + stavol(4,200),totext(5),dummy(5),extadj(5,2),qq,
    125      + ploind,phiind,prtl,phwy,plosvc,peduc  
    126 
    127       real*8 sattr(11,2),tattr1(11),tattr2(11),factor
    128 
    129       integer*4 yr,mon,day,hr,min,sec,hun,page,itaz,yi,
    130      + intinc(4),tazzone(30000),cbd(100),szinlfwk(5,4,3,4),
    131      + specgenprod(30,11),specgenattr(30,11),ihh,jj,thh,
    132      + uptown(100)
    133 
    134       character*4 month,purcode,stitl(5)
    135       character*8 title,scard(10)
    136       character*16 verinfo,zname(50)
    137       character*80 list,names(5),control,pumafile,hhfile,
    138      + sefile,xvolfile,prodfile,attrfile,xxfile,distcorfile,
    139      + proddict,attrdict,xxdict,atfile
    140       logical repo,savescr,do_gq,do_nonres
    141 c      distcbdfile      
    142 
    143       namelist /files/ list,sefile,distcorfile,pumafile,hhfile,
    144      + xvolfile,xxfile,prodfile,attrfile,atfile
    145       namelist /parameters/ repo,begtr,endtr,
    146      +  empfactor,savescr,avg3wkr,avg5per,do_gq,do_nonres,
    147      +  tfactor,iewrkavo,ienwkavo,eiwrkavo,einwkavo,
    148      + zTAZ,zPOP_TOT,zPOP_HHS,zPOP_GRP,zHH,zMED_INC,zLOIND,zHIIND,
    149      + zRTL,zHWY,zLOSVC,zHISVC,zOFFGOV,zEDUC,zEMP_TOT,zSTU_K8,zSTU_HS,
    150      + zSTU_CU,zDORM,zAREA
    151      
    152       namelist /special/ specgenzone,specgenprod,specgenattr
    153       namelist /equiv/ cbd,uptown
    154       namelist /coeffs/ atfactp,atfacta,gqfact,acoefas,pfact,
    155      + extadj,prate,arate,siseed,basvol,bthruv
    156 
    157       equivalence (pr1,prate(1,1,1,1)),(pr2,prate(1,1,1,3))
    158 
    159 c Sources for some key parameters:
    160 c  - average persons/HH for 5+ persons/HH category: SizeModel.xls
    161 c  - average workers/HH for 3+ workers/HH category:
    162 c               TRACT_WORKERSHHSIZE.XLS
    163 c  - average auto occupancy for external auto trips:
    164 c               external station.xls
    165 
    166       data avg5per/5.54/,avg3wkr/3.255/,iewrkavo/1.182/,
    167      + ienwkavo/1.666/,eiwrkavo/1.172/,einwkavo/1.556/,totext/5*0.0/
    168 
    169       data repo/8*.true./,regtotwkr/0.0/,copct/320*0.0/,
    170      + tsize,twkr/9*0.0/,igroup/0.10,0.15,0.25,0.50/,dummy/5*0.0/,
    171      + page/1/,empfactor/0.8746/,tinc/4*0.0/,tattr3/44*0.0/,

Page 6           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    172      + tjointWIL/48*0.0/,tjointSIL/60*0.0/,statripends/1000*0.0/
    173       data z/155000*0.0/,tprod/84*0.0/,savescr/.false./,tlife/3*0.0/,
    174      + regtot/5*0.0/,stitl/'  1 ','  2 ','  3 ','  4 ','  5+'/
    175       data month/'Jan ','Feb ','Mar ','Apr ','May ','Jun ','Jul ',
    176      + 'Aug ','Sep ','Oct ','Nov ','Dec '/,tattr1,tattr2/22*0.0/,
    177      + purcode/'HBW ','SCH ','HBU ','HBS ','HBO ','JTW ','ATW ','NWK ',
    178      +         'COM ','MTK ','HTK ','IEW ','IEN ','IEC ','IEM ','IEH ',
    179      +         'EIW ','EIN ','EIC ','EIM ','EIH '/,
    180      + names/'zonal socioeconomic data                        ',
    181      +       'external station growth factors                 ',
    182      +       'zonal distance to cordon                        ',
    183      +       'zonal distance to CBD                           ',
    184      +       'TAZ/PUMA equivalency                            '/
    185      + prod/84*0.0/,attr/84*0.0/,nhbtot,hbtot/2*0.0/,
    186      + tfactor/11*1.0/,specgenzone/330*0/,maxzone/30000/,
    187      + specgenprod/330*0/,specgenattr/330*0/,
    188      + totiiprod/44*0.0/,totiiattr/44*0.0/,totextprod/21*0.0/,
    189      + totextattr/21*0.0/,do_gq,do_nonres/2*.true./
    190 
    191 C  'SISEED' array: regional base % of HH's by HH size, income
    192 C   group, and PUMA, from the 2005-09 ACS Public Use Microdata Sample
    193 C   (PUMS) files for Metrolina: (SizeIncomeSeed.xls).
    194 C   List of PUMAs (2000 Census)			
    195 C   1  370400 Cleveland, Rutherford, Polk, McDowell
    196 C   2  370901 SW Mecklenburg
    197 C   3  370902 NW Central Mecklenburg
    198 C   4  370903 NE Central Mecklenburg
    199 C   5  370904 E Mecklenburg
    200 C   6  370905 S Mecklenburg
    201 C   7  371000 N Mecklenburg
    202 C   8  371100 Gaston, Lincoln
    203 C   9  371200 Rowan
    204 C  10  371300 Cabarrus
    205 C  11  371400 Union
    206 C  12  371500 Iredell
    207 C  13  372500 Stanly, Montgomery, Anson
    208 C  14  450500 York (SC)
    209 C  15  451300 Lancaster, Chesterfield, Kershaw, Lee (SC)
    210 C   Dimensions: SISEED(income, size, PUMA)            DATA OK
    211 C            income:  1      2      3      4        PUMA  Size
    212       data siseed/0.092 , 0.089 , 0.066 , 0.031 ,  ! 1     1
    213      +            0.027 , 0.071 , 0.114 , 0.155 ,  ! 1     2
    214      +            0.015 , 0.016 , 0.043 , 0.081 ,  ! 1     3
    215      +            0.008 , 0.012 , 0.034 , 0.074 ,  ! 1     4
    216      +            0.008 , 0.008 , 0.021 , 0.035 ,  ! 1     5
    217 
    218      +            0.050 , 0.084 , 0.099 , 0.096 ,  ! 2     1
    219      +            0.018 , 0.040 , 0.079 , 0.193 ,  ! 2     2
    220      +            0.010 , 0.023 , 0.036 , 0.094 ,  ! 2     3
    221      +            0.010 , 0.017 , 0.035 , 0.050 ,  ! 2     4
    222      +            0.006 , 0.007 , 0.015 , 0.038 ,  ! 2     5
    223 
    224      +            0.062 , 0.079 , 0.101 , 0.042 ,  ! 3     1
    225      +            0.023 , 0.042 , 0.094 , 0.136 ,  ! 3     2
    226      +            0.010 , 0.032 , 0.053 , 0.082 ,  ! 3     3
    227      +            0.008 , 0.022 , 0.043 , 0.072 ,  ! 3     4
    228      +            0.006 , 0.016 , 0.031 , 0.046 ,  ! 3     5

Page 7           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    229 
    230      +            0.064 , 0.070 , 0.099 , 0.069 ,  ! 4     1
    231      +            0.018 , 0.032 , 0.083 , 0.184 ,  ! 4     2
    232      +            0.013 , 0.017 , 0.042 , 0.094 ,  ! 4     3
    233      +            0.005 , 0.007 , 0.023 , 0.082 ,  ! 4     4
    234      +            0.002 , 0.009 , 0.026 , 0.061 ,  ! 4     5
    235 
    236      +            0.084 , 0.082 , 0.126 , 0.114 ,  ! 5     1
    237      +            0.021 , 0.057 , 0.082 , 0.161 ,  ! 5     2
    238      +            0.008 , 0.022 , 0.038 , 0.069 ,  ! 5     3
    239      +            0.005 , 0.012 , 0.021 , 0.053 ,  ! 5     4
    240      +            0.002 , 0.008 , 0.012 , 0.023 ,  ! 5     5
    241 
    242      +            0.024 , 0.049 , 0.095 , 0.127 ,  ! 6     1
    243      +            0.007 , 0.015 , 0.051 , 0.282 ,  ! 6     2
    244      +            0.002 , 0.005 , 0.014 , 0.122 ,  ! 6     3
    245      +            0.000 , 0.006 , 0.007 , 0.128 ,  ! 6     4
    246      +            0.001 , 0.001 , 0.006 , 0.058 ,  ! 6     5
    247 
    248      +            0.029 , 0.044 , 0.079 , 0.095 ,  ! 7     1
    249      +            0.012 , 0.019 , 0.058 , 0.234 ,  ! 7     2
    250      +            0.007 , 0.009 , 0.029 , 0.133 ,  ! 7     3
    251      +            0.002 , 0.008 , 0.002 , 0.133 ,  ! 7     4
    252      +            0.002 , 0.004 , 0.010 , 0.073 ,  ! 7     5
    253 
    254      +            0.067 , 0.073 , 0.068 , 0.037 ,  ! 8     1
    255      +            0.022 , 0.056 , 0.097 , 0.185 ,  ! 8     2
    256      +            0.011 , 0.026 , 0.045 , 0.094 ,  ! 8     3
    257      +            0.007 , 0.012 , 0.034 , 0.092 ,  ! 8     4
    258      +            0.004 , 0.008 , 0.017 , 0.045 ,  ! 8     5
    259 
    260      +            0.063 , 0.081 , 0.066 , 0.040 ,  ! 9     1
    261      +            0.023 , 0.053 , 0.095 , 0.175 ,  ! 9     2
    262      +            0.014 , 0.020 , 0.042 , 0.108 ,  ! 9     3
    263      +            0.007 , 0.008 , 0.032 , 0.084 ,  ! 9     4
    264      +            0.006 , 0.009 , 0.021 , 0.053 ,  ! 9     5
    265 
    266      +            0.047 , 0.069 , 0.074 , 0.050 ,  !10     1
    267      +            0.017 , 0.035 , 0.081 , 0.199 ,  !10     2
    268      +            0.006 , 0.018 , 0.037 , 0.117 ,  !10     3
    269      +            0.003 , 0.007 , 0.029 , 0.118 ,  !10     4
    270      +            0.006 , 0.009 , 0.021 , 0.053 ,  !10     5
    271 
    272      +            0.038 , 0.037 , 0.054 , 0.040 ,  !11     1
    273      +            0.015 , 0.031 , 0.084 , 0.186 ,  !11     2
    274      +            0.009 , 0.010 , 0.040 , 0.135 ,  !11     3
    275      +            0.005 , 0.010 , 0.038 , 0.131 ,  !11     4
    276      +            0.007 , 0.010 , 0.027 , 0.093 ,  !11     5
    277 
    278      +            0.056 , 0.076 , 0.069 , 0.037 ,  !12     1
    279      +            0.025 , 0.048 , 0.101 , 0.186 ,  !12     2
    280      +            0.007 , 0.012 , 0.039 , 0.107 ,  !12     3
    281      +            0.005 , 0.014 , 0.023 , 0.110 ,  !12     4
    282      +            0.005 , 0.009 , 0.018 , 0.053 ,  !12     5
    283 
    284      +            0.089 , 0.077 , 0.075 , 0.025 ,  !13     1
    285      +            0.028 , 0.067 , 0.113 , 0.144 ,  !13     2

Page 8           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    286      +            0.015 , 0.021 , 0.050 , 0.085 ,  !13     3
    287      +            0.003 , 0.012 , 0.032 , 0.084 ,  !13     4
    288      +            0.005 , 0.014 , 0.020 , 0.041 ,  !13     5
    289 
    290      +            0.052 , 0.068 , 0.076 , 0.051 ,  !14     1
    291      +            0.018 , 0.041 , 0.093 , 0.203 ,  !14     2
    292      +            0.012 , 0.012 , 0.033 , 0.116 ,  !14     3
    293      +            0.005 , 0.012 , 0.030 , 0.102 ,  !14     4
    294      +            0.004 , 0.006 , 0.015 , 0.051 ,  !14     5
    295 
    296      +            0.093 , 0.081 , 0.056 , 0.036 ,  !15     1
    297      +            0.030 , 0.064 , 0.104 , 0.153 ,  !15     2
    298      +            0.016 , 0.020 , 0.048 , 0.081 ,  !15     3
    299      +            0.011 , 0.015 , 0.029 , 0.084 ,  !15     4
    300      +            0.006 , 0.013 , 0.018 , 0.042 /  !15     5
    301 
    302 C  'GQFACT' array: GQPOP trip production modification factor by purpose,
    303 C   depending on whether this zone has a college dormitory or not
    304 C   Dimensions: GQFACT(purpose,D), where D=1 if a dorm zone, 2 if not
    305 C       purpose:    HBW   SCH   HBU   HBS   HBO   JTW   ATW   NWK
    306       data gqfact /0.15, 0.00, 3.00, 1.00, 1.00, 0.10, 0.00, 0.50,
    307      +             0.00, 0.05, 0.25, 0.25, 0.25, 0.00, 0.00, 0.25/
    308 
    309 C  'WKRDIST' array: regional base distribution of HHs by HH size,
    310 C   income group, lifecycle, and no. of workers, from the
    311 C   2000 Census Public Use Microdata Sample (PUMS) files for
    312 C   Metrolina (XTABHH3.LIS).
    313 C   Dimensions: WKRDIST(workers, life cycle, income, size)
    314 C                                       DATA OK
    315 C         workers:      0       1       2       3+    Size Inc Life
    316       data wkrdist /1.000 , 0.000 , 0.000 , 0.000 ,   !  1   1   1
    317      +              0.621 , 0.379 , 0.000 , 0.000 ,   !  1   1   2
    318      +              0.598 , 0.402 , 0.000 , 0.000 ,   !  1   1   3
    319      +              1.000 , 0.000 , 0.000 , 0.000 ,   !  1   2   1
    320      +              0.230 , 0.770 , 0.000 , 0.000 ,   !  1   2   2
    321      +              0.170 , 0.830 , 0.000 , 0.000 ,   !  1   2   3
    322      +              1.000 , 0.000 , 0.000 , 0.000 ,   !  1   3   1
    323      +              0.745 , 0.255 , 0.000 , 0.000 ,   !  1   3   2
    324      +              0.097 , 0.903 , 0.000 , 0.000 ,   !  1   3   3
    325      +              1.000 , 0.000 , 0.000 , 0.000 ,   !  1   4   1
    326      +              0.100 , 0.900 , 0.000 , 0.000 ,   !  1   4   2
    327      +              0.081 , 0.919 , 0.000 , 0.000 ,   !  1   4   3
    328 
    329      +              0.871 , 0.129 , 0.000 , 0.000 ,   !  2   1   1
    330      +              0.503 , 0.472 , 0.025 , 0.000 ,   !  2   1   2
    331      +              0.480 , 0.365 , 0.155 , 0.000 ,   !  2   1   3
    332      +              0.848 , 0.152 , 0.000 , 0.000 ,   !  2   2   1
    333      +              0.169 , 0.772 , 0.059 , 0.000 ,   !  2   2   2
    334      +              0.241 , 0.500 , 0.259 , 0.000 ,   !  2   2   3
    335      +              0.642 , 0.358 , 0.000 , 0.000 ,   !  2   3   1
    336      +              0.070 , 0.800 , 0.130 , 0.000 ,   !  2   3   2
    337      +              0.087 , 0.390 , 0.523 , 0.000 ,   !  2   3   3
    338      +              0.581 , 0.419 , 0.000 , 0.000 ,   !  2   4   1
    339      +              0.039 , 0.781 , 0.180 , 0.000 ,   !  2   4   2
    340      +              0.036 , 0.205 , 0.759 , 0.000 ,   !  2   4   3
    341 
    342      +              0.734 , 0.266 , 0.000 , 0.000 ,   !  3   1   1

Page 9           Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    343      +              0.478 , 0.449 , 0.070 , 0.003 ,   !  3   1   2
    344      +              0.304 , 0.353 , 0.297 , 0.046 ,   !  3   1   3
    345      +              0.469 , 0.456 , 0.075 , 0.000 ,   !  3   2   1
    346      +              0.181 , 0.650 , 0.161 , 0.008 ,   !  3   2   2
    347      +              0.170 , 0.397 , 0.391 , 0.042 ,   !  3   2   3
    348      +              0.370 , 0.524 , 0.106 , 0.000 ,   !  3   3   1
    349      +              0.067 , 0.462 , 0.443 , 0.028 ,   !  3   3   2
    350      +              0.058 , 0.246 , 0.471 , 0.225 ,   !  3   3   3
    351      +              0.127 , 0.444 , 0.429 , 0.000 ,   !  3   4   1
    352      +              0.025 , 0.242 , 0.657 , 0.076 ,   !  3   4   2
    353      +              0.014 , 0.080 , 0.311 , 0.595 ,   !  3   4   3
    354 
    355      +              0.830 , 0.170 , 0.000 , 0.000 ,   !  4   1   1
    356      +              0.467 , 0.402 , 0.125 , 0.006 ,   !  4   1   2
    357      +              0.192 , 0.576 , 0.138 , 0.094 ,   !  4   1   3
    358      +              0.529 , 0.400 , 0.071 , 0.000 ,   !  4   2   1
    359      +              0.150 , 0.599 , 0.226 , 0.025 ,   !  4   2   2
    360      +              0.231 , 0.402 , 0.068 , 0.299 ,   !  4   2   3
    361      +              0.112 , 0.584 , 0.213 , 0.091 ,   !  4   3   1
    362      +              0.043 , 0.419 , 0.474 , 0.064 ,   !  4   3   2
    363      +              0.053 , 0.119 , 0.366 , 0.462 ,   !  4   3   3
    364      +              0.078 , 0.257 , 0.506 , 0.159 ,   !  4   4   1
    365      +              0.016 , 0.237 , 0.596 , 0.151 ,   !  4   4   2
    366      +              0.013 , 0.028 , 0.114 , 0.845 ,   !  4   4   3
    367 
    368      +              0.550 , 0.289 , 0.161 , 0.000 ,   !  5   1   1
    369      +              0.427 , 0.401 , 0.154 , 0.018 ,   !  5   1   2
    370      +              0.900 , 0.100 , 0.000 , 0.000 ,   !  5   1   3
    371      +              0.272 , 0.535 , 0.156 , 0.037 ,   !  5   2   1
    372      +              0.201 , 0.517 , 0.230 , 0.052 ,   !  5   2   2
    373      +              0.875 , 0.125 , 0.000 , 0.000 ,   !  5   2   3
    374      +              0.170 , 0.373 , 0.362 , 0.095 ,   !  5   3   1
    375      +              0.052 , 0.383 , 0.443 , 0.122 ,   !  5   3   2
    376      +              0.000 , 0.111 , 0.421 , 0.468 ,   !  5   3   3
    377      +              0.022 , 0.225 , 0.373 , 0.380 ,   !  5   4   1
    378      +              0.015 , 0.229 , 0.457 , 0.299 ,   !  5   4   2
    379      +              0.016 , 0.000 , 0.076 , 0.908 /   !  5   4   3
    380 
    381 C  'LIFEDIST' array: regional base distribution of HHs by HH size,
    382 C   income group, and life cycle, from the
    383 C   2000 Census Public Use Microdata Sample (PUMS) files for
    384 C   Metrolina (XTABHH3.LIS).
    385 C   Dimensions: LIFEDIST(life cycle, income, size)
    386 C                                       DATA OK
    387 C         life cycle:   1       2       3
    388 c                   Ret'd   Kids    No Ret or Kids    Size Inc
    389       data lifedist/0.538 , 0.000 , 0.462 ,           !  1   1
    390      +              0.370 , 0.000 , 0.630 ,           !  1   2
    391      +              0.134 , 0.000 , 0.866 ,           !  1   3
    392      +              0.127 , 0.000 , 0.873 ,           !  1   4
    393      +              0.329 , 0.317 , 0.354 ,           !  2   1
    394      +              0.435 , 0.191 , 0.374 ,           !  2   2
    395      +              0.308 , 0.133 , 0.559 ,           !  2   3
    396      +              0.143 , 0.026 , 0.831 ,           !  2   4
    397      +              0.063 , 0.863 , 0.074 ,           !  3   1
    398      +              0.144 , 0.760 , 0.096 ,           !  3   2
    399      +              0.120 , 0.738 , 0.142 ,           !  3   3

Page 10          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    400      +              0.089 , 0.653 , 0.258 ,           !  3   4
    401      +              0.048 , 0.898 , 0.054 ,           !  4   1
    402      +              0.056 , 0.919 , 0.025 ,           !  4   2
    403      +              0.042 , 0.923 , 0.035 ,           !  4   3
    404      +              0.034 , 0.897 , 0.069 ,           !  4   4
    405      +              0.040 , 0.960 , 0.000 ,           !  5   1
    406      +              0.051 , 0.939 , 0.010 ,           !  5   2
    407      +              0.070 , 0.913 , 0.017 ,           !  5   3
    408      +              0.077 , 0.890 , 0.033 /           !  5   4
    409 
    410 C  'SIZEDIST' array: regional base HH size model.
    411 C   (Derived from 2000 CTPP Table 1-62, SizeModel.xls).
    412 C   Dimensions: SIZEDIST(size, avg size index)
    413 C                                       DATA OK
    414 C           HH size:    1      2      3      4      5+
    415       data sizedist/100.00,  0.00,  0.00,  0.00,  0.00,  ! 1.0
    416      +               90.03,  9.97,  0.00,  0.00,  0.00,  ! 1.1
    417      +               81.14, 17.38,  1.44,  0.04,  0.00,  ! 1.2
    418      +               75.71, 19.57,  3.38,  1.34,  0.00,  ! 1.3
    419      +               70.30, 21.75,  5.31,  2.64,  0.00,  ! 1.4
    420      +               65.52, 23.66,  6.42,  4.03,  0.37,  ! 1.5
    421      +               60.74, 25.57,  7.52,  5.43,  0.74,  ! 1.6
    422      +               55.97, 27.48,  8.63,  6.82,  1.10,  ! 1.7
    423      +               51.35, 30.72,  9.08,  6.10,  2.75,  ! 1.8
    424      +               45.49, 34.55,  9.98,  6.25,  3.73,  ! 1.9
    425      +               40.89, 36.51, 10.70,  7.59,  4.31,  ! 2.0
    426      +               37.84, 35.46, 12.92,  8.94,  4.84,  ! 2.1
    427      +               34.90, 35.18, 13.88, 10.25,  5.79,  ! 2.2
    428      +               31.90, 34.65, 15.37, 11.54,  6.54,  ! 2.3
    429      +               28.37, 34.97, 16.50, 12.65,  7.51,  ! 2.4
    430      +               25.14, 34.31, 18.20, 14.26,  8.09,  ! 2.5
    431      +               21.78, 34.48, 19.21, 15.79,  8.74,  ! 2.6
    432      +               19.47, 33.65, 19.68, 17.28,  9.92,  ! 2.7
    433      +               16.84, 33.09, 20.18, 18.67, 11.22,  ! 2.8
    434      +               15.93, 29.33, 22.03, 20.48, 12.23,  ! 2.9
    435      +               14.08, 28.38, 21.82, 21.98, 13.74,  ! 3.0
    436      +               12.29, 27.94, 21.33, 23.11, 15.33,  ! 3.1
    437      +               11.21, 25.73, 20.78, 25.43, 16.85,  ! 3.2
    438      +                9.87, 23.83, 22.30, 25.00, 19.00,  ! 3.3
    439      +                8.64, 22.63, 22.47, 24.37, 21.89,  ! 3.4
    440      +                7.62, 19.41, 24.96, 24.14, 23.87,  ! 3.5
    441      +                6.60, 16.19, 27.46, 23.91, 25.84,  ! 3.6
    442      +                5.59, 12.97, 29.94, 23.69, 27.81,  ! 3.7
    443      +                4.57,  9.74, 32.45, 23.46, 29.78,  ! 3.8
    444      +                3.55,  6.52, 34.94, 23.23, 31.76/  ! 3.9
    445 
    446 C  'INCDIST' array: regional base HH income group model.
    447 C   (Derived from 2000 CTPP Tables 1-66, 1-90, IncomeModel.xls).
    448 C   Dimensions: INCDIST(income, mean income ratio index)
    449 C                                       DATA OK
    450 C   income group:       1      2      3      4         inc ratio
    451       data  incdist/ 66.00, 24.00, 10.00,  0.00,        ! 0.1
    452      +               56.00, 25.00, 15.00,  4.00,
    453      +               48.31, 25.40, 18.36,  7.93,
    454      +               38.49, 25.15, 21.50, 14.86,
    455      +               25.60, 26.91, 26.37, 21.12,        ! 0.5
    456      +               19.74, 24.25, 29.16, 26.85,

Page 11          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    457      +               13.14, 20.17, 30.15, 36.54,
    458      +               11.06, 17.22, 28.37, 43.35,
    459      +                9.19, 15.57, 27.00, 48.24,
    460      +                8.03, 13.13, 24.33, 54.51,        ! 1.0
    461      +                6.86, 10.22, 22.34, 60.58,
    462      +                5.82,  9.83, 21.53, 62.82,
    463      +                5.00,  8.18, 18.71, 68.11,
    464      +                4.72,  7.44, 17.13, 70.71,
    465      +                4.42,  7.41, 16.13, 72.04,        ! 1.5
    466      +                4.22,  7.00, 14.46, 74.32,
    467      +                3.90,  6.44, 14.47, 75.19,
    468      +                3.76,  5.87, 14.44, 75.93,
    469      +                3.65,  5.53, 14.29, 76.53,
    470      +                3.53,  5.19, 14.13, 77.15,        ! 2.0
    471      +                3.41,  4.84, 13.99, 77.76,
    472      +                3.02,  4.51, 13.79, 78.70,
    473      +                2.62,  4.17, 13.58, 79.63,
    474      +                2.47,  4.10, 13.19, 80.24,
    475      +                2.32,  4.03, 12.80, 80.85,        ! 2.5
    476      +                2.20,  3.99, 12.51, 81.30,
    477      +                2.08,  3.95, 12.22, 81.75,
    478      +                2.00,  3.97, 12.13, 81.91,
    479      +                1.92,  3.99, 12.03, 82.06,
    480      +                1.84,  3.99, 11.86, 82.32,        ! 3.0
    481      +                1.76,  3.98, 11.68, 82.58,
    482      +                1.41,  4.02, 11.63, 82.95,
    483      +                1.06,  4.05, 11.58, 83.32,
    484      +                0.70,  4.09, 11.52, 83.68,
    485      +                0.35,  4.12, 11.47, 84.05,        ! 3.5
    486      +                0.00,  4.16, 11.42, 84.42,
    487      +                0.00,  4.18, 11.32, 84.50/        ! 3.7
    488 
    489 C  'PRATE' array: production model total person trip rates per HH
    490 C   This is derived from the 2012 survey.
    491 C   Dimensions:
    492 C       PRATE(purpose, workers, lifecycle, income), for work-related
    493 C       PRATE(purpose, size,    lifecycle, income), for non-work-related
    494 C               (use "5" for the 2nd dimension, code as zeroes for
    495 C               "workers=4", which doesn't exist)
    496 C   Read the data into arrays PR1 and PR2 and equivalence them with
    497 C   PRATE.                              DATA OK (2012 survey)        
    498 c   PR1 is for incomes 1 and 2; PR2 is for incomes 3 and 4.
    499 C     purpose:   HBW    SCH    HBU    HBS    HBO    JTW    ATW    NWK  !wsli
    500       data pr1/0.000, 0.000, 0.000, 0.800, 1.189, 0.000, 0.000, 0.538, !0111
    501      +         1.429, 0.000, 0.000, 1.610, 2.905, 0.000, 0.000, 0.585, !1211
    502      +         2.200, 0.000, 0.033, 2.240, 2.341, 0.000, 0.000, 0.613, !2311
    503      +         3.549, 0.000, 0.000, 2.558, 3.501, 0.000, 0.000, 0.613, !3411
    504      +         0.000, 2.016, 0.000, 3.239, 4.060, 0.000, 0.000, 0.613, !-511
    505      +         0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, !0121
    506      +         1.449, 1.582, 0.000, 0.337, 1.504, 0.400, 0.190, 0.422, !1221
    507      +         2.550, 1.689, 0.157, 1.406, 3.800, 1.055, 0.190, 1.795, !2321
    508      +         4.502, 2.825, 0.131, 1.511, 5.400, 1.055, 0.190, 1.948, !3421
    509      +         0.000, 4.046, 0.275, 1.995, 6.150, 0.000, 0.000, 2.300, !-521
    510      +         0.000, 0.000, 0.009, 0.700, 1.200, 0.000, 0.000, 0.616, !0131
    511      +         1.358, 0.000, 0.021, 1.416, 2.200, 0.329, 0.157, 0.926, !1231
    512      +         2.462, 0.000, 0.204, 1.675, 2.715, 0.329, 0.157, 0.926, !2331
    513      +         4.800, 0.000, 0.208, 2.106, 3.419, 0.329, 0.157, 0.926, !3431

Page 12          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    514      +         0.000, 0.000, 0.000, 1.000, 0.981, 0.000, 0.000, 0.926, !-531
    515      +         0.000, 0.000, 0.000, 0.896, 1.300, 0.000, 0.000, 1.000, !0112
    516      +         1.429, 0.000, 0.012, 1.610, 2.905, 0.400, 0.000, 1.400, !1212
    517      +         2.200, 0.000, 0.033, 2.240, 3.800, 0.410, 0.000, 2.312, !2312
    518      +         3.549, 0.100, 0.000, 2.558, 3.800, 0.256, 0.000, 2.312, !3412
    519      +         0.000, 2.016, 0.000, 5.000, 5.000, 0.000, 0.000, 2.312, !-512
    520      +         0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, !0122
    521      +         1.449, 1.582, 0.000, 0.387, 1.504, 0.490, 0.190, 1.000, !1222
    522      +         2.550, 1.689, 0.157, 1.406, 4.523, 1.055, 0.190, 2.025, !2322
    523      +         4.502, 2.825, 0.131, 1.511, 5.855, 1.055, 0.190, 2.701, !3422
    524      +         0.000, 4.046, 0.275, 1.995, 7.000, 0.000, 0.000, 4.100, !-522
    525      +         0.000, 0.000, 0.009, 0.780, 1.237, 0.000, 0.000, 1.080, !0132
    526      +         1.358, 0.000, 0.021, 1.416, 2.411, 0.329, 0.157, 1.180, !1232
    527      +         2.462, 0.000, 0.204, 1.675, 3.410, 0.550, 0.157, 2.109, !2332
    528      +         4.800, 0.000, 0.208, 2.106, 3.419, 0.530, 0.157, 2.109, !3432
    529      +         0.000, 0.000, 0.000, 1.700, 0.981, 0.000, 0.000, 2.109/ !-532
    530       data pr2/0.000, 0.000, 0.000, 0.896, 1.300, 0.000, 0.000, 1.000, !0113
    531      +         1.429, 0.000, 0.012, 1.610, 2.905, 0.400, 0.142, 1.400, !1213
    532      +         3.146, 0.188, 0.033, 2.500, 3.800, 0.410, 0.142, 2.312, !2313
    533      +         3.549, 0.209, 0.000, 2.558, 3.800, 0.256, 0.247, 2.312, !3413
    534      +         0.000, 2.016, 0.000, 5.000, 5.062, 0.000, 0.000, 2.312, !-513
    535      +         0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, !0123
    536      +         1.449, 1.582, 0.000, 0.700, 1.504, 0.490, 0.300, 1.829, !1223
    537      +         2.586, 1.689, 0.157, 1.406, 4.523, 1.055, 0.350, 2.025, !2323
    538      +         4.502, 2.825, 0.131, 1.511, 5.855, 1.055, 0.482, 2.701, !3423
    539      +         0.000, 4.046, 0.322, 1.995, 7.000, 0.000, 0.000, 4.100, !-523
    540      +         0.000, 0.000, 0.009, 0.780, 1.237, 0.000, 0.000, 1.080, !0133
    541      +         1.455, 0.000, 0.021, 1.416, 2.411, 0.329, 0.157, 1.180, !1233
    542      +         2.958, 0.000, 0.204, 1.675, 3.410, 0.550, 0.281, 2.109, !2333
    543      +         5.100, 0.000, 0.376, 2.106, 3.419, 0.530, 0.500, 2.109, !3433
    544      +         0.000, 0.000, 0.461, 2.200, 0.981, 0.000, 0.000, 2.109, !-533
    545      +         0.000, 0.000, 0.000, 0.896, 2.251, 0.000, 0.000, 1.418, !0114
    546      +         1.429, 0.000, 0.012, 1.610, 2.963, 0.407, 0.142, 1.400, !1214
    547      +         3.146, 0.209, 0.276, 2.500, 4.000, 0.593, 1.000, 2.471, !2314
    548      +         3.549, 0.209, 0.084, 2.558, 4.000, 0.427, 1.231, 2.471, !3414
    549      +         0.000, 2.679, 0.008, 5.300, 5.062, 0.000, 0.000, 3.900, !-514
    550      +         0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, !0124
    551      +         1.449, 1.582, 0.000, 0.700, 2.886, 0.578, 0.300, 1.829, !1224
    552      +         2.586, 1.689, 0.044, 1.406, 4.536, 1.099, 0.400, 2.025, !2324
    553      +         4.502, 2.825, 0.131, 1.511, 6.788, 1.163, 0.482, 2.701, !3424
    554      +         0.000, 4.046, 0.322, 1.995, 8.486, 0.000, 0.000, 4.100, !-524
    555      +         0.000, 0.000, 0.003, 0.780, 1.842, 0.000, 0.000, 1.250, !0134
    556      +         1.455, 0.000, 0.011, 1.416, 2.487, 0.363, 0.300, 1.400, !1234
    557      +         2.958, 0.000, 0.314, 1.675, 3.504, 0.829, 0.480, 2.109, !2334
    558      +         5.100, 0.000, 0.376, 2.106, 4.007, 0.989, 0.680, 2.109, !3434
    559      +         0.000, 0.000, 0.858, 2.200, 5.145, 0.000, 0.000, 2.109/ !-534
    560 
    561 C  'ARATE' array: attraction model coefficients
    562 C   This is derived from the 2012 survey.
    563 C   Dimensions: ARATE(purpose, variable), where "variable" is:
    564 C   1=HH, 2=POP_HHS, 3=LOIND emp, 4=HIIND emp, 5=RTL emp, 6=HWY emp
    565 C   7=LOSVC emp, 8=HISVC emp, 9=OFFGOV emp, 10=EDUC emp, 11=STU_K8
    566 c   enrollmt, 12=STU_HS enrollmt, 13=STU_CU enrollmt, 14=density
    567 c   function, 15=median income, 16=CBD dummy.     
    568 
    569 C  Also note that the NHB and Truck coefficients have already been cut
    570 C   in half (from their originally calibrated values) to convert total

Page 13          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    571 C   trip ends to true attractions.  See AttrResults.xls.
    572 c  Note: the coefficients on income and on the density function ("dens")
    573 c   have been modified.  See TGcheck.xls.  These coefficients were 
    574 c   estimated using district-based data and needed to be adjusted in order
    575 c   to be applied to zone-level data.  These rates have also been modified
    576 c   in application so that the total A's match the total P's.
    577 
    578 C  Purpose:
    579 C       HBW   SCH   HBU   HBS   HBO   JTW   ATW   NWK   COM   MTK   HTK
    580       data arate/
    581      +0.000,0.000,0.000,0.472,1.687,0.000,0.000,0.538,0.146,0.099,0.038, !HH
    582      +0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000, !POP_HHS
    583      +0.710,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.454,0.266,0.139, !LOIND
    584      +0.710,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.454,0.266,0.139, !HIIND
    585      +1.591,0.000,0.000,2.469,2.731,0.200,0.553,2.299,0.501,0.253,0.065, !RTL
    586      +1.591,0.000,0.000,3.607,2.731,0.200,0.000,2.299,0.501,0.253,0.065, !HWY
    587      +0.597,0.000,0.000,0.000,0.000,0.050,0.542,0.000,0.454,0.068,0.009, !LOSVC
    588      +1.035,0.000,0.000,1.116,2.592,0.311,0.000,1.181,0.454,0.068,0.009, !HISVC
    589      +0.597,0.000,0.000,0.000,0.000,0.050,0.129,0.000,0.454,0.068,0.009, !OFFGOV
    590      +1.035,0.000,0.000,0.000,0.000,0.311,0.000,1.181,0.454,0.068,0.009, !EDUC
    591      +0.000,1.167,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000, !STUK8
    592      +0.000,2.965,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000, !STUHS
    593      +0.000,0.000,0.442,0.000,0.000,0.000,0.000,0.000,0.000,0.000,0.000, !STUCU
    594      +0.000,0.000,0.000,0.000,0.093,0.045,0.000,0.050,0.000,0.000,0.000, !dens
    595      +0.000,0.000,0.000,0.000,0.000400,0.00,0.00,0.00,0.000,0.000,0.000, !medinc
    596      + 649.,    0,    0,-726.,    0,    0,    0,-342.,    0,    0,    0/ !cbd
    597 
    598 C  'ATFACTP' array: adjustment factors for production model trip rates,
    599 C   based on Area Type
    600 C   Adjust so that the difference in factor between any
    601 c     2 area types never exceeds 0.10.
    602 C   Dimensions: ATFACTP(purpose, area type)
    603 C  purpose:         HBW  SCH  HBU  HBS  HBO  JTW  ATW  NWK
    604       data atfactp/0.77,0.82,3.30,1.19,1.24,1.27,1.27,1.23,
    605      +             0.87,0.92,0.85,1.00,1.15,1.17,1.17,1.13,
    606      +             0.97,1.02,0.90,1.03,1.06,1.07,1.07,1.06,
    607      +             1.02,1.02,1.02,1.00,0.96,0.97,0.97,0.97,
    608      +             1.12,0.92,1.05,0.90,0.89,0.87,0.87,0.87/
    609 
    610 C  'PFACT' array: adjustment factors for production model trip rates.
    611 C   See TGcheck.xls.
    612 C   Dimensions: PFACT(purpose,income).  
    613 C  purpose:  HBW   SCH   HBU   HBS   HBO   JTW   ATW   NWK
    614       data pfact/
    615      +     0.887,0.793,1.016,1.297,1.060,0.730,0.733,0.926,  ! inc 1
    616      +     0.822,0.793,1.016,1.264,1.129,0.730,0.733,0.926,  ! inc 2
    617      +     0.718,0.793,1.016,0.931,0.830,0.730,0.733,0.926,  ! inc 3
    618      +     0.774,0.793,1.016,0.959,0.963,0.730,0.733,0.926/  ! inc 4
    619 
    620 C  'ATFACTA' array: adjustment factors for attraction model trip rates,
    621 C   based on Area Type
    622 C   Dimensions: ATFACTA(purpose, area type)
    623 C
    624 C  purpose:    HBW  SCH  HBU  HBS  HBO  JTW  ATW  NWK  COM  MTK  HTK
    625       data atfacta/
    626      +        1.02,1.16,0.66,0.90,1.17,1.12,1.10,1.33,1.00,1.00,1.00,
    627      +        1.00,1.06,0.76,0.93,1.07,1.02,1.00,1.26,1.00,1.00,1.00,

Page 14          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    628      +        0.99,1.06,0.86,1.03,1.13,0.92,0.90,1.16,1.00,1.00,1.00,
    629      +        1.00,0.98,0.84,1.00,0.93,0.82,0.80,1.06,1.00,1.00,1.00,
    630      +        1.02,0.92,0.94,0.90,0.83,0.72,0.70,0.96,1.00,1.00,1.00/
    631 
    632 C  'ACOEFAS' array: coefficients for submodel to split
    633 C   Attractions by income.  Recalibrated from 2012 survey.
    634 C   Dimensions: ACOEFAS[purpose (1-5), variable (1-10)]
    635 c   Variables are: 1=bias 1, 2=bias 2, 3=bias 3, 4=CBD dummy (0/1),
    636 c   5=% loind, 6=% hiind, 7=%rtl, 8=% hwy, 9=% losvc, 10=% educ.  
    637 c   Purpose codes use the original codes, but codes 2 and 3 (SCH, 
    638 c   HBU) aren't used -- they aren't split by income.
    639 C
    640 C         purpose:   HBW    SCH    HBU    HBS    HBO    var
    641       data acoefas/-0.66,  0.00,  0.00,  0.02, -0.07,  !1
    642      +             -0.67,  0.00,  0.00,  0.02, -0.08,  !2
    643      +             -0.70,  0.00,  0.00,  0.02, -0.05,  !3
    644      +             -0.71,  0.00,  0.00, -0.15,  0.20,  !4
    645      +              0.50,  0.00,  0.00,  1.50,  0.10,  !5
    646      +              1.70,  0.00,  0.00, -0.40,  0.00,  !6
    647      +              0.00,  0.00,  0.00, -0.90,  0.00,  !7
    648      +              0.00,  0.00,  0.00, -1.50,  0.00,  !8
    649      +              4.50,  0.00,  0.00,  0.70,  0.50,  !9
    650      +              1.50,  0.00,  0.00,  0.00,  0.00/  !10
    651 
    652 C  'BASVOL' array: base (2010) 2-way daily (avg. weekday) volumes
    653 C    at each external station, by vehicle type (1=auto, 2=COM, 3=MTrk,
    654 c    4=HTrk).  Source: CDOT.  Updated 23 May 2013.    DATA OK
    655 c	Updated with expanded network 15 December 2015_ Updated with base (2015) 11 July 2016
    656 c         type:          Auto       COM       MTK       HTK
    657       data basvol /     500,       38,       35,       30,
    658      +                 2590,      195,       44,      221,
    659      +                  120,        9,       10,       18,
    660      +                  360,       27,       30,       12,
    661      +                 1640,      123,       22,       53,
    662      +                  820,       62,       25,       29,
    663      +                  670,       50,       42,        9,
    664      +                  110,        8,       18,        0,
    665      +                  330,       24,       43,       45,
    666      +                 8590,      647,      701,     2528,
    667      +                  480,       36,       43,       38,
    668      +                12730,      958,      635,     1880,
    669      +                 2430,      183,      180,      310,
    670      +                  570,       42,       54,      203,
    671      +                  920,       69,       94,      130,
    672      +                  200,       15,       37,       23,
    673      +                 3370,      253,      817,      390,
    674      +                  340,       25,       49,       13,
    675      +                 2470,      186,      458,      327,
    676      +                  700,       53,       62,       14,
    677      +                 5620,      423,      385,      300,
    678      +                32000,     2410,     1400,     9586,
    679      +                 5250,      395,      649,      578,
    680      +                 2040,      154,      216,       46,
    681      +                 1430,      107,      155,       22,
    682      +                 1440,      108,      157,      116,
    683      +                 7590,      571,      428,      373,
    684      +                 4140,      311,      304,      452,

Page 15          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    685      +                  450,       34,       50,        4,
    686      +                29570,     2226,     1480,     7720,
    687      +                 2460,      185,      150,       59,
    688      +                  660,       49,       17,        3,
    689      +                22290,     1678,     1000,     3030,
    690      +                 4180,      315,      110,       92,
    691      +                 4550,      342,      217,       80,
    692      +                 5530,      416,      383,      128,
    693      +                 2690,      203,       74,       13,
    694      +                16220,     1221,      481,     1538,
    695      +                 2800,      211,      150,      440,
    696      +                 5650,      425,      290,      530,
    697      +                 8120,      611,      390,      380,
    698      +                 1760,      132,       93,      220,
    699      +                  330,       25,       28,       38,
    700      +                 1010,       76,       62,       50,
    701      +                 3540,      266,      130,      166,
    702      +                 3750,      283,      180,       83,
    703      +                56880,     4281,     2400,     8440,
    704      +		       4270,	  321,	    220,      190,
    705      +		        960,	   72,	    100,       73,
    706      +	       	       1120,	   84,	     81,       61,
    707      +		        900,	   68,	     31,        6,
    708      +		      27820,	 2094,	   1190,     3900,
    709      +		       2570,	  193,	    177,      164,
    710      +		       3140,	  236,	    140,       84,
    711      +		       4800,	  361,	    250,      290,
    712      +		       1680,	  126,	    147,       55,
    713      +		       1660,	  125,	     93,       37,
    714      +		      28490,	 2144,	   1230,     4140,
    715      +		       1140,	   86,	     82,       92,
    716      +		       1890,	  142,	    156,       68,
    717      +		       3790,	  286,	    180,      140,
    718      +		       2020,	  152,	    110,      120,
    719      +		        630,	   48,	    204,        9,
    720      +		        190,	   14,	     21,        1,
    721      +		       1350,	  102,	     73,       73,
    722      +		        380,	   29,	     20,        7,
    723      +		        450,	   34,	     34,       11,
    724      +		       2390,	  180,	     91,       36,
    725      +		      13560,	 1021,	    700,     1720,
    726      +		        600,	   45,	     31,        3,
    727      +		       1200,	   91,	     65,       17,
    728      +		       1420,	  107,	     78,       13,
    729      +		        330,	   25,	     17,        1,
    730      +		       2260,	  170,	     82,       49,
    731      +		        860,	   65,	     62,       15, 
    732      +		       1770,	  133,	     95,       98,
    733      +		        430,	   32,	     31,        8,
    734      +		        520,	   39,	     37,        9,
    735      +		        770,	   58,	     48,       25,
    736      +		      22140,	 1666,	   1220,     5177,
    737      +		        690,	   52,	     49,       12,
    738      +		        600,	   45,	     43,       11,
    739      +		       2490,	  188,	    116,      102,
    740      +		        430,	   32,	     31,        8,
    741      +		        520,	   39,	     37,        9,

Page 16          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    742      +		        520,	   39,	     37,        9,
    743      +		        260,	   19,	     19,        5,
    744      +		        520,	   39,	     37,        9,
    745      +                    448*0/	
    746 
    747 C  'BTHRUV' array: base (2010) through trip ends by external station
    748 C   and vehicle type.  Source: CDOT.  Updated 3 Jul 13 (see 
    749 c   cal\TD\xxTE.dat and buildXX.s).
    750 c	Updated with expanded network 15 December 2015_ Updated with base (2015) 11 July 2016
    751 c   type:       Auto          COM          MTK          HTK
    752       data bthruv /0,      0,      0,      0,   
    753      +            67,      4,	   0,	   0,
    754      +             0,      0,	   0,	   0,
    755      +             0,      0,	   0,	   0,
    756      +            29,      0,	   0,	   0,
    757      +            16,      0,	   0,	   0,
    758      +             0,      0,	   0,	   0,
    759      +             0,      0,	   0,	   0,
    760      +             0,      0,	   0,	   0,
    761      +           403,     33,	  41,	  52,
    762      +             0,      0,	   0,	   0,
    763      +          1829,    132,	 136,	 461,
    764      +           123,      7,	  11,	  22,
    765      +             0,      0,	   0,	   0,
    766      +            22,      0,	   0,	   0,
    767      +             0,      0,	   0,	   0,
    768      +           261,     20,	  33,	  36,
    769      +             0,      0,  	   0,	   0,
    770      +           307,     21,	  46,     44,
    771      +             0,      0,	   0,	   0,
    772      +           300,     20,	  23,	  28,
    773      +          5656,    424,	 478,	1709,
    774      +           101,      6,	   0,      4,
    775      +            26,      0,  	   0,	   0,
    776      +            19,      0,	   0,	   0,
    777      +            19,      0,	  10,	   0,
    778      +           205,     14,	  22,	  30,
    779      +           357,     26,	   0,	  60,
    780      +             0,      0,	   0,	   0,
    781      +          9832,    754,	 606,	2330,
    782      +            21,      0,	  21,	   0,
    783      +             0,      0,	   0,	   0,
    784      +          1612,    122,	  71,     72,
    785      +           310,     22,	   0,	  10,
    786      +           127,      9,	  18,	   8,
    787      +           182,     13,	  33,	  13,
    788      +            32,      0,	   0,	   0,
    789      +           846,     65,	  39,	  51,
    790      +           160,     10,	  32,	  55,
    791      +           139,      8,	  16,	  49,
    792      +           336,     24,	   0,	  15,
    793      +            75,      2,	  10,	   7,
    794      +             0,      0,	   0,	   0,
    795      +            10,      0,	   0,	   0,
    796      +           110,      7,	  13,	   8,
    797      +            55,      0,	  17,	  11,
    798      +         10293,    790,	 683,	2508,

Page 17          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    799      +             6,      0,	  11,	  10,
    800      +            15,      0,	   0,	   0,
    801      +            22,      0,	   0,	   0,
    802      +             0,      0,	   0,	   0,
    803      +         18171,   1395,	 621,	1804,
    804      +          1475,    113,	  78,	  64,
    805      +           823,     62,	  37,	  27,
    806      +           377,     28,	  17,	  20,
    807      +           506,     39,	  54,	  22,
    808      +           867,     67,	  56,	  22,
    809      +         19157,   1475,	 688,	2416,
    810      +           118,      7,	  11,	  10,
    811      +           298,     23,	  23,	   6,
    812      +            68,      5,	   8,	   2,
    813      +            32,      0,	   6,	   1,
    814      +             0,      0,	   0,	   0,
    815      +             0,      0,	   0,	   0,
    816      +            36,      0,	   1,	   4,
    817      +             0,      0,	   0,	   0,
    818      +             0,      0,	   0,	   0,
    819      +           157,      8,	   5,	   5,
    820      +          1665,    123,	 122,	 249,
    821      +             0,      0,	   0,	   0,
    822      +            51,      2,	   0,	   1,
    823      +            10,      0,	   4,	   1,
    824      +             0,      0,	   0,	   0,
    825      +            96,      4,	   3,	   3,
    826      +             0,      0,	   0,	   0,
    827      +           173,     14,	   5,	   2,
    828      +            53,      4,	   0,	   0,
    829      +            18,      2,	   0,	   0,
    830      +           160,     10,	   9,	   7,
    831      +         10586,    814,	 760,   2870,
    832      +            64,      4,	   5,	   2,
    833      +             0,      0,	   0,	   0,
    834      +           236,     18,	   9,	   6,
    835      +             0,      0,	   0,	   0,
    836      +           115,      6,	   1,	   0,
    837      +             4,      0,	   0,	   0,
    838      +            16,      0,	   1,	   0,
    839      +            49,      4,	   0,	   0,
    840      +   448*0/
    841 
    842 c  'EXTADJ' array: adjustments to external share models, in order
    843 c   to make the base year (2010) estimates match the cordon counts.
    844 c   Array is (vehicle type 1-5, direction 1-2), where direction 1
    845 c   is I/E and direction 2 is E/I.
    846 
    847 c                 wk auto nw auto     com     mtk     htk
    848       data extadj/ 0.8585, 1.4755, 0.3600, 0.9050, 3.2500,      ! I/E
    849      +             0.6380, 0.2790, 0.2134, 0.5390, 1.4500/      ! E/I
    850 
    851 c  'LCFAC' array: adjustments to life cycle model, in order to 
    852 c   reflect substantial differences in the Charlotte Uptown area.
    853 c   Array is (lifecycle, income).  Adjustments are derived from 
    854 c   2012 survey; see LifeCycle.xlsx.
    855 

Page 18          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    856 c        lifecycle   1     2     3
    857       data lcfac/ 0.89, 1.82, 0.81,	! inc 1
    858      +            1.02, 0.00, 1.36,	! inc 2
    859      +            0.73, 0.00, 1.58,	! inc 3
    860      +            0.74, 0.30, 1.53/	! inc 4
    861 
    862 C--------------------------------------------------------------------
    863 C  Start the program.
    864 C  Version number and release date.
    865       verinfo='1.2    00 Jul 13'
    866 
    867 C  Get system date and time for the listing header.
    868 
    869       call getdat(yr,mon,day)
    870       call gettim(hr,min,sec,hun)
    871 
    872 C Check command line for setup file name.
    873       call getarg(1,control,stat1)
    874       if(stat1.le.0) then
    875         write(*,'(/'' Version '',a17)') verinfo
    876         write(*,'('' Usage:   tgmet [control-file]'')')
    877         stop "Enter the driver file name on the command line."
    878       end if
    879 
    880       write(*,50) verinfo
    881    50 format(' TGMET Program Version ',a16/)
    882 
    883 C  Open the setup (a.k.a. "driver") file.  This contains some 
    884 C    parameters in a NAMELIST.  The setup file MUST be 
    885 C    named on the program's command line, like so:  
    886 C    TGMET SETUP.SET
    887 
    888 C  The first line of the driver file is an 80-character title, to
    889 C    be placed on all pages of the printed output.
    890 
    891 C  Driver file parameter definitions:
    892 
    893 C  FILES
    894 c   input
    895 C    sefile      = zonal land use data file
    896 c    distcorfile = zonal distance to the cordon file
    897 c    distcbdfile = zonal distance to the CBD file (not used, but
    898 c	variable retained in code)
    899 c    xvolfile    = external station volume file
    900 c    pumafile    = TAZ/PUMA equivalency file
    901 c   output
    902 c    prodfile    = productions file
    903 c    attrfile    = attractions file
    904 c    xxfile      = through trip growth factor file
    905 c    hhfile      = file of individual HH records
    906 C    list        = listing file
    907 C  PARAMETERS
    908 C    avg5per  = average persons/HH for HHs with 5+ persons [5.54]
    909 C    empfactor= regional ratio of labor force (resident workers)
    910 c       to employees [0.8740]
    911 C    repo(1)= switch to print report of input "seed" arrays [T]
    912 C    repo(2)= switch to print report of HH's by breakdowns [T]

Page 19          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    913 C    repo(3)= switch to print report of trip end normalization [T]
    914 C    repo(4)= switch to print report of trip ends [T]
    915 C    repo(5)= switch to print report of trip ratios [T]
    916 C    repo(6)= switch to print zonal data [T]
    917 C    repo(7)= switch to print future cordon volume report [T]
    918 C    repo(8)= switch to print Through trip factors [T]
    919 C    tfactor(1) = final factor to be applied to HBW trip ends [1.0]
    920 C    tfactor(2) = final factor to be applied to SCH trip ends [1.0]
    921 C    tfactor(3) = final factor to be applied to HBU trip ends [1.0]
    922 C    tfactor(4) = final factor to be applied to HBS trip ends [1.0]
    923 C    tfactor(5) = final factor to be applied to HBO trip ends [1.0]
    924 C    tfactor(6) = final factor to be applied to JTW trip ends [1.0]
    925 C    tfactor(7) = final factor to be applied to ATW trip ends [1.0]
    926 C    tfactor(8) = final factor to be applied to NWK trip ends [1.0]
    927 C    tfactor(9) = final factor to be applied to COM trip ends [1.0]
    928 C    tfactor(10)= final factor to be applied to MTK trip ends [1.0]
    929 C    tfactor(11)= final factor to be applied to HTK trip ends [1.0]
    930 c    iewrkavo   = I/E work average vehicle occupancy [1.182]
    931 c    ienwkavo   = I/E non-work average vehicle occupancy [1.666]
    932 c    eiwrkavo   = E/I work average vehicle occupancy [1.172]
    933 c    einwkavo   = E/I non-work average vehicle occupancy [1.556]
    934 c    begtr      = beginning zone number to trace [none]
    935 c    endtr      = ending zone number to trace [none]
    936 C    zTAZ-zAREA = variable position in the S/E data file of the
    937 C		  model-defined variables
    938 C  COEFFS
    939 C    prate   = 8x5x3x4 array of production trip rates/HH
    940 C    arate   = 11x16 array of attraction equation coefficients
    941 C    acoefas = 5x5 array of acc. attraction split coefficients
    942 C    atfactp = 8x5 array of Area Type production rate adjustment factors
    943 C    atfacta = 10x5 array of Area Type attraction rate adj factors
    944 C    gqfact  = 8x2 array of Group Quarters trip rates per person
    945 C    pfact   = 8x4 array of production rate factors by inc & purpose
    946 C    extadj  = 5x2 array of external model adj factors
    947 C    siseed  = 4x5x15 array of seed matrix of HHs by income, size, PUMA
    948 C    basvol  = 4x200 array of base (2010) cordon volume by station
    949 C    bthruv  = 4x200 array of base (2010) cordon EE volume by station
    950 C  SPECIAL
    951 C    specgenzone = 30x11 array of special gen zone numbers by purpose
    952 C    specgenprod = 30x11 array of special gen productions by purpose
    953 C    specgenattr = 30x11 array of special gen attractions by purpose
    954 C  EQUIV
    955 C    cbd     = list of up to 100 zone numbers in the Charlotte CBD
    956 C    uptown  = list of up to 100 zone numbers in the Uptown area
    957 
    958       istop = 0
    959       begtr = 0
    960       endtr = 0
    961       open(5,err=105,file=control,status='old',form='formatted')
    962       read(5,100) (title(i),i=1,10)
    963   100 format(10a8)
    964       read(5,files)
    965       rewind 5
    966       read(5,parameters)
    967       rewind 5
    968       read(5,coeffs)
    969       rewind 5

Page 20          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

    970       read(5,special)
    971       rewind 5
    972       read(5,equiv)
    973       go to 114
    974   105 write(*,110)
    975   110 format(' TGMET 110 (F): Cannot find the specified setup/',
    976      +  'driver file.  I quit.'/)
    977       stop "Enter the setup/driver file name on the command line."
    978 
    979 C  Open output listing file (will overwrite existing file).
    980 
    981   114 open(6,file=list,status='unknown')
    982       write(6,120) (title(i),i=1,10),day,month(mon),yr,hr,min,sec,
    983      + page
    984   120 format(10a8//i2,1x,a4,i4,2x,i2,1h:,i2.2,1h:,i2.2,16x,'TGMET',
    985      +  29x,'Page ',i3/)
    986 
    987 C  Rewind driver file and echo to the output listing.
    988 
    989       rewind 5
    990       do while (.NOT. eof(5))
    991         read (5,100,end=121) (scard(i),i=1,10)
    992         write (6,100) (scard(i),i=1,10)
    993       end do
    994   121 continue
    995 
    996 C  If the specified input files do not exist, quit.
    997 
    998       write(*,'('' Checking input files.'')')
    999 
   1000       do 138 t = 1,5
   1001         fil(t) = 0
   1002   138 continue
   1003       call findit (sefile,names(1),fil(1))
   1004       call findit (xvolfile,names(2),fil(2))
   1005       call findit (distcorfile,names(3),fil(3))
   1006 c      call findit (distcbdfile,names(4),fil(4))
   1007       call findit (pumafile,names(5),fil(5))
   1008       totfil = fil(1) + fil(2) + fil(3) + fil(4) + fil(5)
   1009 
   1010       if (totfil .gt. 0) then
   1011         write(6,140)
   1012   140   format('TGMET 140 (F): Cannot find required files.  I quit.')
   1013         stop "A fatal error has occurred.  Please check listing file."
   1014       end if
   1015 
   1016 C  Open the files.  Output files will overwrite any existing
   1017 C   files of the same name, without warning.  Unit assignments:
   1018 C               INPUT                           OUTPUT
   1019 C    1 = zonal S/E data file            6 = listing
   1020 C        (CSV format)                   7 = productions
   1021 C    2 = external station volume file   8 = attractions
   1022 C    3 = distance to cordon file        9 = scratch for size/inc data
   1023 C    4 = dist. to CBD file (NOT USED)   10= scratch for prods
   1024 C    5 = setup file                     11= scratch for initial attrs
   1025 C   15 = area type file                 12= scratch for adjusted attrs
   1026 C   21 = PUMA equiv file                13= scratch for attr by pur&inc

Page 21          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1027 C                                       14= scratch for normalized attr
   1028 c                                       16= X/X growth factor file
   1029 c                                       17= production DCT
   1030 c                                       18= attraction DCT
   1031 c                                       19= X/X factor DCC
   1032 c                                 reuse 21= individual HH file
   1033 
   1034 C If REPO(1) = T, print size/income regional seed matrix.
   1035 
   1036       if (repo(1)) then
   1037         call header
   1038 	  write(6,144)
   1039   144   format(/' ',35x,'Report 1'/' ',29x,'Report of Input Arrays'//
   1040      +    ' ',18x,'Proportion of Households by Income and Size'//)
   1041         do p = 1,15
   1042           write(6,145) p,(stitl(s),s=1,5),((siseed(i,s,p),s=1,5),i=1,4)
   1043   145     format(' ','PUMA ',i2,35x,'Persons'/' ',t27,5(4x,a4)/
   1044      +      '   lowest 10%',t27,
   1045      +      5f8.4/'   11-25 %ile    ',t27,5f8.4/'   26-50 %ile     ',
   1046      +      t27,5f8.4/'   upper 50%  ',t27,5f8.4/)
   1047         end do
   1048       end if
   1049 
   1050       write(*,'('' Opening input files.'')')
   1051       open(1,file=sefile,status='old',form='formatted')
   1052       open(2,file=xvolfile,status='old',form='formatted')
   1053       open(3,file=distcorfile,status='old',form='formatted')
   1054       open(15,file=atfile,status='old',form='formatted')
   1055 
   1056 C If user used undocumented SAVESCR switch, save scratch files.
   1057       if (savescr) then
   1058         open (9,file='temp9a.scr',status='unknown',form='formatted')
   1059         open(10,file='temp10.scr',status='unknown',form='formatted')
   1060         open(11,file='temp11.scr',status='unknown',form='formatted')
   1061         open(12,file='temp12.scr',status='unknown',form='formatted')
   1062         open(13,file='temp13.scr',status='unknown',form='formatted')
   1063         open(14,file='temp14.scr',status='unknown',form='formatted')
   1064       else
   1065         open (9,status='scratch',form='formatted')
   1066         open(10,status='scratch',form='formatted')
   1067         open(11,status='scratch',form='formatted')
   1068         open(12,status='scratch',form='formatted')
   1069         open(13,status='scratch',form='formatted')
   1070         open(14,status='scratch',form='formatted')
   1071       end if
   1072 
   1073 C If we're debugging, print out the production trip rates.
   1074 
   1075       if (begtr.gt.0 .or. endtr.gt.0) then
   1076         write(6,9038)
   1077  9038   format(' TGMET Trace 9038: Production Trip Rates'/
   1078      1   ' Purp  W/S  Life  Inc     Rate'/)
   1079         do 9037 p = 1,8
   1080         do 9037 s = 1,5
   1081         do 9037 l = 1,3
   1082         do 9037 i = 1,4
   1083 	    s2 = s

Page 22          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1084 	    if (p .eq. 1) s2 = s - 1
   1085           write(6,9008) purcode(p),s2,l,i,prate(p,s,l,i)
   1086  9008     format(' ',a4,3x,i1,4x,i1,5x,i1,3x,f7.3)
   1087  9037   continue
   1088       end if
   1089 
   1090       if (begtr.gt.0 .or. endtr.gt.0) then
   1091         write(6,9062)
   1092  9062   format(/' TGMET Trace 9062: External Model Adj Factors'/)
   1093         do 9063 i = 1,5
   1094         do 9063 j = 1,2
   1095           write(6,9064) i,j,extadj(i,j)
   1096  9064     format(' ','purpose: ',i2'  direction: ',i2,f10.4)
   1097  9063   continue
   1098       end if
   1099       
   1100 C--------------------------------------------------------------------
   1101 C Read zonal SE file and store data in the Z array.
   1102 c Z array  Variable             Z array  Variable
   1103 c (Input)
   1104 c   1      TAZ                  12       HISVC 
   1105 c   2      POP_TOT              13       OFFGOV
   1106 C   3      POP_HHS              14       EDUC
   1107 C   4      POP_GRP              15       EMP_TOT
   1108 C   5      HH                   16       STU_K8
   1109 C   6      MED_INC              17       STU_HS
   1110 C   7      LOIND                18       STU_CU
   1111 C   8      HIIND                19       DORM
   1112 C   9      RTL                  20       AREA
   1113 C  10      HWY                  
   1114 C  11      LOSVC                
   1115 c (Calculated)
   1116 c  23      income ratio
   1117 c  24      special generator flag
   1118 c  25      CBD flag
   1119 c  26      distance to cordon
   1120 c  27      distance to CBD
   1121 c  28      area type
   1122 c  29      density function
   1123 c  30      % RTL + HWY employment
   1124 c  31      Uptown flag
   1125 
   1126       write(*,'('' Reading zonal data.''/)')
   1127       
   1128 c Find how many fields we have to read from the S/E file in order
   1129 c  to get all of the model variables.  Can't read more than 50.
   1130 c  Then, read the first (header) record but don't do anything with
   1131 c  it.
   1132 
   1133       nfld = max(zTAZ,zPOP_TOT,zPOP_HHS,zPOP_GRP,zHH,zMED_INC,zLOIND,
   1134      + zHIIND,zRTL,zHWY,zLOSVC,zHISVC,zOFFGOV,zEDUC,zEMP_TOT,zSTU_K8,
   1135      + zSTU_HS,zSTU_CU,zDORM,zAREA)
   1136 
   1137 c  Gallup - Added trouble shooting write line
   1138       write(*,'('' Finished reading zonal data.''/)')     
   1139 
   1140 

Page 23          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1141       if (nfld .gt. 50) then
   1142         write(6,9049) nfld
   1143  9049   format(' TGMET 9049 (F): User specified reading past ',
   1144      +    'field 50 on input S/E file.  I quit.')
   1145       stop "A fatal error has occurred.  Please check listing file."
   1146       endif
   1147       read(1,*) (zname(i),i=1,nfld)
   1148 
   1149 c  Gallup - Added trouble shooting write line
   1150       write(*,'('' Read first header record.''/)')   
   1151        
   1152 c INTZONES is the number of internal zones.  This will be equal to 
   1153 c  the number of S/E data records.
   1154 
   1155       intzones = 0
   1156       
   1157   150 read(1,*,err=9050,end=158) (zdat(i),i=1,nfld)
   1158       intzones = intzones + 1
   1159       go to 155
   1160       
   1161  9050 write(6,9051)
   1162  9051 format(' TGMET 9051 (F): Problem reading from S/E file.')
   1163       stop "A fatal error has occurred.  Please check listing file."
   1164 
   1165 c On input S/E file, fields can be in any order.  Here, put the
   1166 c  S/E variables in the Z array in the proper columns.  Change on 
   1167 c  1 Apr 2013: Area is now input in whole acres, reduced 25% from
   1168 c  the previous values to account for land area only (per JM).
   1169   155 z(1,intzones) = zdat(zTAZ)
   1170       z(2,intzones) = zdat(zPOP_TOT)
   1171       z(3,intzones) = zdat(zPOP_HHS)
   1172       z(4,intzones) = zdat(zPOP_GRP)
   1173       z(5,intzones) = zdat(zHH)
   1174       z(6,intzones) = zdat(zMED_INC)
   1175       z(7,intzones) = zdat(zLOIND)
   1176       z(8,intzones) = zdat(zHIIND)
   1177       z(9,intzones) = zdat(zRTL)
   1178       z(10,intzones)= zdat(zHWY)
   1179       z(11,intzones)= zdat(zLOSVC)
   1180       z(12,intzones)= zdat(zHISVC)
   1181       z(13,intzones)= zdat(zOFFGOV)
   1182       z(14,intzones)= zdat(zEDUC)
   1183       z(15,intzones)= zdat(zEMP_TOT)
   1184       z(16,intzones)= zdat(zSTU_K8)
   1185       z(17,intzones)= zdat(zSTU_HS)
   1186       z(18,intzones)= zdat(zSTU_CU)
   1187       z(19,intzones)= zdat(zDORM)
   1188 
   1189 c Convert area from acres back to sq mi.
   1190       z(20,intzones)= zdat(zAREA) / 640
   1191 
   1192       go to 150
   1193 
   1194 c  Gallup - Added trouble shooting write line
   1195       write(*,'('' Finished putting SE in proper columns.''/)') 
   1196   
   1197 c Go through the zonal data and accumulate some totals.

Page 24          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1198 
   1199   158 istop = 0
   1200       do n = 1,5
   1201         regtot(n) = 0.0
   1202       end do
   1203 
   1204       do iz = 1,intzones
   1205 	  itaz = z(1,iz)
   1206         
   1207 c Calculate "density function".  This is a combination of HH and
   1208 c  employment density.
   1209 
   1210         if (z(20,iz) .lt. 0.0001) then
   1211           write(6,160) itaz
   1212   160     format(' TGMET 160 (F): Area is zero for zone ',i5,
   1213      +      '  I quit.')
   1214           stop "A fatal error has occurred.  Please check listing file."
   1215         else
   1216           z(29,iz) = 0.0
   1217           if(z(5,iz)+z(15,iz) .gt. 0.0001)
   1218      *      z(29,iz) = 100 * log((1000*z(15,iz) + 1900*z(5,iz))/z(20,iz))
   1219         end if
   1220 
   1221 c        if (begtr .gt. 0) then
   1222 c          write(6,9054) itaz,z(29,iz)
   1223 c 9054     format(' TGMET Trace 9054: density function calc, taz: ',i5,
   1224 c     +      ' = ',f15.3)
   1225 c        end if
   1226 
   1227 c Calculate % RTL+HWY employment.  This is used in the model to
   1228 c  split attractions by income.  Store in z(30,iz).
   1229 
   1230         z(30,iz) = 0.0
   1231         if (z(15,iz) .gt. 0.01) z(30,iz) = (z(9,iz)+z(10,iz))/z(15,iz)
   1232 
   1233 c Fill TAZZONE array.  This gives me a pointer from the TAZ back to
   1234 c  the sequential zone number.  Z(1,iz) gives me the pointer from
   1235 c  the sequential number to the TAZ.
   1236 
   1237         if (z(1,iz) .le. maxzone) then
   1238           tazzone(z(1,iz)) = iz
   1239         else
   1240           write(*,165) itaz
   1241   165     format(' TGMET 165 (F): input zone number exceeds ',
   1242      1      'program limit of 30000: ',i6,'  I quit.')
   1243           stop "A fatal error has occurred. Please check listing file."
   1244         endif
   1245 
   1246 C Accumulate regional totals of employees, HHs, persons in HHs,
   1247 C  total persons, HH income.
   1248 
   1249         regtot(1) = regtot(1) + z(15,iz)			! tot emp
   1250         regtot(2) = regtot(2) + z(5,iz)			! hh
   1251         regtot(3) = regtot(3) + z(3,iz)			! hh pop
   1252         regtot(4) = regtot(4) + z(2,iz)			! tot pop
   1253         regtot(5) = regtot(5) + z(5,iz)*z(6,iz)	! hh*inc
   1254 

Page 25          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1255         if (z(1,iz).ge.begtr .and. z(1,iz).le.endtr) then
   1256 	    itaz = z(1,iz)
   1257           write(6,9011) itaz,(z(j,iz),j=1,20),z(29,iz),z(30,iz),
   1258      +      intzones
   1259  9011     format(' TGMET Trace 9011: zone= ',i7,'  zonal data array'/
   1260      +      3x,10f7.0/3x,9f7.0,f7.4/3x,2f10.3/' INTZONES= ',i5/)
   1261         end if
   1262 
   1263       end do
   1264 
   1265       close (1)
   1266 
   1267 c Calculate the regional median HH income as the HH-weighted average.
   1268 c  (2013: income measure changed from Mean to Median)
   1269 
   1270       regavginc = regtot(5)/regtot(2)
   1271 
   1272 C Divide each zone's median HH income by the calculated median HH income.
   1273 C  If income value is zero for any zone with HHs, print
   1274 C   warning and use 1.0 for the income ratio.
   1275 
   1276       do iz = 1,intzones
   1277         itaz = z(1,iz)
   1278         if (z(6,iz) .lt. 0.01 .and. z(5,iz) .gt. 0.01) then
   1279           write(6,170) itaz
   1280   170     format(' TGMET 170 (W): Zero HH income for zone ',
   1281      1      i5/5x,'Substituting the regional median.')
   1282           z(23,iz) = 1.0
   1283         else
   1284           z(23,iz) = z(6,iz)/regavginc
   1285         end if
   1286 
   1287         if (itaz.ge.begtr .and. itaz.le.endtr) then
   1288           write(6,9012) itaz,z(6,iz),z(23,iz),regavginc
   1289  9012     format(' READZONAL Trace 9012: zone= ',i5,'  income: ',
   1290      +      f8.0, '  inc ratio: ',
   1291      +      f6.3/'  regional median inc: ',f7.0)
   1292         end if
   1293       end do
   1294 
   1295 C--------------------------------------------------------------------
   1296 C Read the sequential PUMA number from a separate ASCII file.  Store
   1297 C  it for each zone.  First, read the header record.
   1298 
   1299       open(21,file=pumafile,status='old',form='formatted')
   1300       read(21,175) control
   1301   175 format(a80)
   1302   
   1303   180 read(21,177,end=182) itaz,pumano
   1304   177 format(i9,9x,i9)
   1305       iz = tazzone(itaz)
   1306       if (iz .gt. 0) tazpuma(iz) = pumano
   1307       go to 180
   1308   182 continue  
   1309       close (21)
   1310 
   1311 	write(*,'('' Finished with PUMA data.''/)')

Page 26          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1312 
   1313 C--------------------------------------------------------------------
   1314 C Read the area type from a separate ASCII file.
   1315 
   1316 
   1317   185 read(15,190,end=192) itaz,atype
   1318   190 format(i10,i1)
   1319       iz = tazzone(itaz)
   1320       if (iz .gt. 0) z(28,iz) = atype
   1321       go to 185
   1322   192 continue
   1323       close (15)
   1324       write(*,'('' Finished with AT data.''/)')
   1325       if (istop .EQ. 1)
   1326      +  stop "A fatal error has occurred. Please check listing file."
   1327      
   1328 C--------------------------------------------------------------------
   1329 C Store the special generator flag in the Z array, element 24.
   1330 
   1331       do 195 zz = 1,30
   1332       do 195 p = 1,11
   1333         m = specgenzone(zz,p)
   1334         if (m .eq. 0) cycle
   1335         n = tazzone(m)
   1336         if (n .gt. 0) z(24,n) = 1.0
   1337   195 continue
   1338 	write(*,'('' Finished with Spec Gen data.''/)')
   1339 C--------------------------------------------------------------------
   1340 C Store the CBD flag in the Z array.  Z(25,iz) = 1.0 if the zone
   1341 C  is in the CBD.  Use EQUIV NAMELIST like so:
   1342 C  &EQUIV cbd = 1,5,56,140,-144 /
   1343 
   1344       rewind 5
   1345   200 do n = 1,100
   1346         cbd(n) = 0
   1347       end do
   1348       read(5,equiv,end=210)
   1349       do n = 1,100
   1350         if (cbd(n) .eq. 0) go to 200
   1351         k = tazzone(abs(cbd(n)))
   1352         if (cbd(n) .lt. 0) then
   1353           t = 1 * k
   1354         else
   1355           z(25,k) = 1.0
   1356           zz = k
   1357           cycle
   1358         end if
   1359         do i = zz,t
   1360           z(25,i) = 1.0
   1361         end do
   1362       end do
   1363       go to 200
   1364   210 continue
   1365   
   1366 C Same for the Uptown flag.  Store in z(31,iz).
   1367 
   1368       rewind 5

Page 27          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1369   215 do n = 1,100
   1370         uptown(n) = 0
   1371       end do
   1372       read(5,equiv,end=220)
   1373       do n = 1,100
   1374         if (uptown(n) .eq. 0) go to 215
   1375         k = tazzone(abs(uptown(n)))
   1376         if (uptown(n) .lt. 0) then
   1377           t = 1 * k
   1378         else
   1379           z(31,k) = 1.0
   1380           zz = k
   1381           cycle
   1382         end if
   1383         do i = zz,t
   1384           z(31,i) = 1.0
   1385         end do
   1386       end do
   1387       go to 215
   1388   220 continue
   1389 
   1390 C--------------------------------------------------------------------
   1391 C Read the external station volume file.  Read the
   1392 C  input data into STAVOL, by vehicle type: 1=auto,
   1393 c  2=COM, 3=MTK, 4=HTK.  This is the TOTAL cordon volume
   1394 c  (External + E/E).
   1395 
   1396       n = 1
   1397   230 read(2,*,end=250) itaz,(stavol(p,n),p=1,4)
   1398 
   1399 c Store TAZ number in TAZZONE and sequential zone number in Z(1,iz).
   1400 
   1401       tazzone(itaz)  = intzones + n
   1402       z(1,intzones+n) = itaz
   1403 
   1404       if (n .gt. 200) then
   1405         write(6,240)
   1406   240   format(' TGMET 240 (F): More than 200 external stations.',
   1407      +    '  I quit.'/)
   1408         stop "A fatal error has occurred.  Please check listing file."
   1409       end if
   1410 
   1411       if (begtr .gt. 0) then
   1412         write(6,9053) n,itaz,tazzone(itaz),(stavol(p,n),p=1,4)
   1413  9053   format(' TGMET Trace 9053 of external volume read'/
   1414      +    5x,' sta no.:',i4,'  taz:',i6,'  seq no.:',i6,
   1415      +    '  vols1-4:',4f7.0)
   1416       end if
   1417       n = n + 1
   1418 
   1419       go to 230
   1420   250 close (2)
   1421 
   1422 c Now calculate ZONES as the number of total zones: internal
   1423 c  + external.  Check for max limit of 5000 internal zones.
   1424 
   1425       nsta  = n - 1

Page 28          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1426       zones = intzones + nsta
   1427       if (intzones .LE. 0 .OR. intzones .GT. 5000) then
   1428         write(6,255) intzones
   1429   255   format(' TGMET 255 (F): More than 5000 internal zones: ',
   1430      +   i6,'  I quit.'/)
   1431         stop "A fatal error has occurred.  Please check listing file."
   1432       end if
   1433 
   1434 C--------------------------------------------------------------------
   1435 c Read the file with the distance to the cordon (store in z(26,iz))
   1436 
   1437   260 read(3,*,end=280) itaz,yi,yrl
   1438       iz = tazzone(itaz)
   1439       if (iz .lt. 1 .or. iz .gt. 5000) go to 260
   1440       if (yrl .lt. 0.000 .or. yrl .gt. 100.0) then
   1441         write(6,275) itaz,yrl
   1442   275   format(' TGMET 275 (F): Bad distance to cordon for zone ',
   1443      +    i5,'  value: ',f8.2,'  I quit.')
   1444         stop "A fatal error has occurred.  Please check listing file."
   1445       else
   1446         z(26,iz) = yrl
   1447       end if
   1448 
   1449       if (itaz .ge. begtr .and. itaz .le. endtr) then
   1450         write(6,9059) itaz,z(26,iz),intzones,nsta,zones
   1451  9059   format(' TGMET Trace 9059: Dist to cordon for taz= ',i5,
   1452      +    '  = ',f6.2/' ',5x,'Intzones= ',i5,'  No. Sta.= ',i5,
   1453      +    '  Tot Zones= ',i5/)
   1454       endif
   1455 
   1456       go to 260
   1457   280 continue
   1458 
   1459 C--------------------------------------------------------------------
   1460 c Read the file with the distance to the CBD (store in z(27,iz))
   1461 c  Note: as of 25 Aug 05, this file is no longer used in the model.
   1462 c  But, keep the code in for possible future use.
   1463 
   1464 c      ymin = 999.9
   1465 c  290 read(4,*,end=297) itaz,yi,yrl
   1466 c      iz = tazzone(itaz)
   1467 c      if (iz .lt. 1 .or. iz .gt. 5000) go to 290
   1468 c      if (yrl .lt. 0.000 .or. yrl .gt. 100.0) then
   1469 c        write(6,295) itaz,yrl
   1470 c  295   format(' TGMET 295 (F): Bad distance to CBD for zone ',
   1471 c     +    i5,'  value: ',f8.2,'  I quit.')
   1472 c        stop "A fatal error has occurred.  Please check listing file."
   1473 c      else
   1474 c        z(27,iz) = yrl
   1475 c      end if
   1476 
   1477 c This input value can logically be zero, but that is unacceptable
   1478 c  to the model.  Reset zero values as half the minimum value
   1479 c  (other than zero), encountered up to that point in the input stream.
   1480 
   1481 c      if (yrl .gt. 0.0001) then
   1482 c        if (yrl .lt. ymin) ymin = yrl

Page 29          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1483 c      else
   1484 c        z(27,iz) = ymin/2.0
   1485 c      endif
   1486 
   1487 c      if (itaz .ge. begtr .and. itaz .le. endtr) then
   1488 c        write(6,9049) itaz,ymin,z(27,iz)
   1489 c 9049   format(' TGMET Trace 9049: Dist to CBD for taz= ',i5/
   1490 c     +    '  Minimum distance = ',f6.2,'  Dist for this zone = ',f6.2/)
   1491 c      endif
   1492 
   1493 c      go to 290
   1494 c  297 continue
   1495 
   1496 c--------------------------------------------------------------------
   1497 C  Start first loop.
   1498 
   1499       do 700 iz = 1,intzones
   1500         itaz = z(1,iz)
   1501         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,302) itaz
   1502   302   format('+','TGMET  302 (N): Loop  1 - processing zone ',i5)
   1503 
   1504 C  Initialize for this zone, but if no HHs, jump to the end.
   1505 
   1506         hh       = z(5,iz)
   1507         hhpop    = z(3,iz)
   1508         do s = 1,5
   1509           spct(s) = 0.0
   1510           do i = 1,4
   1511             ctot(i)     = 0.0
   1512             ipct(i)     = 0.0
   1513             sizinc(s,i) = 0.0
   1514             do l = 1,3
   1515               sizinclif(s,i,l) = 0.0
   1516             end do
   1517           end do
   1518         end do
   1519         if (hh .eq. 0) go to 640
   1520 
   1521 C--------------------------------------------------------------------
   1522 C  Determine HH's by size and income.  First, calculate average
   1523 C   HH size for this zone.
   1524 
   1525   312   perhh = hhpop/hh
   1526         if (perhh .gt. 3.9) perhh = 3.9
   1527         if (perhh .lt. 1.0) perhh = 1.0
   1528 
   1529 C  Now, calculate the desired row (HH size) shares.
   1530 
   1531   315   lind  = INT(10.0*perhh - 9.0)
   1532 	hind  = lind + 1
   1533         low   = 0.9 + 0.10*float(lind)
   1534         high  = 0.9 + 0.10*float(hind)
   1535         range = high - low
   1536         ratio = 0.0
   1537         if (range .gt. 0.001) ratio = (perhh - low)/range
   1538         if (lind .lt. 1) lind  = 1
   1539         if (hind .gt. 30) hind = 30

Page 30          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1540         do s = 1,5
   1541           spct(s) = 0.01 * (sizedist(s,lind) +
   1542      +              ratio* (sizedist(s,hind) - sizedist(s,lind)))
   1543         end do
   1544 
   1545 C  Ensure that total percentages sum to 1.0.
   1546 
   1547         csum = spct(1)+spct(2)+spct(3)+spct(4)+spct(5)
   1548         diff = abs(csum - 1.000)
   1549         if (diff .gt. 0.001) then
   1550           do s = 1,5
   1551             spct(s) = spct(s)/csum
   1552           end do
   1553         end if
   1554 
   1555 C  Calc. desired row totals.  Do not round -- leave as Real.
   1556 
   1557         do s = 1,5
   1558           size(s) = hh * spct(s)
   1559         end do
   1560 
   1561       if (itaz.ge.begtr .and. itaz.le.endtr) then
   1562         write(6,9002) itaz,perhh,(spct(s),s=1,5),(size(s),s=1,5)
   1563  9002   format(' TGMET Trace 9002: taz=',i5,' per/hh= ',f6.3,
   1564      +    ' size % = ',5f5.2/5x,'HHs by size= ',5f8.3)
   1565       end if
   1566 
   1567 C--------------------------------------------------------------------
   1568 C  Now, calculate HHs by income group.
   1569 
   1570   342   incrat = z(23,iz)
   1571         if (incrat .gt. 3.7) incrat = 3.7
   1572         if (incrat .lt. 0.1) incrat = 0.1
   1573 
   1574 C  Now, calculate the desired column (income group) shares.
   1575 
   1576   345   lind  = INT(10.0*incrat)
   1577 	hind  = lind + 1
   1578         low   = 0.10*float(lind)
   1579         high  = 0.10*float(hind)
   1580         range = high - low
   1581         ratio = 0.0
   1582         if (range .gt. 0.001) ratio = (incrat - low)/range
   1583         if (lind .lt. 1) lind  = 1
   1584         if (hind .gt. 37) hind = 37
   1585         do i = 1,4
   1586           ipct(i) = 0.01 * (incdist(i,lind) +
   1587      +              ratio* (incdist(i,hind) - incdist(i,lind)))
   1588         end do
   1589 
   1590 C  Ensure that total percentages sum to 1.0.
   1591 
   1592         csum = ipct(1)+ipct(2)+ipct(3)+ipct(4)
   1593         diff = abs(csum - 1.000)
   1594         if (diff .gt. 0.001) then
   1595           do i = 1,4
   1596             ipct(i) = ipct(i)/csum

Page 31          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1597           end do
   1598         end if
   1599 
   1600 C Calc. desired column totals.  Again, leave as Real.
   1601 
   1602         do i = 1,4
   1603           income(i) = hh * ipct(i)
   1604         end do
   1605 
   1606       if (itaz.ge.begtr .and. itaz.le.endtr) then
   1607         write(6,9003) itaz,incrat,(ipct(i),i=1,4),(income(i),i=1,4)
   1608  9003   format(' TGMET Trace 9003: taz=',i5,' inc ratio= ',f5.3,
	............................................................1    
(1) Recommended relationship between field width 'W' and the number of fractional digits 'D' in this edit descriptor is 'W>=D+3'.

   1609      +    ' income %=',4f6.3/5x,'initial HHs by income = ',4f8.3)
   1610       end if
   1611 
   1612 C--------------------------------------------------------------------
   1613 C Calc. initial joint distribution matrix [JOINT(size,income)]
   1614 C   and get initial row totals.  Loops are indexed on size (S) and
   1615 C   income (I).  Initial joint distribution is now stratified by
   1616 C   PUMA, which we have to look up.
   1617 
   1618         p = tazpuma(iz)
   1619 
   1620         do s = 1,5
   1621           rtot(s) = 0.0
   1622         end do
   1623         do 370 s = 1,5
   1624         do 370 i = 1,4
   1625           joint(s,i) = hh * siseed(i,s,p)
   1626           rtot(s)    = rtot(s) + joint(s,i)
   1627   370   continue
   1628 
   1629 C Factor matrix to get desired row totals.
   1630 
   1631         do 380 s = 1,5
   1632         do 380 i = 1,4
   1633           if (rtot(s).GT.0.0) joint(s,i) = joint(s,i) * size(s)/rtot(s)
   1634   380   continue
   1635         newtot = hh
   1636 
   1637 C Start big row loop.
   1638 
   1639         do 500 s = 1,5
   1640           sneg = 0.0
   1641 
   1642 C Calc. the column difference.
   1643 
   1644           do i = 1,4
   1645             cdiff(i) = income(i)
   1646             do s2 = 1,5
   1647               cdiff(i) = cdiff(i) - joint(s2,i)
   1648             end do
   1649 
   1650 C Apportion each column's difference along this row.

Page 32          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1651 
   1652             if (newtot .GT. 0.0) share(i) = cdiff(i) * size(s)/newtot
   1653             joint(s,i) = joint(s,i) + share(i)
   1654 
   1655 C Check to see if resulting value is negative.
   1656 
   1657             if (joint(s,i) .LT. 0.0) then
   1658               sneg = sneg + joint(s,i)
   1659               joint(s,i) = 0
   1660             end if
   1661           end do
   1662 
   1663 C End column loop no. 1.  Calc. adjustment for negative values.
   1664 
   1665           negfac = 1.0000
   1666           if (sneg .LT. 0.0) negfac = 1.0 + sneg/(size(s)-sneg)
   1667 
   1668 C Apply adjustment for negative values (col. loop #2).
   1669 
   1670           do i = 1,4
   1671             joint(s,i)  = joint(s,i) * negfac
   1672             sizinc(s,i) = joint(s,i)
   1673           end do
   1674 
   1675 C Calc. "new matrix total" (current matrix total less this row).
   1676 
   1677           newtot = newtot - size(s)
   1678 
   1679   500   continue
   1680 
   1681 C For accuracy, do one last factor to get the column
   1682 C  totals (by income) to come out more closely to the desired totals.
   1683 
   1684         do 610 s = 1,5
   1685         do 610 i = 1,4
   1686           ctot(i) = ctot(i) + sizinc(s,i)
   1687   610   continue
   1688 
   1689         do 630 i = 1,4
   1690           cfac  = 0.0
   1691           if (ctot(i) .gt. 0.0) cfac = income(i)/ctot(i)
   1692           do s = 1,5
   1693             sizinc(s,i) = cfac * sizinc(s,i)
   1694           end do
   1695 
   1696       if (itaz.ge.begtr .and. itaz.le.endtr) then
   1697         write(6,9004) itaz,i,income(i),ctot(i),cfac,
   1698      +    (sizinc(s2,i),s2=1,5)
   1699  9004   format(' TGMET Trace 9004: taz= ',i5,'  i= ',i1,' desired col',
   1700      +    ' tot= ',f8.3/20x,'current col tot= ',f8.3,'  factor= ',f8.4/
   1701      +    20x,'sizinc (row 1-5)= ',5f8.3/)
   1702       end if
   1703 
   1704   630   continue
   1705 
   1706 C Write the 20 values of HHs by size and income to a scratch file
   1707 C  for later use.  Write them in row order: S1/I1, S1/I2, S1/I3,

Page 33          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1708 C  S1/I4, S2/I1, etc.  Maintain 6 digits to the right of the decimal.
   1709 C  Write this file for ALL zones, including zones with no HHs,
   1710 C  to preserve the zone order.
   1711 
   1712   640   write(9,650) itaz,((sizinc(s,i),i=1,4),s=1,5)
   1713   650   format(i5,20f11.6)
   1714 
   1715 C Sum HHs by income group.
   1716 
   1717         do 660 i = 1,4
   1718         do 660 s = 1,5
   1719           tinc(i) = tinc(i) + sizinc(s,i)
   1720   660   continue
   1721 
   1722 C End of first loop.
   1723 
   1724   700 continue
   1725 
   1726 C Calculate regional percent of HHs by income group.  Need this
   1727 c  later.
   1728 
   1729       isum = tinc(1) + tinc(2) + tinc(3) + tinc(4)
   1730       do i = 1,4
   1731         ripct(i) = tinc(i)/isum
   1732       end do
   1733 
   1734       if (begtr.gt.0 .or. endtr.gt.0) then
   1735         write(6,9010) isum,(tinc(i),i=1,4),(ripct(i),i=1,4)
   1736  9010   format(' TGMET Trace 9010: income normalization calculation '/
   1737      +    5x,' isum= ',f11.1,'  tinc 1-4= ',4f11.1
   1738      +    /5x,' ripct= ',4f8.4/)
   1739       end if
   1740 
   1741 C--------------------------------------------------------------------
   1742 C Rewind scratch file 9 and start second loop.
   1743 
   1744       rewind 9
   1745       write(*,'(/)')
   1746       do 800 iz = 1,intzones
   1747         itaz = z(1,iz)
   1748         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,710) itaz
   1749   710   format('+','TGMET  710 (N): Loop  2 - processing zone ',i5)
   1750 
   1751 C Since income groups are supposed to be 10%/15%/25%/50%, normalize
   1752 C  them accordingly and write them back out to another scratch file.
   1753 
   1754         read(9,650) k,((sizinc(s,i),i=1,4),s=1,5)
   1755         do 715 i = 1,4
   1756         do 715 s = 1,5
   1757           sizinc(s,i) = sizinc(s,i) * igroup(i) / ripct(i)
   1758   715   continue
   1759         write(10,650) iz,((sizinc(s,i),i=1,4),s=1,5)
   1760 
   1761       if (itaz.ge.begtr .and. itaz.le.endtr) then
   1762         write(6,9047) itaz,((sizinc(s,i),i=1,4),s=1,5)
   1763  9047   format(' TGMET Trace 9047: taz=',i5,' 1st intermed. SIZINC ',
   1764      +    '(after income normalization)'/5x,'size 1, inc 1-4: ',4f9.3/

Page 34          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1765      +    5x,'size 2, inc 1-4: ',4f9.3/5x,'size 3, inc 1-4: ',4f9.3/
   1766      +    5x,'size 4, inc 1-4: ',4f9.3/5x,'size 5, inc 1-4: ',4f9.3/)
   1767       end if
   1768 
   1769 C End of second loop.
   1770 
   1771   800 continue
   1772 
   1773 C Re-use unit 9 as a new scratch file.
   1774 
   1775       close (9)
   1776       if (savescr) then
   1777         open(9,file='temp9b.scr',status='unknown',form='formatted')
   1778       else
   1779         open(9,status='scratch',form='formatted')
   1780       end if
   1781 
   1782 C--------------------------------------------------------------------
   1783 C Rewind scratch file 10 and start third loop.
   1784 
   1785       rewind 10
   1786       write(*,'(/)')
   1787       do 850 iz = 1,intzones
   1788         itaz = z(1,iz)
   1789         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,810) itaz
   1790   810   format('+','TGMET  810 (N): Loop  3 - processing zone ',i5)
   1791 
   1792 C The previous loop (income group normalization) will have goofed up
   1793 C  the no. of HHs by zone.  Re-normalize here to get the right number
   1794 C  of HHs by zone.  [Z(5,IZ) = HH].
   1795 
   1796         read(10,650) k,((sizinc(s,i),i=1,4),s=1,5)
   1797         newtot = 0.0
   1798         do 820 s = 1,5
   1799         do 820 i = 1,4
   1800           newtot = newtot + sizinc(s,i)
   1801   820   continue
   1802 
   1803         factor = 1.0
   1804         if (newtot .gt. 0.0001) factor = z(5,iz)/newtot
   1805 
   1806         do 830 s = 1,5
   1807         do 830 i = 1,4
   1808           sizinc(s,i) = sizinc(s,i) * factor
   1809   830   continue
   1810 
   1811         write(9,650) iz,((sizinc(s,i),i=1,4),s=1,5)
   1812 
   1813         if (itaz.ge.begtr .and. itaz.le.endtr) then
   1814         write(6,9015) itaz,newtot,factor,((sizinc(s,i),i=1,4),s=1,5)
   1815  9015   format(' TGMET Trace 9015: taz=',i5,' 2nd intermed. SIZINC (',
   1816      +  'after zone normaliz.)'/5x,'new tot= ',f10.3,' adj fact= ',f9.6/
   1817      +    5x,'size 1, inc 1-4: ',4f9.3/5x,'size 2, inc 1-4: ',4f9.3/
   1818      +    5x,'size 3, inc 1-4: ',4f9.3/5x,'size 4, inc 1-4: ',4f9.3/
   1819      +    5x,'size 5, inc 1-4: ',4f9.3/)
   1820         end if
   1821 

Page 35          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1822 C End of third loop.
   1823 
   1824   850 continue
   1825       close (10)
   1826 C--------------------------------------------------------------------
   1827 C Rewind scratch file 9 and start fourth loop.
   1828 
   1829       rewind 9
   1830       write(*,'(/)')
   1831       do 1000 iz = 1,intzones
   1832         itaz = z(1,iz)
   1833         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,890) itaz
   1834   890   format('+','TGMET  890 (N): Loop  4 - processing zone ',i5)
   1835 
   1836         read(9,650) k,((sizinc(s,i),i=1,4),s=1,5)
   1837 
   1838 C For each size and income category, use the 'LIFEDIST' array to
   1839 C  compute the initial distribution of HHs by size, income, and life
   1840 C  cycle.
   1841 
   1842 C Start loops on size (S) and income level (I).
   1843 
   1844         do l = 1,3
   1845           life(l) = 0.0
   1846         end do
   1847 
   1848 C If zone is in Uptown, incorporate special factor.  Then normalize
   1849 C  to be sure the LC fractions sum to 1.
   1850 
   1851         do 900 s = 1,5
   1852         do 900 i = 1,4
   1853           if (z(31,iz) .gt. 0.5) then
   1854             do l = 1,3
   1855               ld(l,i,s) = lifedist(l,i,s) * lcfac(l,i)
   1856             end do
   1857             sum = ld(1,i,s) + ld(2,i,s) + ld(3,i,s)
   1858             do l = 1,3
   1859               ld(l,i,s) = ld(l,i,s)/sum
   1860             end do  
   1861           else
   1862             do l = 1,3
   1863               ld(l,i,s) = lifedist(l,i,s)
   1864             end do
   1865           end if          
   1866           
   1867         do 900 l = 1,3        
   1868           sizinclif(s,i,l) = sizinc(s,i) * ld(l,i,s)
   1869           life(l) = life(l) + sizinclif(s,i,l)
   1870   900   continue
   1871 
   1872 C Write out HHs by size/income/life cycle to scratch file.
   1873 
   1874         write(11,940) iz,(((sizinclif(s,i,l),l=1,3),i=1,4),s=1,5)
   1875   940   format(i5,60f11.6)
   1876 
   1877 C Accumulate (Real) HHs by size, income, and life cycle into a
   1878 C  total table for the region, in case user later asks that it be

Page 36          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1879 C  printed.
   1880 
   1881         do 970 s = 1,5
   1882         do 970 i = 1,4
   1883         do 970 l = 1,3
   1884           tjointSIL(s,i,l) = tjointSIL(s,i,l) + sizinclif(s,i,l)
   1885           tsize(s)         = tsize(s)         + sizinclif(s,i,l)
   1886   970   continue
   1887 
   1888       if (itaz.ge.begtr .and. itaz.le.endtr) then
   1889         write(6,9029) itaz
   1890  9029   format(' TGMET Trace 9029: taz=',i5,' size/income/life '
   1891      +    'cycle calc.')
   1892         do 945 s = 1,5
   1893         do 945 i = 1,4
   1894           write(6,9030) s,i,(sizinclif(s,i,l),l=1,3)
   1895  9030     format(' Sz=',i2,' In=',i2,' LC=1-3,  HHs = ',3f12.6)
   1896   945   continue
   1897       end if
   1898 
   1899  1000 continue
   1900 
   1901 C--------------------------------------------------------------------
   1902 C Rewind scratch file 11 and start fifth loop.
   1903 
   1904       rewind 11
   1905       write(*,'(/)')
   1906       do 1100 iz = 1,intzones
   1907         itaz = z(1,iz)
   1908         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,1010) itaz
   1909  1010   format('+','TGMET 1010 (N): Loop  5 - processing zone ',i5)
   1910 
   1911         read(11,940) n,(((sizinclif(s,i,l),l=1,3),i=1,4),s=1,5)
   1912 
   1913 C For each size/income/life cycle category, use the 'WKRDIST' array to
   1914 C  compute the initial distribution of HHs by size, income, life
   1915 C  cycle and workers.
   1916 
   1917 C Start loops on size (S), income level (I), and life cycle (L).
   1918 
   1919         do 1020 s = 1,5
   1920         do 1020 i = 1,4
   1921         do 1020 l = 1,3
   1922           do w = 1,4
   1923             sizinclifwkr(s,i,l,w) = sizinclif(s,i,l) * wkrdist(w,l,i,s)
   1924           end do
   1925           regtotwkr  = regtotwkr + sizinclifwkr(s,i,l,2) +
   1926      1     2.0 * sizinclifwkr(s,i,l,3) + avg3wkr*sizinclifwkr(s,i,l,4)
   1927  1020   continue
   1928 
   1929         if (itaz.ge.begtr .and. itaz.le.endtr) then
   1930           write(6,9035) itaz
   1931  9035     format(/' TGMET Trace 9035: taz=',i5,' size/income/life '
   1932      +      'cycle/worker calc.')
   1933           do 1102 s = 1,5
   1934           do 1102 i = 1,4
   1935           do 1102 l = 1,3

Page 37          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1936             write(6,9036) s,i,l,(sizinclifwkr(s,i,l,w),w=1,4)
   1937  9036       format(' Sz=',i2,' In=',i2,' LC=',i2,' Wk0-3, HHs = ',
   1938      +        4f12.6)
   1939  1102     continue
   1940         end if
   1941 
   1942 C End of fifth loop.
   1943 
   1944  1100 continue
   1945 
   1946 C Adjust the regional total number of workers to match the regional
   1947 C  total employment, factored to account for I/E workers, E/I workers,
   1948 C  unemployment, and multiple job holders.  Factor is 'EMPFACTOR' and
   1949 C  its default value is based on 2010 data.  Calculate a new adjustment
   1950 C  factor called 'EMPADJUST'.  2010 values: REGTOT(1) = regional total
   1951 C  Metrolina employment = 1,220,673, REGTOTWKR = 1,067,600 (program est.).
   1952 
   1953       if (begtr .gt. 0) then
   1954         write(6,9034) regtot(1),regtot(2),regtotwkr
   1955  9034   format(/' TGMET Trace 9034: reg tot emp= ',f11.2,
   1956      1   '  reg tot hh= ',f11.2/'   regtotwkr= ',f11.2/)
   1957       end if
   1958 
   1959       oldwkrhh  = regtotwkr / regtot(2)
   1960       newtotwkr = regtot(1) * empfactor
   1961       empadjust = newtotwkr / regtotwkr
   1962       newwkrhh  = newtotwkr / regtot(2)
   1963 
   1964 C Write this calculation to the listing file.
   1965 
   1966       write(6,1105) regtot(1), empfactor, newtotwkr, regtotwkr,
   1967      +  empadjust
   1968  1105 format(//28x,'Report of Worker Submodel'//5x,'Regional total ',
   1969      + 'employment: ',f11.2/5x,'Worker/employee ratio:',10x,f8.4/
   1970      + 5x,'New est. regional workers: ',f11.2/5x,
   1971      + 'Initial total workers:'5x,f11.2/5x,'Workers/HH adjustment',
   1972      + ' factor:   ',f8.4//)
   1973 
   1974 C Use old and new workers/HH to enter the 'WKRMODL' curve and
   1975 C  obtain the old and new regional proportion of HHs by number of
   1976 C  workers [OLDWRK(4) and NEWWRK(4)].
   1977 
   1978       call workers(oldwkrhh,oldwrk)
   1979       call workers(newwkrhh,newwrk)
   1980 
   1981 C Calculate ratio of NEWWRK to OLDWRK, by no. of workers.
   1982 
   1983       do w = 1,4
   1984         wratio(w) = 1.0
   1985         if (oldwrk(w) .gt. 0.001) wratio(w) = newwrk(w)/oldwrk(w)
   1986       end do
   1987 
   1988 C Re-use unit 10 for a new scratch file.
   1989 
   1990       if (savescr) then
   1991         open(10,file='temp4.scr',status='unknown',form='formatted')
   1992       else

Page 38          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   1993         open(10,status='scratch',form='formatted')
   1994       end if
   1995 
   1996 C--------------------------------------------------------------------
   1997 C Rewind scratch file 11 and start sixth loop.
   1998 
   1999       rewind 11
   2000       write(*,'(/)')
   2001 
   2002 c Open individual HH output file.  
   2003 
   2004       open(21,file=hhfile,status='unknown',form='formatted')
   2005 
   2006       do 1300 iz = 1,intzones
   2007         itaz = z(1,iz)
   2008         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,1210) itaz
   2009  1210   format('+','TGMET 1210 (N): Loop  6 - processing zone ',i5)
   2010 
   2011         read(11,940) n,(((sizinclif(s,i,l),l=1,3),i=1,4),s=1,5)
   2012 
   2013 C Just as above...
   2014 C For each size/income/life cycle category, use the 'WKRDIST' array to
   2015 C  compute the initial distribution of HHs by size, income, life
   2016 C  cycle and workers.
   2017 C  Except this time, modify the worker distribution using WRATIO, as
   2018 C  calculated above.
   2019 
   2020 C Start loops on size (S), income level (I), and life cycle (L).
   2021 
   2022         tothh = 0.0
   2023         do 1240 s = 1,5
   2024         do 1240 i = 1,4
   2025         do 1240 l = 1,3
   2026           wsum = 0.0
   2027           do w = 1,4
   2028             sizinclifwkr(s,i,l,w) = sizinclif(s,i,l) * wkrdist(w,l,i,s)
   2029      1                            * wratio(w)
   2030             wsum = wsum + sizinclifwkr(s,i,l,w)
   2031           end do
   2032 
   2033 C The resulting subtotal of HHs by size/income/life cycle
   2034 C  probably won't be correct and will need to be normalized to the
   2035 C  proper total for each size/income/life cycle group.
   2036 
   2037           wfact = 1.0
   2038           if (wsum .gt. 0.001) wfact = sizinclif(s,i,l)/wsum
   2039           do w = 1,4
   2040             sizinclifwkr(s,i,l,w) = wfact * sizinclifwkr(s,i,l,w)
   2041             tothh = tothh + sizinclifwkr(s,i,l,w)
   2042           end do
   2043 
   2044  1240   continue
   2045 
   2046 C Check the resulting total HHs.  If they don't match the input total,
   2047 C  warn the user.
   2048 
   2049         if (abs(tothh - z(5,iz)) .gt. 1.0) write(6,1250) itaz,tothh,

Page 39          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2050      1   z(5,iz)
   2051  1250   format(' TGMET 1250 (W): On zone ',i5,', estimated total ',
   2052      1   'HHs'/'  by size, income, life cycle: ',f6.0,' do not match '/
   2053      2   '  the input total: ',f6.0'.  Check workers/HH calculation.')
   2054 
   2055 C Now collapse the size dimension, leaving HHs by workers/income/
   2056 C  life cycle.
   2057 
   2058         do 1260 w = 1,4
   2059         do 1260 i = 1,4
   2060         do 1260 l = 1,3
   2061           wkrinclif(w,i,l) = 0.0
   2062  1260   continue
   2063 
   2064         do 1270 w = 1,4
   2065         do 1270 i = 1,4
   2066         do 1270 l = 1,3
   2067         do 1270 s = 1,5
   2068           wkrinclif(w,i,l) = wkrinclif(w,i,l) + sizinclifwkr(s,i,l,w)
   2069  1270   continue
   2070 
   2071 C Write out HHs by workers/income/life cycle to scratch file.
   2072 
   2073         write(10,1275) iz,(((wkrinclif(w,i,l),l=1,3),i=1,4),w=1,4)
   2074  1275   format(i5,48f11.6)
   2075 
   2076       if (itaz.ge.begtr .and. itaz.le.endtr) then
   2077         write(6,9031) itaz
   2078  9031   format(' TGMET Trace 9031: taz=',i5,' wkr/income/life '
   2079      +    'cycle calc.')
   2080         do 9045 w = 1,4
   2081         do 9045 i = 1,4
   2082           write(6,9032) w-1,i,(wkrinclif(w,i,l),l=1,3)
   2083  9032     format(' Wk=',i2,' In=',i2,' LC1-3,  HHs = ',3f12.6)
   2084  9045   continue
   2085       end if
   2086 
   2087 c Write out the individual HH records for this zone to a permanent 
   2088 c  file, showing the size, income, lifecycle, and workers.  First,
   2089 c  bucket round the SIZINCLIFWKR array.
   2090         ihh  = z(5,iz)
   2091         thh  = 0
   2092         buck = 0.5  
   2093         do 1280 s = 1,5
   2094         do 1280 i = 1,4
   2095         do 1280 l = 1,3
   2096         do 1280 w = 1,4
   2097           qq = sizinclifwkr(s,i,l,w)
   2098           call bucket1(qq,jj,buck)
   2099           szinlfwk(s,i,l,w) = jj
   2100           thh = thh + jj
   2101  1280   continue
   2102   
   2103 c Check total HHs to make sure we didn't lose/gain any.  If we did,
   2104 c  repeatedly add/subtract 1 from a random non-zero cell until the
   2105 c  difference is zero.
   2106 

Page 40          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2107         hdiff = ihh - thh
   2108         do while (hdiff .ne. 0)
   2109           call random(qq)
   2110           wr = min0(max1(4*qq,4.0),1)
   2111           call random(qq)
   2112           ir = min0(max1(4*qq,4.0),1)
   2113           call random(qq)
   2114           lr = min0(max1(3*qq,3.0),1)
   2115           call random(qq)
   2116           sr = min0(max1(5*qq,5.0),1)
   2117           
   2118           if (szinlfwk(sr,ir,lr,wr) .gt. 0) then
   2119             incr = hdiff/iabs(hdiff)
   2120             szinlfwk(sr,ir,lr,wr) = szinlfwk(sr,ir,lr,wr) + incr
   2121             hdiff = hdiff - incr
   2122           end if
   2123         end do
   2124 
   2125       if (itaz.ge.begtr .and. itaz.le.endtr) then
   2126           write(6,9043) itaz
   2127  9043     format(/' TGMET Trace 9043: taz=',i5,' disagg size/income/life '
   2128      +      'cycle/worker calc.')
   2129           do 1282 s = 1,5
   2130           do 1282 i = 1,4
   2131           do 1282 l = 1,3
   2132             write(6,9044) s,i,l,(szinlfwk(s,i,l,w),w=1,4)
   2133  9044       format(' Sz=',i2,' In=',i2,' LC=',i2,' Wk0-3, HHs = ',
   2134      +        4i4)
   2135  1282     continue
   2136         end if
   2137 
   2138 c Write out the HH records.
   2139 c @@@ LATER: CHECK THE DISAGGREGATE CALCULATED HHs BY S/I/W/L
   2140 c   VS THE AGGREGATE SUMMARIES
   2141         do 1290 w = 1,4
   2142         do 1290 i = 1,4
   2143         do 1290 l = 1,3
   2144         do 1290 s = 1,5
   2145 	    jj = szinlfwk(s,i,l,w)
   2146           if (jj .gt. 0) then
   2147 		  do qq = 1,jj
   2148 		    write(21,1285) itaz,s,i,l,w-1
   2149  1285         format(i6,4i2) 
   2150             end do
   2151           end if
   2152  1290   continue
   2153 
   2154  1300 continue
   2155       close (21)
   2156 	write(*,'('' Finished loop 6 OK.'')')
   2157 
   2158 C--------------------------------------------------------------------
   2159 C Rewind scratch file 10 and start seventh loop.
   2160 
   2161       rewind 10
   2162       rewind 11
   2163       write(*,'(/)')

Page 41          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2164       do 1800 iz = 1,intzones
   2165         itaz = z(1,iz)
   2166         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,1410) itaz
   2167  1410   format('+','TGMET 1410 (N): Loop  7 - processing zone ',i5)
   2168 
   2169         read(10,1275) n,(((wkrinclif(w,i,l),l=1,3),i=1,4),w=1,4)
   2170         read(11,940)  n,(((sizinclif(s,i,l),l=1,3),i=1,4),s=1,5)
   2171 
   2172 C Calculate total workers.
   2173 
   2174         ztotwkr = 0.0
   2175         do 1420 i = 1,4
   2176         do 1420 l = 1,3
   2177           ztotwkr = ztotwkr + wkrinclif(2,i,l) + 2.0*wkrinclif(3,i,l)
   2178      1            + avg3wkr * wkrinclif(4,i,l)
   2179  1420   continue
   2180 
   2181 C Calculate and output final total integer HHs by income.
   2182 C  Bucket round across income categories within each zone.  Also
   2183 C  write out total number of workers in the zone on that same file.
   2184 
   2185         bu = 4
   2186         do 1450 i = 1,4
   2187           rinc(i) = 0.0
   2188           do 1445 w = 1,4
   2189           do 1445 l = 1,3
   2190             rinc(i) = rinc(i) + wkrinclif(w,i,l)
   2191  1445     continue
   2192           call bucket(rinc,intinc,bu)
   2193  1450   continue
   2194 
   2195 c        write(15,1460) iz,(intinc(i),i=1,4),ztotwkr
   2196 c 1460   format(i4,4i6,f7.0)
   2197 
   2198 C Accumulate (Real) HHs by workers, income, and life cycle into a
   2199 C  total table for the region, in case user later asks that it be
   2200 C  printed.
   2201 
   2202         do 1470 w = 1,4
   2203         do 1470 i = 1,4
   2204         do 1470 l = 1,3
   2205           tjointWIL(w,i,l) = tjointWIL(w,i,l) + wkrinclif(w,i,l)
   2206           tinc(i)          = tinc(i)          + wkrinclif(w,i,l)
   2207           twkr(w)          = twkr(w)          + wkrinclif(w,i,l)
   2208           tlife(l)         = tlife(l)         + wkrinclif(w,i,l)
   2209  1470   continue
   2210 
   2211 C--------------------------------------------------------------------
   2212 C  Apply production trip rates and accumulate initial trip
   2213 C   productions by purpose and income.  Use worker/income/life cycle
   2214 C   breakdowns for HBW, JTW, and ATW trips and size/income/life
   2215 C   cycle breakdowns for SCH, HBU, HBS, HBO, and NWK trips.  For now,
   2216 C   store the total productions in PROD(p,i).  "Total" means I/I
   2217 c   plus I/E.
   2218 
   2219         do 1500 p = 1,11
   2220         do 1500 i = 1,4

Page 42          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2221           prod(p,i) = 0.0
   2222  1500   continue
   2223 
   2224         do 1520 p = 1,8
   2225         do 1520 i = 1,4
   2226           if (p .eq. 1 .or. p .eq. 6 .or. p .eq. 7) then
   2227             do 1505 l = 1,3
   2228             do 1505 w = 1,4
   2229               prod(p,i) = prod(p,i)
   2230      +                + wkrinclif(w,i,l) * prate(p,w,l,i) * pfact(p,i)
   2231  1505       continue
   2232           else
   2233             do 1510 l = 1,3
   2234             do 1510 s = 1,5
   2235               prod(p,i) = prod(p,i)
   2236      +                + sizinclif(s,i,l) * prate(p,s,l,i) * pfact(p,i)
   2237  1510       continue
   2238           end if
   2239  1520   continue
   2240 
   2241 c Before adding in GQ and special generator productions, accumulate
   2242 c  the HBW, HBS, and HBO productions by income and county for later
   2243 c  use in the attraction split model.
   2244 
   2245         c = (itaz-mod(itaz,1000))/1000 + 1
   2246         if (itaz .gt. 10000 .and. itaz .lt. 11999) c = 11
   2247         if (c .gt. 16) then
   2248           write(6,1525) itaz
   2249  1525     format(' TGMET 1525 (F): TAZ number ',i5,' implies more ',
   2250      +      ' than 15 counties.'/'   Cannot handle that.  I quit.')
   2251           stop "A fatal error has occurred.  Please check listing file."
   2252         end if
   2253 
   2254         if (itaz .ge. begtr .and. itaz .le. endtr) then
   2255           write(6,9060) itaz,c,z(25,iz)
   2256  9060     format(/' TGMET Trace 9052: taz = ',i5,'  county = ',i3,
   2257      +      '  CBD flag = ',f3.0)
   2258           do p = 1,8
   2259             write(6,9052) p,(pfact(p,i),i=1,4)
   2260  9052       format(' PFACT for purp ',i2,' inc 1-4: ',4f10.4)
   2261           enddo
   2262         end if
   2263 
   2264         do i = 1,4
   2265           copct(c,1,i) = copct(c,1,i) + prod(1,i)
   2266           copct(c,4,i) = copct(c,4,i) + prod(4,i)
   2267           copct(c,5,i) = copct(c,5,i) + prod(5,i)
   2268         end do
   2269 
   2270 C Add in productions from people in group quarters.  Trip rate/
   2271 C  person is calculated as GQFACT(purpose,zone type) * the following
   2272 C  production rates:
   2273 C       Purpose         Size         Workers Life Cycle Income
   2274 C     1 HBW                             1               1
   2275 C     2 SCH             1                       1       1
   2276 C     3 HBU             4                       2       1
   2277 C               (to account for students in dorms)

Page 43          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2278 C     4 HBS             1                       1       1
   2279 C     5 HBO             1                       1       1
   2280 C     6 JTW             1               1               1
   2281 C     7 ATW             1               1               1
   2282 C     8 NWK             1                       1       1
   2283 
   2284 C Z(19,iz) is 1.0 if this zone is a college dormitory zone, else 0.0.
   2285 C  All GQ trips are considered to be Income 1.
   2286 
   2287 C 22 Aug 05: do this calc only if DO_GQ is True.  This allows user
   2288 C  to skip the GQ trip calc for purposes of validating results
   2289 C  to a home-interview survey.
   2290 
   2291         if (do_gq) then
   2292           n = 2 - ifix(z(19,iz))
   2293           prod(1,1) = prod(1,1)
   2294      1              + gqfact(1,n) * prate(1,2,1,1) * z(4,iz)
   2295           prod(2,1) = prod(2,1)
   2296      1              + gqfact(2,n) * prate(2,1,1,1) * z(4,iz)
   2297           prod(3,1) = prod(3,1)
   2298      1              + gqfact(3,n) * prate(3,4,2,1) * z(4,iz)
   2299           prod(4,1) = prod(4,1)
   2300      1              + gqfact(4,n) * prate(4,1,1,1) * z(4,iz)
   2301           prod(5,1) = prod(5,1)
   2302      1              + gqfact(5,n) * prate(5,1,1,1) * z(4,iz)
   2303           prod(6,1) = prod(6,1)
   2304      1              + gqfact(6,n) * prate(6,2,1,1) * z(4,iz)
   2305           prod(7,1) = prod(7,1)
   2306      1              + gqfact(7,n) * prate(7,2,1,1) * z(4,iz)
   2307           prod(8,1) = prod(8,1)
   2308      1              + gqfact(8,n) * prate(8,1,1,1) * z(4,iz)
   2309         end if
   2310 
   2311         if (itaz.ge.begtr .and. itaz.le.endtr) then
   2312           write(6,9007) itaz,z(19,iz),((gqfact(p,n),p=1,8),n=1,2)
   2313  9007     format(' TGMET Trace 9007: Initial Productions for taz=',i5/
   2314      1      ' ','Dorm zone flag: ',f2.0/' ','GQ Factors: ',8f7.4/
	....................................1                             
(1) Recommended relationship between field width 'W' and the number of fractional digits 'D' in this edit descriptor is 'W>=D+3'.

   2315 	2      ' ','            ',8f7.4)
   2316           do p = 1,8
   2317             write(6,9022) purcode(p),(prod(p,i),i=1,4)
   2318  9022       format(' ',5x,'purpose ',a4,'  by inc 1-4: ',4f10.4)
   2319           end do
   2320         end if
   2321 
   2322 C Modify initially estimated zonal productions for Area Type and
   2323 C  income.  Note that in the original model calibration, no such
   2324 C  factors were developed.  But, we leave this section in, for
   2325 C  possible future use.  Also apply global adjustment factor.
   2326 
   2327         atype = ifix(z(28,iz))
   2328         do 1530 p = 1,8
   2329         do 1530 i = 1,4
   2330           prod(p,i) = prod(p,i) * atfactp(p,atype) * tfactor(p)
   2331  1530   continue

Page 44          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2332 
   2333         if (itaz.ge.begtr .and. itaz.le.endtr) then
   2334           write(6,9048) itaz
   2335  9048     format(/' TGMET Trace 9048: Final Productions for taz=',i5/
   2336      +      '     (After area type/income adjustment)')
   2337           do p = 1,8
   2338             write(6,9024) purcode(p),(prod(p,i),i=1,4)
   2339  9024       format(' ',5x,'purpose ',a4,'by inc 1-4: ',4f10.4)
   2340           end do
   2341         end if
   2342 
   2343 C Commercial and Truck productions (= attractions).  Store them all
   2344 C  as "income 1".  Apply Attraction area type adjustment.
   2345 
   2346         do p = 9,11
   2347           prod(p,1) = (arate(p,1) * z(5,iz)  + arate(p,3) * z(7,iz)
   2348      1               + arate(p,4) * z(8,iz)
   2349      1               + arate(p,5) * z(9,iz)  + arate(p,6) * z(10,iz)
   2350      2               + arate(p,7) * z(11,iz) + arate(p,8) * z(12,iz)
   2351      3               + arate(p,9) * z(13,iz) + arate(p,10) * z(14,iz))
   2352      4               * atfacta(p,atype) * tfactor(p)
   2353         end do
   2354 
   2355 C Special generator productions.  Only need to check this if the flag
   2356 C  (Z(24,iz)) is > 0.  If SPECGENPROD is negative, replace the
   2357 C  previously calculated value with the absolute value of it.  If it
   2358 C  is positive, add it to
   2359 C  the previously calculated value.  Since user inputs only a single
   2360 C  value for productions, use the previously estimated split by income
   2361 C  to split the new value by income.
   2362 
   2363         if (z(24,iz) .gt. 0.5) then
   2364 
   2365           do 1570 p = 1,11
   2366             do 1565 zz = 1,30
   2367               m = specgenzone(zz,p)
   2368               if (m .eq. 0) cycle
   2369               n = tazzone(m)
   2370               if (n .eq. iz) then
   2371                 csum = prod(p,1)+prod(p,2)+prod(p,3)+prod(p,4)
   2372                 do i = 1,4
   2373                   ipct(i) = igroup(i)
   2374                   if (csum .gt. 0.001) ipct(i) = prod(p,i)/csum
   2375                 end do
   2376 
   2377                 if (specgenprod(zz,p) .lt. 0) then
   2378                   do i = 1,4
   2379                     prod(p,i) = ipct(i) * abs(specgenprod(zz,p))
   2380                   end do
   2381                 else
   2382                   do i = 1,4
   2383                     prod(p,i) = prod(p,i)+ipct(i)*specgenprod(zz,p)
   2384                   end do
   2385                 end if
   2386 
   2387                 write(6,1575) m,purcode(p),specgenprod(zz,p)
   2388  1575           format(' TGMET 1575 (N): Special generator ',

Page 45          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2389      +            'productions used for TAZ ',i5/' purpose: ',a4,
   2390      +            '  value: ',i9/)
   2391 
   2392                 go to 1570
   2393 
   2394               end if
   2395  1565       continue
   2396 
   2397 
   2398  1570     continue
   2399 
   2400         end if
   2401 
   2402 C Apply I/E model to split productions into I/I and I/E.  I/E model
   2403 C  estimates the % of total productions that are externally attracted,
   2404 C  as an exponential function of the zone's distance to the cordon.
   2405 C  Model was calibrated from 2012 survey data; see iemodel.xlsx.
   2406 C  If that distance is 0.0, can't do the exponentiation, so just
   2407 C  set the external share to 100%.  Calculate 2 percents: Work and
   2408 c  Non-work.  Start with the Work share for COM/MTK/HTK, then
   2409 c  change it to match the cordon count data.  External trips are
   2410 c  all "income 1".  Last term in "EXTPCT" equations is a final
   2411 c  adjustment to get the proper regional total I/E trips.
   2412 
   2413         if (z(26,iz) .lt. 0.0001) then
   2414           extpctw = 1.0000
   2415           extpctn = 1.0000
   2416         else
   2417           extw = 1.31 * z(26,iz)**(-1.47)
   2418           extn = 0.29 * z(26,iz)**(-1.33)
   2419           extpctw = extw * extadj(1,1)
   2420           extpctn = extn * extadj(2,1)
   2421           if (extpctw .gt. 0.95) extpctw = 0.95
   2422           if (extpctn .gt. 0.98) extpctn = 0.98
   2423         end if
   2424 
   2425 c Compute the I/E purpose productions.
   2426 c  Use "Work" I/E fraction for HBW, JTW, COM, and truck; use
   2427 c  the "Non-Work" I/E fraction for the other purposes.
   2428 
   2429         extpctc = extw * extadj(3,1)
   2430         extpctm = extw * extadj(4,1)
   2431         extpcth = extw * extadj(5,1)
   2432 	  extpctc = amin1(extpctc,0.95)
   2433 	  extpctm = amin1(extpctm,0.95)
   2434         extpcth = amin1(extpcth,0.95)
   2435 
   2436         prod(12,1) = extpctw * (prod(1,1)+prod(1,2)+prod(1,3)+prod(1,4)
   2437      +     +prod(6,1)+prod(6,2)+prod(6,3)+prod(6,4))
   2438         prod(13,1) = extpctn * (prod(2,1)+prod(2,2)+prod(2,3)+prod(2,4)
   2439      +     +prod(3,1)+prod(3,2)+prod(3,3)+prod(3,4)+prod(4,1)+prod(4,2)
   2440      +     +prod(4,3)+prod(4,4)+prod(5,1)+prod(5,2)+prod(5,3)+prod(5,4)
   2441      +     +prod(7,1)+prod(7,2)+prod(7,3)+prod(7,4)+prod(8,1)+prod(8,2)
   2442      +     +prod(8,3)+prod(8,4))
   2443         prod(14,1) = extpctc * prod(9,1)
   2444         prod(15,1) = extpctm * prod(10,1)
   2445         prod(16,1) = extpcth * prod(11,1)

Page 46          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2446 
   2447 c Before removing the I/E's, sum the productions by purpose and income
   2448 c  for later use.
   2449 
   2450         do 1580 p = 1,11
   2451         do 1580 i = 1,4
   2452           tprod(p,i) = tprod(p,i) + prod(p,i)
   2453  1580   continue
   2454 
   2455 c Now remove the I/E share from the total, to calculate the I/I trips.
   2456 
   2457         do i = 1,4
   2458           prod(1,i) = (1.0 - extpctw) * prod(1,i)
   2459           prod(2,i) = (1.0 - extpctn) * prod(2,i)
   2460           prod(3,i) = (1.0 - extpctn) * prod(3,i)
   2461           prod(4,i) = (1.0 - extpctn) * prod(4,i)
   2462           prod(5,i) = (1.0 - extpctn) * prod(5,i)
   2463           prod(6,i) = (1.0 - extpctw) * prod(6,i)
   2464           prod(7,i) = (1.0 - extpctn) * prod(7,i)
   2465           prod(8,i) = (1.0 - extpctn) * prod(8,i)
   2466         end do
   2467         prod(9,1)  = (1.0 - extpctc) * prod(9,1)
   2468         prod(10,1) = (1.0 - extpctm) * prod(10,1)
   2469         prod(11,1) = (1.0 - extpcth) * prod(11,1)
   2470 
   2471         if (itaz.ge.begtr .and. itaz.le.endtr) then
   2472           write(6,9013) itaz,z(26,iz),extpctw,extpctn,extpcth,
   2473      +     ((extadj(i,j),i=1,5),j=1,2)
   2474  9013     format(/' TGMET Trace 9013: pct I/E calc. for zone ',i5,
   2475      +      '  Cordon dist= ',f6.2/
   2476      +      5x,'  ext pct for work, nonwk, HTK= ',3f10.6/'   ',
   2477      +      'ext adj: ',10f7.4/
   2478      +      '   I/I productions by purpose:')
   2479           do p = 1,11
   2480             write(6,9019) purcode(p),(prod(p,i),i=1,4)
   2481  9019       format(' ',5x,'purpose ',a4,'  by inc 1-4: ',4f10.4)
   2482           end do
   2483       end if
   2484 
   2485 C Sum regional trip productions by purpose and income.  Sum them
   2486 C  by I/I (for later use in normalization) and by I/E
   2487 C  (for later use in cordon allocation).
   2488 
   2489         do 1592 p = 1,11
   2490         do 1592 i = 1,4
   2491           totiiprod(p,i) = totiiprod(p,i) + prod(p,i)
   2492  1592   continue
   2493         do p = 12,16
   2494           totextprod(p)  = totextprod(p)  + prod(p,1)
   2495         end do
   2496 
   2497 C Write productions by purpose and income to a temporary
   2498 C  scratch file.
   2499 
   2500         write(12,1595) iz,((prod(p,i),i=1,4),p=1,11),
   2501      +    (prod(p,1),p=12,16)
   2502  1595   format(i5,49f12.6)

Page 47          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2503 
   2504 C--------------------------------------------------------------------
   2505 C Now, on to attractions.
   2506 C  Calculate initial I/I attractions by purpose.  Apply
   2507 C  regression equations.  Get initial regional totals by purpose.
   2508 C  For the NHB and Truck purposes (6-11), the originally calibrated
   2509 C  attraction model coefficients have been already divided by 2,
   2510 C  in order to convert total trip ends to true attractions.
   2511 C Also, adjust attractions by Area Type and factor in the
   2512 C  global adjustment factor.
   2513 
   2514         do 1600 p = 1,11
   2515         
   2516           sattr(p,1)  = arate(p,1) * z(5,iz)  + arate(p,2) * z(3,iz)
   2517      1                + arate(p,3) * z(7,iz)  + arate(p,4) * z(8,iz)
   2518      2                + arate(p,5) * z(9,iz)  + arate(p,6) * z(10,iz)
   2519      3                + arate(p,7) * z(11,iz) + arate(p,8) * z(12,iz)
   2520      4                + arate(p,9) * z(13,iz) + arate(p,10) * z(14,iz)
   2521      5                + arate(p,11) *z(16,iz) + arate(p,12) * z(17,iz)
   2522      6                + arate(p,13) *z(18,iz) + arate(p,14) * z(29,iz)
   2523      7                + arate(p,15) *z(6,iz)  + arate(p,16) * z(25,iz)
   2524 
   2525           sattr(p,1)  = sattr(p,1) * atfacta(p,atype) * tfactor(p)
   2526 
   2527 C For HBS, if there are no Retail employees, set attractions to zero.   
   2528      
   2529           if (p .eq. 4) then
   2530             if ((z(9,iz)+z(10,iz)) .lt. 1) sattr(4,1) = 0
   2531           endif
   2532 
   2533 C HBO, JTW, and NWK attraction equations contain a density term.  But if 
   2534 C   there are no HHs or jobs, set attractions to zero.
   2535 
   2536           if (p.eq.5 .or. p.eq.6 .or. p.eq.8) then
   2537 	      if ((z(5,iz)+z(15,iz)) .lt. 1) sattr(p,1) = 0
   2538 	    endif
   2539 
   2540  1600   continue
   2541 
   2542 C Special generator attractions.  Only need to check this if the flag
   2543 C  (Z(24,iz)) is > 0.  If SPECGENATTR is negative, replace the
   2544 C  previously calculated value with the absolute value of it.  If
   2545 C  it is positive, add it to
   2546 C  the previously calculated value.  The calculations are simpler than
   2547 C  for productions, because we haven't calculated the income split yet.
   2548 
   2549         if (z(24,iz) .gt. 0.5) then
   2550 
   2551           do 1670 p = 1,11
   2552             do 1665 zz = 1,30
   2553               m = specgenzone(zz,p)
   2554               if (m .eq. 0) cycle
   2555               n = tazzone(m)
   2556               if (n .eq. iz) then
   2557                 if (specgenattr(zz,p) .lt. 0) then
   2558                   sattr(p,1) = abs(specgenattr(zz,p))
   2559                 else

Page 48          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2560                   sattr(p,1) = sattr(p,1) + specgenattr(zz,p)
   2561                 end if
   2562 
   2563                 write(6,1675) m,purcode(p),specgenattr(zz,p)
   2564  1675           format(' TGMET 1675 (N): Special generator ',
   2565      +            'attractions used for TAZ ',i5/' purpose: ',a4,
   2566      +            '  value: ',i9/)
   2567 
   2568                 go to 1670
   2569               end if
   2570  1665       continue
   2571  1670     continue
   2572 
   2573         end if
   2574 
   2575 c Sum total attractions by purpose.  Do this twice to help the
   2576 c  normalization calculation, below.
   2577 
   2578         do p = 1,11
   2579           tattr1(p)   = tattr1(p)   + sattr(p,1)
   2580           tattr2(p)   = tattr2(p)   + sattr(p,1)
   2581         end do
   2582 
   2583         if (itaz.ge.begtr .and. itaz.le.endtr) then
   2584           totemp = 0
   2585           
   2586           write(6,9016) itaz,z(3,iz),z(4,iz),z(5,iz),z(7,iz),z(8,iz),
   2587      +      z(9,iz),z(10,iz),z(11,iz),z(12,iz),z(13,iz),z(14,iz),
   2588      +      z(15,iz),z(16,iz),z(17,iz),z(18,iz),atype,(sattr(p,1),p=1,11),
   2589      +      (atfacta(p,atype),p=1,11),z(29,iz),z(30,iz)
   2590  9016     format(/' TGMET Trace 9016: attraction calc. for zone ',i5/
   2591      +      5x,'POP_HHS= ',f6.0,'  POP_GRP= ',f6.0,' HH= ',f6.0,
   2592      +      '  LOIND= ',f6.0/3x,'  HIIND= ',f6.0,' RTL= ',f6.0,
   2593      +      '   HWY= ',f6.0,'   LOSVC= ',f6.0,'  HISVC= ',f6.0/3x,
   2594      +      '  OFFGOV= ',f6.0,'   EDUC= ',f6.0,'  EMP_TOT= ',f6.0,
   2595      +      '  STU_K8= ',f6.0,'  STU_HS= ',f6.0,'  STU_CU= ',f6.0/
   2596      +      ' ',5x,'Area Type= ',i2,'  Attr by purp= '/' ',2x,11f8.1/
   2597      +      ' ',5x,'Attr AT factors by purp: '/' ',11f7.4/
   2598      +      ' ',5x,'Density fcn, %RTL+HWY: ',f12.4,f7.4/)
   2599         end if
   2600 
   2601 C Some of the attraction models contain negative coefficients
   2602 C  and this may result in negative attractions being calculated for
   2603 C  some zones.  For such zones, set attractions to zero and
   2604 C  normalize the rest of the zones' attractions to match the correct
   2605 C  regional total (TATTR1(p)).  Do this by purpose.
   2606 
   2607         do p = 1,11
   2608           if (sattr(p,1) .lt. 0.0) then
   2609             tattr2(p) = tattr2(p) - sattr(p,1)
   2610             sattr(p,1)  = 0.0
   2611           end if
   2612         end do
   2613 
   2614 c        if (itaz.ge.begtr .and. itaz.le.endtr) then
   2615 c          write(6,9018) itaz,(tattr1(p),p=1,11),(tattr2(p),p=1,11)
   2616 c 9018     format(' TGMET Trace 9018: taz=',i5,'  TATTR1(p)='/5x,

Page 49          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2617 c     +      11f8.0/5x,'TATTR2(p)='/5x,11f8.0/)
   2618 c        end if
   2619 
   2620 C Write attractions by purpose to a temporary scratch file.
   2621 
   2622         write(13,1720) iz,(sattr(p,1),p=1,11)
   2623  1720   format(i5,11f14.6)
   2624 
   2625 C End of seventh loop.
   2626 
   2627  1800 continue
   2628       close (9)
   2629       close (10)
   2630       close (11)
   2631       if (repo(6)) then
   2632         rewind 8
   2633       else
   2634         close (8)
   2635       end if
   2636 
   2637 C--------------------------------------------------------------------
   2638 C Calculate percent of HBW/HBS/HBO person trip productions by purpose
   2639 C  and income, by county.
   2640 
   2641       do 1850 c = 1,16
   2642         y1 = copct(c,1,1) + copct(c,1,2) + copct(c,1,3) + copct(c,1,4)
   2643         y4 = copct(c,4,1) + copct(c,4,2) + copct(c,4,3) + copct(c,4,4)
   2644         y5 = copct(c,5,1) + copct(c,5,2) + copct(c,5,3) + copct(c,5,4)
   2645         do i = 1,4
   2646           if (y1 .gt. 0.0001) then
   2647             copct(c,1,i) = copct(c,1,i)/y1
   2648           else
   2649             copct(c,1,i) = 0.25
   2650           endif
   2651           if (y4 .gt. 0.0001) then
   2652             copct(c,4,i) = copct(c,4,i)/y4
   2653           else
   2654             copct(c,4,i) = 0.25
   2655           endif
   2656           if (y5 .gt. 0.0001) then
   2657             copct(c,5,i) = copct(c,5,i)/y5
   2658           else
   2659             copct(c,5,i) = 0.25
   2660           endif
   2661         end do
   2662  1850 continue
   2663 
   2664       if (begtr.gt.0 .or. endtr.gt.0) then
   2665         write(6,9017) ((copct(c,1,i),i=1,4),c=1,16),
   2666      +    ((copct(c,4,i),i=1,4),c=1,16),
   2667      +    ((copct(c,5,i),i=1,4),c=1,16),
   2668      +    (tattr1(p),p=1,11),(tattr2(p),p=1,11)
   2669  9017   format(' TGMET Trace 9017: co. production split calc.'/
   2670      +    5x,'HBW % by co and inc: '/
   2671      +    16(5x,4f7.4/),5x,'HBS % by co and inc: '/16(5x,4f7.4/),
   2672      +    5x,'HBO % by co and inc: '/16(5x,4f7.4/),
   2673      +    5x,'TATTR1(purp): '/3x,11f9.0/5x,'TATTR2(purp): '/3x,11f9.0/)

Page 50          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2674 
   2675         write(6,9039) ((totiiprod(p,i),p=1,8),i=1,4),
   2676      1    (totextprod(p),p=12,13)
   2677  9039   format(' TGMET Trace 9039: total productions by purp:'/
   2678      1    ' I/I,I1:',8f8.0/' I/I,I2:',8f8.0/' I/I,I3:',8f8.0/
   2679      2    ' I/I,I4:',8f8.0/' I/E:   ',2f8.0/)
   2680       end if
   2681 
   2682 C--------------------------------------------------------------------
   2683 C Rewind attractions file, and start eighth loop.
   2684 
   2685       rewind 13
   2686       write(*,'(/)')
   2687       do 3000 iz = 1,intzones
   2688         itaz = z(1,iz)
   2689         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,2000) itaz
   2690  2000   format('+','TGMET 2000 (N): Loop  8 - processing zone ',i5)
   2691 
   2692 C Read attractions from scratch file.
   2693 
   2694         read(13,1720) k,(sattr(p,1),p=1,11)
   2695         if (k .ne. iz) then
   2696           write(6,2050) 13,z(1,k),z(1,iz)
   2697  2050     format(' TGMET 2050 (F): Problem with scratch file ',i2/
   2698      +      '  Reading data for TAZ ',i5,'  Expecting data for TAZ ',
   2699      +      i5,'  I quit.'/)
   2700           stop "A fatal error has occurred.  Please check listing file."
   2701         end if
   2702 
   2703 C Normalize attractions to the proper totals, by purpose, to account
   2704 C  for possible initial negative attractions.
   2705 
   2706         do p = 1,11
   2707           sattr(p,1) = sattr(p,1) * tattr1(p)/tattr2(p)
   2708         end do
   2709 
   2710 C Split HBW, HBS, and HBO attractions by income.  Split is based on
   2711 C  county-level production split by purpose, modified by the variables
   2712 C  mentioned above.  Assume we can determine the county based on the
   2713 C  zone number.
   2714 c  Variables are: 1=bias 1, 2=bias 2, 3=bias 3, 4=CBD dummy (0/1),
   2715 c   5=% loind, 6=% hiind, 7=%rtl, 8=% hwy, 9=% losvc, 10=% educ.  
   2716 
   2717         c = (itaz-mod(itaz,1000))/1000 + 1
   2718         if (itaz .gt. 10000 .and. itaz .lt. 11999) c = 11
   2719         ploind = 0
   2720 	  phiind = 0
   2721 	  prtl   = 0
   2722 	  phwy   = 0
   2723         plosvc = 0
   2724 	  peduc  = 0
   2725 	  if (z(15,iz) .gt. 0) then
   2726 	    ploind = z(7,iz)/z(15,iz)
   2727 	    phiind = z(8,iz)/z(15,iz)
   2728 	    prtl   = z(9,iz)/z(15,iz)
   2729 	    phwy   = z(10,iz)/z(15,iz)
   2730 	    plosvc = z(11,iz)/z(15,iz)

Page 51          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2731 	    peduc  = z(14,iz)/z(15,iz)
   2732         endif
   2733 	  do 2120 p = 1,5
   2734           if (p .eq. 2 .or. p .eq. 3) then
   2735             attr(p,1) = sattr(p,1)
   2736             cycle
   2737           end if
   2738           do i = 1,3
   2739 	      u(i) = acoefas(p,i)        + acoefas(p,4)*z(25,iz)
   2740      +           + acoefas(p,5)*ploind + acoefas(p,6)*phiind
   2741      +           + acoefas(p,7)*prtl   + acoefas(p,8)*phwy
   2742      +           + acoefas(p,9)*plosvc + acoefas(p,10)*peduc
   2743 
   2744             eu(i) = copct(c,p,i) * exp(u(i))
   2745 
   2746             if (itaz.ge.begtr .and. itaz.le.endtr) then
   2747               write(6,9057) itaz,purcode(p),i,acoefas(p,i),
   2748      +          copct(c,p,i),u(i),eu(i)
   2749  9057         format(' TGMET Trace 9057: taz=',i5,' purp: ',a4,' inc: ',
   2750      1          i1/'  ACOEFAS(p,i): ',f9.4,'  COPCT: ',f9.4,' U: ',f9.4,
   2751      2          ' EU: ',f9.4/)
   2752             end if
   2753 
   2754           end do
   2755 
   2756 c Income 4 is the "floater" -- the one choice in the choice set
   2757 c  that does not use coefficients.
   2758 
   2759           eu(4) = copct(c,p,4)
   2760           sumeu = eu(1) + eu(2) + eu(3) + eu(4)
   2761 
   2762 C Calculate attractions by income.
   2763 
   2764           if (itaz.ge.begtr .and. itaz.le.endtr) then
   2765             write(6,9027) itaz,purcode(p),(acoefas(p,v),v=1,10),sumeu
   2766  9027       format(' TGMET Trace 9027: taz=',i5,
   2767      +        ' Attractions by income calc.: ',a4/'  ACOEFAS ',
   2768      +        'coefs(1-10)= '/10f10.3/' SUMEU = ',f10.5/)
   2769           end if
   2770 
   2771           do i = 1,4
   2772             npct(i) = eu(i)/sumeu
   2773             attr(p,i) = npct(i) * sattr(p,1)
   2774           end do
   2775 
   2776           if (itaz.ge.begtr .and. itaz.le.endtr) then
   2777             write(6,9014) itaz,purcode(p),(copct(c,p,i),i=1,4),
   2778      +         (eu(i),i=1,4),(npct(i),i=1,4),(attr(p,i),i=1,4)
   2779  9014       format(' TGMET Trace 9014: taz=',i5,'  attractions by inc,',
   2780      +         ' purp: ',a4/
   2781      +         ' county pct. by inc, 1-4:   ',4f9.5/
   2782      +         ' e(U) by inc, 1-4:          ',4f9.5/
   2783      +         ' revised  pct. by inc, 1-4: ',4f9.5/
   2784      +         ' new attractns by inc, 1-4: ',4f9.3/)
   2785           end if
   2786 
   2787  2120   continue

Page 52          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2788 
   2789 C
   2790 C Do not split NH attractions by income.  Put them all in the
   2791 C  "income 1" category and fill the other categories with zeroes.
   2792 
   2793         do p = 6,11
   2794           attr(p,1) = sattr(p,1)
   2795           attr(p,2) = 0.0
   2796           attr(p,3) = 0.0
   2797           attr(p,4) = 0.0
   2798         end do
   2799 
   2800 C Sum HB attractions by income.
   2801 
   2802         do p = 1,5
   2803           do i = 1,4
   2804             tattr3(p,i) = tattr3(p,i) + attr(p,i)
   2805           end do
   2806         end do
   2807         do p = 6,11
   2808           tattr3(p,1) = tattr3(p,1) + attr(p,1)
   2809         end do
   2810 
   2811 c 10 Jun 05 change: new E/I function
   2812 C Apply E/I model to calculate E/I attractions.  E/I model
   2813 C  estimates the % of total attractions that are externally produced,
   2814 C  as a parabolic function of the zone's distance to the cordon.  This
   2815 c  is slightly different than the I/E model.  The I/E model splits
   2816 c  total productions into I/E and I/I:
   2817 c    I/E prod = total prod * I/E%
   2818 c    I/I prod = total prod * (1 - I/E%)
   2819 c  In the case of E/I trips, we don't have the total to start with,
   2820 c  only the I/I value.  Thus, the equations become:
   2821 c     total attr = I/I attr / (1 - E/I%)
   2822 c     E/I attr   = total attr * E/I%
   2823 c or: E/I attr   = I/I attr * E/I% / (1 - E/I%)
   2824 
   2825 c Set an arbitrary upper limit of 75% on the E/I share.  Use same
   2826 c  equation for Work and Non-Work.
   2827 
   2828         extw = 0.55 - 0.057*z(26,iz) + 0.0015*z(26,iz)*z(26,iz)
   2829         extn = extw
   2830         extpctw = extw * extadj(1,2)
   2831         extpctn = extn * extadj(2,2)
   2832 
   2833         extpctw = amin1(extpctw,0.75)
   2834         extpctn = amin1(extpctn,0.75)
   2835 
   2836         csum       = attr(1,1) + attr(1,2) + attr(1,3) + attr(1,4)
   2837      1             + attr(6,1)
   2838         attr(17,1) = csum * extpctw / (1.0 - extpctw)
   2839         csum       = attr(2,1) + attr(3,1) + attr(4,1) + attr(4,2)
   2840      1             + attr(4,3) + attr(4,4) + attr(5,1) + attr(5,2)
   2841      2             + attr(5,3) + attr(5,4) + attr(7,1) + attr(8,1)
   2842         attr(18,1) = csum * extpctn / (1.0 - extpctn)
   2843 
   2844 c Use the Work E/I fractions for COM/truck, modified to match the

Page 53          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2845 c  base year cordon data.  Use different upper limit here: 95% E/I.
   2846 c  Again, somewhat arbitrary.
   2847 
   2848         extpctc = extw * extadj(3,2)
   2849         extpctm = extw * extadj(4,2)
   2850         extpcth = extw * extadj(5,2)
   2851         extpctc = amin1(extpctc,0.95)
   2852         extpctm = amin1(extpctm,0.95)
   2853         extpcth = amin1(extpcth,0.95)
   2854 
   2855         attr(19,1) = attr(9,1)  * extpctc / (1.0 - extpctc)
   2856         attr(20,1) = attr(10,1) * extpctm / (1.0 - extpctm)
   2857         attr(21,1) = attr(11,1) * extpcth / (1.0 - extpcth)
   2858 
   2859         if (itaz.ge.begtr .and. itaz.le.endtr) then
   2860           write(6,9026) itaz,z(26,iz),extpctw,extpctn,extpcth
   2861  9026     format(/' TGMET Trace 9026: pct E/I calc. for zone ',i5,
   2862      +     '  cordon dist= ',f6.2/'  ext pct (wk,nw,ht)= ',3f9.6/'   ',
   2863      +     'I/I attractions by purpose:')
   2864           do p = 1,11
   2865             write(6,9033) purcode(p),(attr(p,i),i=1,4)
   2866  9033       format(' ',5x,'purpose ',a4,'  by inc 1-4: ',4f11.4)
   2867           end do
   2868           do p = 17,21
   2869             write(6,9058) purcode(p),attr(p,1)
   2870  9058       format(' ',5x,'purpose ',a4,f11.4)
   2871           end do
   2872         end if
   2873 
   2874 C Sum regional I/I attractions for later use in normalization.  Sum
   2875 C  regional E/I person attractions for later use in cordon allocation.
   2876 
   2877         do 2310 p = 1,11
   2878         do 2310 i = 1,4
   2879           totiiattr(p,i) = totiiattr(p,i) + attr(p,i)
   2880  2310   continue
   2881 
   2882         do p = 17,21
   2883           totextattr(p)  = totextattr(p)  + attr(p,1)
   2884         end do
   2885 
   2886 C Write attractions by income and purpose out to a new
   2887 C  scratch file.
   2888 
   2889         write(14,2400) iz,((attr(p,i),i=1,4),p=1,11),
   2890      +    (attr(p,1),p=17,21)
   2891  2400   format(i5,49f12.6)
   2892 
   2893 C End of eighth ZONES loop.
   2894 
   2895  3000 continue
   2896       close (13)
   2897       close (15)
   2898 
   2899       if (begtr.gt.0 .or. endtr.gt.0) then
   2900         write(6,9040) ((totiiattr(p,i),p=1,11),i=1,4),
   2901      1    (totextattr(p),p=17,21)

Page 54          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2902  9040   format(' TGMET Trace 9040: total attractions by purp:'/
   2903      1    ' I/I,I1:',11f9.0/' I/I,I2:',11f9.0/' I/I,I3:',11f9.0/
   2904      2    ' I/I,I4:',11f9.0//' E/I:   ',5f9.0/)
   2905       end if
   2906 
   2907 C Rewind attractions scratch file 14 and position it at the start of
   2908 C  the external station records.
   2909 
   2910 c      rewind 14
   2911 c      do iz = 1,intzones
   2912 c        read(14,2400) iz,((attr(p,i),i=1,4),p=1,11),
   2913 c     +    (attr(p,1),p=17,21)
   2914 c      end do
   2915 
   2916 C--------------------------------------------------------------------
   2917 c Apply NHB Non-Resident Model ("secondary NHB trips") here.  This
   2918 c  says that the non-resident (E/I) travellers make internal NHB
   2919 c  trips at the same rate as resident (I/I + I/E) travellers.
   2920 c 22 Aug 05: do this only if DO_NONRES is True.
   2921 c First, get the regional resident (I/I + I/E) NHB/HB ratio.
   2922 
   2923       nhbadj = 1.0
   2924       if (do_nonres) then
   2925       do i = 1,4
   2926         do p = 1,5
   2927           hbtot = hbtot + tprod(p,i)
   2928         end do
   2929 
   2930         do p = 6,8
   2931           nhbtot = nhbtot + tprod(p,i)
   2932         end do
   2933 
   2934       end do
   2935       ratio = nhbtot/hbtot
   2936 
   2937 c Now calculate the non-resident NHB trips as this ratio, times the
   2938 c  sum of the work and non-work E/I person trips.
   2939 
   2940       eipsn = totextattr(17) + totextattr(18)
   2941       nrtot = ratio * eipsn
   2942 
   2943 c Finally, the NHB adjustment factor is the ratio of the non-resident
   2944 c  NHB trips to the resident NHB trips, plus 1.  Apply this adjustment
   2945 c  to all 3 NHB purpose trip end totals.
   2946 
   2947       nhbadj = nrtot/nhbtot + 1.0
   2948 
   2949       if (begtr .gt. 0 .or. endtr .gt. 0) then
   2950         write(6,9046) hbtot,nhbtot,ratio,eipsn,nrtot,nhbadj,
   2951      +   ((tprod(p,i),p=1,8),i=1,4)
   2952  9046   format(' TGMET Trace 9046: Non-resident NHB calculation'/
   2953      +    ' HB total:      ',f12.0/' NHB total:     ',f12.0/
   2954      +    ' NHB/HB ratio:  ',f12.3/' E/I person:    ',f12.0/
   2955      +    ' Non-Res NHB:   ',f12.0/' NR NHB adj fac:',f12.3//
   2956      +    ' Total resident productions (I/I + I/E) by purp:'/
   2957      1    ' I1:',8f8.0/' I2:',8f8.0/' I3:',8f8.0/
   2958      2    ' I4:',8f8.0/)

Page 55          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   2959       end if
   2960       end if
   2961 
   2962 C--------------------------------------------------------------------
   2963 C Open trip end output files.  There are 2 such files: unit 7 is
   2964 c  Productions, unit 8 is Attractions.  Open these files for output.
   2965 c  Also, open the associated dictionary files for TransCAD.
   2966 
   2967       open(7,file=prodfile,status='unknown',form='formatted')
   2968       open(8,file=attrfile,status='unknown',form='formatted')
   2969 
   2970 c Construct names of Production and Attraction DCT files, then open
   2971 c  the files for output.
   2972 
   2973       strlth   = len_trim(prodfile) - 4
   2974       proddict = prodfile(1:strlth) // '.DCT'
   2975       strlth   = len_trim(attrfile) - 4
   2976       attrdict = attrfile(1:strlth) // '.DCT'
   2977 
   2978       open(17,file=proddict,status='unknown',form='formatted')
   2979       open(18,file=attrdict,status='unknown',form='formatted')
   2980 
   2981 C--------------------------------------------------------------------
   2982 C Now, we must allocate the I/E attractions and the E/I productions
   2983 C  among the external stations.  This is done in proportion to the
   2984 C  estimated future total daily External (I/E + E/I) 2-way volume at
   2985 C  each station.  These volumes are handled separately, by type.
   2986 C We start by calculating an estimated External volume at each
   2987 c  external station.  This is the total input volume, multiplied by
   2988 c  the base year E/E trip share, by station and type.  These volumes
   2989 c  are used to allocate the I/E attractions to the stations and the
   2990 c  E/I productions to the stations.  Then, we calculate the actual
   2991 c  future E/E volume by station as the input total, less the I/E attrs,
   2992 c  less the E/I prods.  Then, calculate the E/E growth factors as
   2993 c  the ratio of future to base 2000 E/E volume, by station.
   2994 c All calculations are stratified by 1 of 2 vehicle type groupings:
   2995 c  TYPE4: 1=auto (PC), 2=COM, 3=MTK, 4=HTK.
   2996 c  TYPE5: 1=work auto, 2=nonwk auto, 3=COM, 4=MTK, 5=HTK.
   2997 
   2998 C Here is where the resulting numbers are stored:
   2999 c  BASVOL(type4,station)        base 2000 total cordon volume (veh)
   3000 c  STAVOL(type4,station)        input forecast yr tot cordon vol (veh)
   3001 c  BTHRUV(type4,station)        base 2000 E/E trip volume (veh)
   3002 c  BTHRUP(type4,station)        base 2000 E/E trip share (fraction)
   3003 c  EXTVOL(type5,station)        initial fcast yr external volume (veh)
   3004 c  TOTEXT(type5)                total initial fcast yr ext vol (veh)
   3005 c  EXTPROD(type5,station)       final fcast yr external prods (psn)
   3006 c  EXTATTR(type5,station)       final fcast yr external attrs (psn)
   3007 c  STATRIPENDS(type5,station)   final fcast yr ext trip ends (veh)
   3008 c  FTHRUV(type4,station)        forecast year E/E trip volume (veh)
   3009 c  XXFACT(type4,station)        forecast year E/E trip factor
   3010 
   3011 C First, calculate initial estimate of E/E trips by station, using the
   3012 C  Base year data. Then, calculate each station's share of the initial
   3013 c  future I/E + E/I cordon volume by vehicle type, and sum it by type.
   3014 
   3015       do 3200 m = 1,nsta

Page 56          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3016         do 3100 p = 1,4
   3017           bthrup(p,m) = 0.0
   3018           if (basvol(p,m) .gt. 0.01) bthrup(p,m) =
   3019      +        bthruv(p,m)/basvol(p,m)
   3020           extvol(p,m) = basvol(p,m) * (1.0 - bthrup(p,m))
   3021           totext(p)   = totext(p) + extvol(p,m)
   3022  3100   continue
   3023 
   3024         if (begtr .gt. 0) then
   3025           n = z(1,intzones + m)
   3026           write(6,9055) n,(bthrup(p,m),p=1,4),(extvol(p,m),p=1,4),
   3027      +      (totext(p),p=1,4)
   3028  9055     format(' TGMET Trace 9055: sta= ',i5/
   3029      +      '  BTHRUP(p)=',4f7.4/'  EXTVOL(p)=',4f9.2/
   3030      +      '  TOTEXT(p)=',4f9.2/)
   3031         end if
   3032 
   3033  3200 continue
   3034 
   3035 c The input cordon volumes for Auto do not distinguish between Work
   3036 c  and Non-Work.  Use the total Auto volume to allocate the Work and
   3037 c  Non-Work values.  Must shift from TYPE4 to TYPE5 indexing also
   3038 c  (TYPE4: auto, com, mtk, htk; TYPE5: wk auto, nw auto, com, mtk, htk)
   3039 
   3040       do p5 = 5,2,-1
   3041         p4 = max(p5-1,1)
   3042         do m = 1,nsta
   3043           extvol(p5,m) = extvol(p4,m)
   3044         end do
   3045         totext(p5) = totext(p4)
   3046       end do
   3047 
   3048 c Zero out the I/I cells of the PROD and ATTR arrays.
   3049 
   3050       do p = 1,11
   3051         do i = 1,4
   3052           prod(p,i) = 0.0
   3053           attr(p,i) = 0.0
   3054         end do
   3055       end do
   3056 
   3057       if (begtr .gt. 0) then
   3058         write(6,9056) (totext(p),p=1,5),(totextprod(p),p=12,16),
   3059      +    (totextattr(p),p=17,21)
   3060  9056   format(' TGMET Trace 9056'/'  TOTEXT(type):     ',5f11.2/
   3061      +    '  TOTEXTPROD(type): ',5f11.2/
   3062      +    '  TOTEXTATTR(type): ',5f11.2/)
   3063       end if
   3064 
   3065 C  Allocate I/E attractions and E/I productions to stations, by
   3066 C    vehicle type.
   3067 c    Divide person
   3068 C    trips in cars by average external vehicle occupancy to get
   3069 C    vehicle trips.  Sum trip ends across purposes.
   3070 
   3071       do 3250 m = 1,nsta
   3072         do p = 1,5

Page 57          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3073           extattr(p,m) = totextprod(p+11) * extvol(p,m)/totext(p)
   3074           extprod(p,m) = totextattr(p+16) * extvol(p,m)/totext(p)
   3075         end do
   3076 
   3077         statripends(1,m) = extattr(1,m)/iewrkavo + extprod(1,m)/eiwrkavo
   3078         statripends(2,m) = extattr(2,m)/ienwkavo + extprod(2,m)/einwkavo
   3079         do p = 3,5
   3080           statripends(p,m) = extattr(p,m) + extprod(p,m)
   3081         end do
   3082 
   3083 C Store the cordon station external person trip ends in the PROD and
   3084 C  ATTR arrays.  Put them all in Income 1.
   3085 
   3086         do p = 1,5
   3087           prod(p+11,1) = extprod(p,m)
   3088           attr(p+16,1) = extattr(p,m)
   3089         end do
   3090 
   3091         n = intzones + m
   3092 
   3093         write(12,1595) n,((prod(p,i),i=1,4),p=1,11),
   3094      +    (prod(p,1),p=12,16)
   3095 
   3096         write(14,2400) n,((attr(p,i),i=1,4),p=1,11),
   3097      +    (attr(p,1),p=17,21)
   3098  3250 continue
   3099 
   3100 C--------------------------------------------------------------------
   3101 C Here we calculate the E/E vehicle trip growth factors, as follows:
   3102 C   1) Future Through Trip Ends = Future Total Cordon Veh. Trip Ends
   3103 C                               - Future External Veh. Trip Ends
   3104 C   2) Growth Factor = Future Through Veh. Trip Ends
   3105 C                               / Base Through Veh. Trip Ends
   3106 C   This is done separately by vehicle type (TYPE4), for each external
   3107 C   station, but not separately by direction.
   3108 
   3109       do 3300 m = 1,nsta
   3110         n = z(1,intzones + m)
   3111         fthruv(1,m) = stavol(1,m) - statripends(1,m) - statripends(2,m)
   3112 
   3113         do p = 2,4
   3114           fthruv(p,m) = stavol(p,m) - statripends(p+1,m)
   3115         end do
   3116 
   3117         do p = 1,4
   3118           xxfact(p,m) = 1.0
   3119           if (bthruv(p,m) .gt. 0.01) xxfact(p,m)=fthruv(p,m)/bthruv(p,m)
   3120 
   3121           if (fthruv(p,m) .lt. 0.0) then
   3122             if (fthruv(p,m).lt.-2.0) write(6,3260) p,n,fthruv(p,m)
   3123  3260       format(' TGMET 3260 (W): Type ',i1,' through trips at ',
   3124      +        'station ',i5,' are negative: ',f10.2/
   3125      +        5x,'Re-set to zero.'/)
   3126             fthruv(p,m) = 0.0
   3127             xxfact(p,m) = 1.0
   3128           end if
   3129         end do

Page 58          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3130         if (begtr .gt. 0) then
   3131           write(6,9041) n,(fthruv(p,m),p=1,4),
   3132      1      (extprod(p,m),p=1,5),(extattr(p,m),p=1,5),
   3133      2      (statripends(p,m),p=1,5),(xxfact(p,m),p=1,4)
   3134  9041     format(' TGMET Trace 9041: sta=',i5,'  FTHRUV:',
   3135      1      4f9.1/' EXTPROD (type):   ',5f10.2/
   3136      2      ' EXTATTR (type):   ',5f10.2/
   3137      4      ' STATRIPENDS(type): ',5f10.2/' XXFACT(type): ',4f10.2/)
   3138         end if
   3139 
   3140  3300 continue
   3141 
   3142 C Re-use unit 13 as a new scratch file.
   3143 
   3144       close (13)
   3145       if (savescr) then
   3146         open(13,file='temp13a.scr',status='unknown',form='formatted')
   3147       else
   3148         open(13,status='scratch',form='formatted')
   3149       end if
   3150 
   3151 C--------------------------------------------------------------------
   3152 C Rewind production and attraction files and start ninth loop
   3153 C  to normalize I/I trip ends.  Normalize I/I HB trips to the
   3154 C  production total, by income.  For the NHB purposes, force the
   3155 C  attraction total to equal the production total.  Then set the
   3156 C  productions by zone equal to the adjusted attractions by zone.
   3157 C  Normalization should not be needed for COM and truck trips, but
   3158 C  do it anyway just to be safe.
   3159 c  Also, apply the non-resident NHB adjustment factor.
   3160 C The '3800' loop covers internal zones only.
   3161 
   3162       rewind 12
   3163       rewind 14
   3164       write(*,'(/)')
   3165       do 3800 iz = 1,intzones
   3166         itaz = z(1,iz)
   3167         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,3400) itaz
   3168  3400   format('+','TGMET 3400 (N): Loop  9 - processing zone ',i5)
   3169 
   3170 C Read productions from scratch file.
   3171 
   3172         read(12,1595) n,((prod(p,i),i=1,4),p=1,11),
   3173      +    (prod(p,1),p=12,16)
   3174 
   3175 C Read attractions from scratch file.  Normalize all I/I
   3176 C  attractions to the production total by income.
   3177 
   3178         read(14,2400) k,((attr(p,i),i=1,4),p=1,11),
   3179      +    (attr(p,1),p=17,21)
   3180 
   3181         do p = 1,5
   3182           if (p .eq. 2 .or. p .eq. 3) then
   3183             tempp = totiiprod(p,1) + totiiprod(p,2) + totiiprod(p,3) +
   3184      +              totiiprod(p,4)
   3185             tempa = totiiattr(p,1) + totiiattr(p,2) + totiiattr(p,3) +
   3186      +              totiiattr(p,4)

Page 59          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3187             if (tempa .lt. 0.001) cycle
   3188             attr(p,1) = attr(p,1) * tempp/tempa
   3189 
   3190           else
   3191 
   3192             do i = 1,4
   3193               attr(p,i) = attr(p,i) * totiiprod(p,i)/totiiattr(p,i)
   3194             end do
   3195           end if
   3196         end do
   3197 
   3198 C For NHB, COM, and truck, don't normalize by income.
   3199 
   3200         do p = 6,11
   3201           tempp = totiiprod(p,1) + totiiprod(p,2) + totiiprod(p,3)
   3202      1          + totiiprod(p,4)
   3203           tempa = totiiattr(p,1) + totiiattr(p,2) + totiiattr(p,3)
   3204      1          + totiiattr(p,4)
   3205 
   3206           if (tempa .lt. 0.001) cycle
   3207           attr(p,1) = attr(p,1) * tempp/tempa
   3208 
   3209 c Apply non-resident NHB adjustment.
   3210 
   3211           if (p .le. 8) attr(p,1) = nhbadj * attr(p,1)
   3212 
   3213         end do
   3214 
   3215 C Set NHB I/I productions = NHB I/I normalized attractions by zone.
   3216 C  All NHB attractions are already stored in Income 1.  Zero out
   3217 C  the previously calculated NHB Productions for Incomes 2-4.
   3218 
   3219         do p = 6,8
   3220           prod(p,1) = attr(p,1)
   3221           prod(p,2) = 0.0
   3222           prod(p,3) = 0.0
   3223           prod(p,4) = 0.0
   3224         end do
   3225 
   3226 c Sum the productions by income into "income 1" for SCH and HBU.
   3227 c  We're not splitting those purposes by income.
   3228 
   3229         prod(2,1) = prod(2,1) + prod(2,2) + prod(2,3) + prod(2,4)
   3230         prod(2,2) = 0.0
   3231         prod(2,3) = 0.0
   3232         prod(2,4) = 0.0
   3233 
   3234         prod(3,1) = prod(3,1) + prod(3,2) + prod(3,3) + prod(3,4)
   3235         prod(3,2) = 0.0
   3236         prod(3,3) = 0.0
   3237         prod(3,4) = 0.0
   3238 
   3239 C--------------------------------------------------------------------
   3240 C Create output Production/Attraction files.  First,
   3241 C  write Productions.  For the 6 NHB/COM/truck purposes,
   3242 C  Productions are defined as equal to Attractions.
   3243 C Write the income-based HB purposes by income.

Page 60          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3244 
   3245         write(7,3520) itaz,iz,(prod(1,i),i=1,4),prod(2,1),
   3246      +    prod(3,1),((prod(p,i),i=1,4),p=4,5),
   3247      +    (prod(p,1),p=6,21)
   3248  3520   format(2i10,30f10.3)
   3249 
   3250 C Write unrounded, Real I/I productions and attractions to scratch
   3251 C  file 13.
   3252 
   3253         write(13,3750) iz,((prod(p,i),i=1,4),p=1,11),
   3254      +                    ((attr(p,i),i=1,4),p=1,11)
   3255  3750   format(i5,88f12.6)
   3256 
   3257 C End of ninth loop.
   3258 
   3259  3800 continue
   3260 
   3261 c Apply non-resident NHB adjustment to the NHB trip totals also,
   3262 c  for the reports.
   3263 
   3264       do i = 1,4
   3265         do p = 6,8
   3266           tprod(p,i) = tprod(p,i) * nhbadj
   3267         end do
   3268       end do
   3269 
   3270 C Start a new loop ('4000') on external stations to write out zero
   3271 C  trip end records as the Productions for external stations.
   3272 
   3273       do 4000 iz = intzones+1,zones
   3274         itaz = z(1,iz)
   3275         if (mod(itaz,10).eq.0 .or. iz.eq.zones) write(*,3400) itaz
   3276 
   3277 C Read records from scratch files.
   3278 
   3279         read(12,1595) n,((prod(p,i),i=1,4),p=1,11),
   3280      +    (prod(p,1),p=12,16)
   3281         read(14,2400) k,((attr(p,i),i=1,4),p=1,11),
   3282      +    (attr(p,1),p=17,21)
   3283 
   3284 c Stick in DUMMY array as a zero placeholder for external station
   3285 c  I/E productions.
   3286 
   3287         write(7,3520) itaz,iz,(prod(1,i),i=1,4),prod(2,1),
   3288      +    prod(3,1),((prod(p,i),i=1,4),p=4,5),
   3289      +    (prod(p,1),p=6,11),(dummy(p),p=1,5),(prod(p,1),p=12,16)
   3290 
   3291 C Write unrounded, Real productions and attractions to scratch
   3292 C  file 13.
   3293 
   3294         write(13,3850) iz,(prod(p,1),p=12,16),
   3295      +                    (attr(p,1),p=17,21)
   3296  3850   format(i5,10f12.6)
   3297  4000 continue
   3298 
   3299 C--------------------------------------------------------------------
   3300 C Rewind final attractions file and start tenth loop.  This is

Page 61          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3301 C  actually 2 loops: one for internal zones and one for external
   3302 C  stations.
   3303 
   3304       rewind 12
   3305       rewind 13
   3306       rewind 14
   3307       write(*,'(/)')
   3308       do 5600 iz = 1,intzones
   3309         itaz = z(1,iz)
   3310         if (mod(itaz,10).eq.0 .or. iz.eq.intzones) write(*,5150) itaz
   3311  5150   format('+','TGMET 5150 (N): Loop 10 - processing zone ',i5)
   3312 
   3313 C Read final attractions from scratch file (skip over the productions).
   3314 
   3315         read(13,4160) k,((attr(p,i),i=1,4),p=1,11)
   3316  4160   format(i5,528x,44f12.6)
   3317 
   3318 c Read external attractions from scratch file.
   3319 
   3320         read(14,4180) m,(attr(p,1),p=17,21)
   3321  4180   format(i5,528x,5f12.6)
   3322 
   3323 c Read production file to skip past the internal zones.
   3324 
   3325         read(12,1595) n,((prod(p,i),i=1,4),p=1,11),
   3326      +    (prod(p,1),p=12,16)
   3327 
   3328 C Write attraction data.  First, I/I HB purposes, by income.
   3329 
   3330         write(8,3520) itaz,iz,(attr(1,i),i=1,4),attr(2,1),
   3331      +    attr(3,1),((attr(p,i),i=1,4),p=4,5),
   3332      +    (attr(p,1),p=6,21)
   3333 
   3334 C End of internal zone loop.
   3335 
   3336  5600 continue
   3337 
   3338 C Don't rewind scratch files 12-14.  These files should already be
   3339 C  positioned at the start of the external stations.
   3340 
   3341 C Start external station loop.
   3342 
   3343       do 6000 iz = intzones+1,zones
   3344         itaz = z(1,iz)
   3345         if (mod(itaz,10).eq.0 .or. iz.eq.zones) write(*,5150) itaz
   3346 
   3347 C Again read final attractions from scratch file, starting with first
   3348 C  external station.
   3349 
   3350         read(13,3850) k,(prod(p,1),p=12,16),(attr(p,1),p=12,16)
   3351 
   3352 C Write zero external station attraction records to the trip files,
   3353 C  just to keep everything straight.
   3354 
   3355         do 5750 p = 1,11
   3356         do 5750 i = 1,4
   3357           attr(p,i) = 0.0

Page 62          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3358  5750   continue
   3359 
   3360         do p = 17,21
   3361           attr(p,1) = 0.0
   3362         end do
   3363 
   3364         write(8,3520) itaz,iz,(attr(1,i),i=1,4),attr(2,1),
   3365      +    attr(3,1),((attr(p,i),i=1,4),p=4,5),
   3366      +    (attr(p,1),p=6,11),(attr(p,1),p=12,16),
   3367      +    (attr(p,1),p=17,21)
   3368 
   3369 C End of external station loop.
   3370 
   3371  6000 continue
   3372 
   3373 C--------------------------------------------------------------------
   3374 C Write file of E/E trip growth factors, with DCT file.
   3375 
   3376       write(*,'('' Writing E/E factor file.'')')
   3377       open (16,file=xxfile,status='unknown',form='formatted')
   3378  
   3379       strlth = len_trim(xxfile) - 4
   3380       xxdict = xxfile(1:strlth) // '.DCT'
   3381       open (19,file=xxdict,status='unknown',form='formatted')
   3382 
   3383       do 6100 m = 1,nsta
   3384         iz = intzones + m
   3385         itaz = z(1,iz)
   3386 
   3387 C  The growth factors are to be used in a subsequent TransCAD Fratar
   3388 C   run.
   3389 
   3390         write(16,6020) itaz,(xxfact(p,m),p=1,4)
   3391  6020   format(i10,4f10.2)
   3392  6100 continue
   3393       close (16)
   3394 
   3395 c-------------------------------------------------------------------
   3396 c Write TransCAD dictionary (DCT) files.
   3397 
   3398       x = 320
   3399       write(17,7000) x
   3400  7000 format('Metrolina Zonal Production File, by Purpose'/i3)
   3401       write(17,7020)
   3402  7020 format('"TAZ",I,1,10,0,10,0,,,"",,Blank,'/
   3403      +       '"SEQ",I,11,10,0,10,0,,,"",,Blank,'/
   3404      +       '"HBW INC 1",R,21,10,0,10,3,,,"",,Blank,'/
   3405      +       '"HBW INC 2",R,31,10,0,10,3,,,"",,Blank,'/
   3406      +       '"HBW INC 3",R,41,10,0,10,3,,,"",,Blank,'/
   3407      +       '"HBW INC 4",R,51,10,0,10,3,,,"",,Blank,'/
   3408      +       '"SCH",R,61,10,0,10,3,,,"",,Blank,'/
   3409      +       '"HBU",R,71,10,0,10,3,,,"",,Blank,'/
   3410      +       '"HBS INC 1",R,81,10,0,10,3,,,"",,Blank,'/
   3411      +       '"HBS INC 2",R,91,10,0,10,3,,,"",,Blank,'/
   3412      +       '"HBS INC 3",R,101,10,0,10,3,,,"",,Blank,'/
   3413      +       '"HBS INC 4",R,111,10,0,10,3,,,"",,Blank,'/
   3414      +       '"HBO INC 1",R,121,10,0,10,3,,,"",,Blank,'/

Page 63          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3415      +       '"HBO INC 2",R,131,10,0,10,3,,,"",,Blank,'/
   3416      +       '"HBO INC 3",R,141,10,0,10,3,,,"",,Blank,'/
   3417      +       '"HBO INC 4",R,151,10,0,10,3,,,"",,Blank,')
   3418       write(17,7025)
   3419  7025 format('"NHB JTW",R,161,10,0,10,3,,,"",,Blank,'/
   3420      +       '"NHB ATW",R,171,10,0,10,3,,,"",,Blank,'/
   3421      +       '"NHB NWK",R,181,10,0,10,3,,,"",,Blank,'/
   3422      +       '"COM",R,191,10,0,10,3,,,"",,Blank,'/
   3423      +       '"MTK",R,201,10,0,10,3,,,"",,Blank,'/
   3424      +       '"HTK",R,211,10,0,10,3,,,"",,Blank,'/
   3425      +       '"I/E WORK AUTO",R,221,10,0,10,3,,,"",,Blank,'/
   3426      +       '"I/E NON-WORK AUTO",R,231,10,0,10,3,,,"",,Blank,'/
   3427      +       '"I/E COM",R,241,10,0,10,3,,,"",,Blank,'/
   3428      +       '"I/E MED TRK",R,251,10,0,10,3,,,"",,Blank,'/
   3429      +       '"I/E HVY TRK",R,261,10,0,10,3,,,"",,Blank,'/
   3430      +       '"E/I WORK AUTO",R,271,10,0,10,3,,,"",,Blank,'/
   3431      +       '"E/I NON-WORK AUTO",R,281,10,0,10,3,,,"",,Blank,'/
   3432      +       '"E/I COM",R,291,10,0,10,3,,,"",,Blank,'/
   3433      +       '"E/I MED TRK",R,301,10,0,10,3,,,"",,Blank,'/
   3434      +       '"E/I HVY TRK",R,311,10,0,10,3,,,"",,Blank,')
   3435 
   3436       write(18,7030) x
   3437  7030 format('Metrolina Zonal Attraction File, by Purpose'/i3)
   3438       write(18,7020)
   3439       write(18,7025)
   3440       
   3441       x = 50
   3442       write(19,7050) x
   3443  7050 format('Metrolina E/E Growth Factor File'/i3)
   3444       write(19,7070)
   3445  7070 format('"STATION",I,1,10,0,10,0,,,"",,Blank,'/
   3446      +       '"PC FACTOR",R,11,10,0,10,3,,,"",,Blank,'/
   3447      +       '"COM FACTOR",R,21,10,0,10,3,,,"",,Blank,'/
   3448      +       '"MTK FACTOR",R,31,10,0,10,3,,,"",,Blank,'/
   3449      +       '"HTK FACTOR",R,41,10,0,10,3,,,"",,Blank,'/)
   3450 
   3451 C--------------------------------------------------------------------
   3452 C Finished with the calculations.  Call subroutine to write reports
   3453 C  2-8.
   3454 
   3455       write(*,'('' Writing reports.'')')
   3456       call report
   3457 
   3458 C--------------------------------------------------------------------
   3459 C  All done.
   3460 
   3461       write(*,7100)
   3462  7100 format(' TGMET is finished.  Thanks for watching.')
   3463       stop
   3464       end

Page 64          Source Listing                  TGMET
2017-10-16 10:05 Entry Points                    tgmet2015_171013.for



ENTRY POINTS

  Name              
                    
 MAIN__             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  963                                                            962,991,992                       
 1000                       Label  1899                                                           1831                              
 1010                       Label  1909                                                           1908                              
 1020                       Label  1927                                                           1919,1920,1921                    
 105                        Label  974                                                            961                               
 110                        Label  975                                                            974                               
 1100                       Label  1944                                                           1906                              
 1102                       Label  1939                                                           1933,1934,1935                    
 1105                       Label  1968                                                           1966                              
 114                        Label  981                                                            973                               
 120                        Label  984                                                            982                               
 121                        Label  994                                                            991                               
 1210                       Label  2009                                                           2008                              
 1240                       Label  2044                                                           2023,2024,2025                    
 1250                       Label  2051                                                           2049                              
 1260                       Label  2062                                                           2058,2059,2060                    
 1270                       Label  2069                                                           2064,2065,2066,2067               
 1275                       Label  2074                                                           2073,2169                         
 1280                       Label  2101                                                           2093,2094,2095,2096               
 1282                       Label  2135                                                           2129,2130,2131                    
 1285                       Label  2149                                                           2148                              
 1290                       Label  2152                                                           2141,2142,2143,2144               
 1300                       Label  2154                                                           2006                              
 138                        Label  1002                                                           1000                              
 140                        Label  1012                                                           1011                              
 1410                       Label  2167                                                           2166                              
 1420                       Label  2179                                                           2175,2176                         
 144                        Label  1039                                                           1038                              
 1445                       Label  2191                                                           2188,2189                         
 145                        Label  1043                                                           1042                              
 1450                       Label  2193                                                           2186                              
 1470                       Label  2209                                                           2202,2203,2204                    
 150                        Label  1157                                                           1192                              
 1500                       Label  2222                                                           2219,2220                         
 1505                       Label  2231                                                           2227,2228                         
 1510                       Label  2237                                                           2233,2234                         
 1520                       Label  2239                                                           2224,2225                         
 1525                       Label  2249                                                           2248                              
 1530                       Label  2331                                                           2328,2329                         
 155                        Label  1169                                                           1159                              
 1565                       Label  2395                                                           2366                              
 1570                       Label  2398                                                           2365,2392                         
 1575                       Label  2388                                                           2387                              
 158                        Label  1199                                                           1157                              

Page 65          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1580                       Label  2453                                                           2450,2451                         
 1592                       Label  2492                                                           2489,2490                         
 1595                       Label  2502                                                           2500,3093,3172,3279,3325          
 160                        Label  1212                                                           1211                              
 1600                       Label  2540                                                           2514                              
 165                        Label  1241                                                           1240                              
 1665                       Label  2570                                                           2552                              
 1670                       Label  2571                                                           2551,2568                         
 1675                       Label  2564                                                           2563                              
 170                        Label  1280                                                           1279                              
 1720                       Label  2623                                                           2622,2694                         
 175                        Label  1301                                                           1300                              
 177                        Label  1304                                                           1303                              
 180                        Label  1303                                                           1307                              
 1800                       Label  2627                                                           2164                              
 182                        Label  1308                                                           1303                              
 185                        Label  1317                                                           1321                              
 1850                       Label  2662                                                           2641                              
 190                        Label  1318                                                           1317                              
 192                        Label  1322                                                           1317                              
 195                        Label  1337                                                           1331,1332                         
 200                        Label  1345                                                           1350,1363                         
 2000                       Label  2690                                                           2689                              
 2050                       Label  2697                                                           2696                              
 210                        Label  1364                                                           1348                              
 2120                       Label  2787                                                           2733                              
 215                        Label  1369                                                           1374,1387                         
 220                        Label  1388                                                           1372                              
 230                        Label  1397                                                           1419                              
 2310                       Label  2880                                                           2877,2878                         
 240                        Label  1406                                                           1405                              
 2400                       Label  2891                                                           2889,3096,3178,3281               
 250                        Label  1420                                                           1397                              
 255                        Label  1429                                                           1428                              
 260                        Label  1437                                                           1439,1456                         
 275                        Label  1442                                                           1441                              
 280                        Label  1457                                                           1437                              
 3000                       Label  2895                                                           2687                              
 302                        Label  1502                                                           1501                              
 3100                       Label  3022                                                           3016                              
 312                        Label  1525                                                                                             
 315                        Label  1531                                                                                             
 3200                       Label  3033                                                           3015                              
 3250                       Label  3098                                                           3071                              
 3260                       Label  3123                                                           3122                              
 3300                       Label  3140                                                           3109                              
 3400                       Label  3168                                                           3167,3275                         
 342                        Label  1570                                                                                             
 345                        Label  1576                                                                                             
 3520                       Label  3248                                                           3245,3287,3330,3364               
 370                        Label  1627                                                           1623,1624                         
 3750                       Label  3255                                                           3253                              
 380                        Label  1634                                                           1631,1632                         
 3800                       Label  3259                                                           3165                              
 3850                       Label  3296                                                           3294,3350                         

Page 66          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 4000                       Label  3297                                                           3273                              
 4160                       Label  3316                                                           3315                              
 4180                       Label  3321                                                           3320                              
 50                         Label  881                                                            880                               
 500                        Label  1679                                                           1639                              
 5150                       Label  3311                                                           3310,3345                         
 5600                       Label  3336                                                           3308                              
 5750                       Label  3358                                                           3355,3356                         
 6000                       Label  3371                                                           3343                              
 6020                       Label  3391                                                           3390                              
 610                        Label  1687                                                           1684,1685                         
 6100                       Label  3392                                                           3383                              
 630                        Label  1704                                                           1689                              
 640                        Label  1712                                                           1519                              
 650                        Label  1713                                                           1712,1754,1759,1796,1811,1836     
 660                        Label  1720                                                           1717,1718                         
 700                        Label  1724                                                           1499                              
 7000                       Label  3400                                                           3399                              
 7020                       Label  3402                                                           3401,3438                         
 7025                       Label  3419                                                           3418,3439                         
 7030                       Label  3437                                                           3436                              
 7050                       Label  3443                                                           3442                              
 7070                       Label  3445                                                           3444                              
 710                        Label  1749                                                           1748                              
 7100                       Label  3462                                                           3461                              
 715                        Label  1758                                                           1755,1756                         
 800                        Label  1771                                                           1746                              
 810                        Label  1790                                                           1789                              
 820                        Label  1801                                                           1798,1799                         
 830                        Label  1809                                                           1806,1807                         
 850                        Label  1824                                                           1787                              
 890                        Label  1834                                                           1833                              
 900                        Label  1870                                                           1851,1852,1867                    
 9002                       Label  1563                                                           1562                              
 9003                       Label  1608                                                           1607                              
 9004                       Label  1699                                                           1697                              
 9007                       Label  2313                                                           2312                              
 9008                       Label  1086                                                           1085                              
 9010                       Label  1736                                                           1735                              
 9011                       Label  1259                                                           1257                              
 9012                       Label  1289                                                           1288                              
 9013                       Label  2474                                                           2472                              
 9014                       Label  2779                                                           2777                              
 9015                       Label  1815                                                           1814                              
 9016                       Label  2590                                                           2586                              
 9017                       Label  2669                                                           2665                              
 9019                       Label  2481                                                           2480                              
 9022                       Label  2318                                                           2317                              
 9024                       Label  2339                                                           2338                              
 9026                       Label  2861                                                           2860                              
 9027                       Label  2766                                                           2765                              
 9029                       Label  1890                                                           1889                              
 9030                       Label  1895                                                           1894                              
 9031                       Label  2078                                                           2077                              
 9032                       Label  2083                                                           2082                              

Page 67          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 9033                       Label  2866                                                           2865                              
 9034                       Label  1955                                                           1954                              
 9035                       Label  1931                                                           1930                              
 9036                       Label  1937                                                           1936                              
 9037                       Label  1087                                                           1079,1080,1081,1082               
 9038                       Label  1077                                                           1076                              
 9039                       Label  2677                                                           2675                              
 9040                       Label  2902                                                           2900                              
 9041                       Label  3134                                                           3131                              
 9043                       Label  2127                                                           2126                              
 9044                       Label  2133                                                           2132                              
 9045                       Label  2084                                                           2080,2081                         
 9046                       Label  2952                                                           2950                              
 9047                       Label  1763                                                           1762                              
 9048                       Label  2335                                                           2334                              
 9049                       Label  1143                                                           1142                              
 9050                       Label  1161                                                           1157                              
 9051                       Label  1162                                                           1161                              
 9052                       Label  2260                                                           2259                              
 9053                       Label  1413                                                           1412                              
 9055                       Label  3028                                                           3026                              
 9056                       Label  3060                                                           3058                              
 9057                       Label  2749                                                           2747                              
 9058                       Label  2870                                                           2869                              
 9059                       Label  1451                                                           1450                              
 9060                       Label  2256                                                           2255                              
 9062                       Label  1092                                                           1091                              
 9063                       Label  1097                                                           1093,1094                         
 9064                       Label  1096                                                           1095                              
 940                        Label  1875                                                           1874,1911,2011,2170               
 945                        Label  1896                                                           1892,1893                         
 970                        Label  1886                                                           1881,1882,1883                    
 ABS                        Func   1351                                 scalar                    1351,1375,1548,1593,2049,2379,2558
 ACOEFAS                    Local  114      R(4)            4     2     50                        154,641,2739,2740,2741,2742,2747,2
                                                                                                  765                               
 AMIN1                      Func   2432                                 scalar                    2432,2433,2434,2833,2834,2851,2852
                                                                                                  ,2853                             
 ARATE                      Local  112      R(4)            4     2     176                       155,580,2347,2348,2349,2350,2351,2
                                                                                                  516,2517,2518,2519,2520,2521,2522,
                                                                                                  2523                              
 ATFACTA                    Local  116      R(4)            4     2     55                        154,625,2352,2525,2589            
 ATFACTP                    Local  118      R(4)            4     2     40                        154,604,2330                      
 ATFILE                     Local  139      CHAR            80          scalar                    144,1054                          
 ATTR                       Scalar 74       R(8)            8     2     84       COM              185,2735,2773,2778,2794,2795,2796,
                                                                                                  2797,2804,2808,2836,2837,2838,2839
                                                                                                  ,2840,2841,2842,2855,2856,2857,286
                                                                                                  5,2869,2879,2883,2889,2890,3053,30
                                                                                                  88,3096,3097,3178,3179,3188,3193,3
                                                                                                  207,3211,3220,3254,3281,3282,3295,
                                                                                                  3315,3320,3330,3331,3332,3350,3357
                                                                                                  ,3361,3364,3365,3366,3367         
 ATTRDICT                   Local  139      CHAR            80          scalar                    2976,2979                         
 ATTRFILE                   Local  138      CHAR            80          scalar                    144,2968,2975,2976                
 ATYPE                      Local  95       I(2)            2           scalar                    1317,1320,2327,2330,2352,2525,2588
                                                                                                  ,2589                             

Page 68          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 AVG3WKR                    Local  120      R(4)            4           scalar                    146,166,1926,2178                 
 AVG5PER                    Local  110      R(4)            4           scalar                    146,166                           
 BASVOL                     Local  103      R(4)            4     2     800                       155,657,3018,3019,3020            
 BEGTR                      Scalar 92       I(2)            2           scalar   COM              145,959,1075,1090,1255,1287,1411,1
                                                                                                  449,1561,1606,1696,1734,1761,1813,
                                                                                                  1888,1929,1953,2076,2125,2254,2311
                                                                                                  ,2333,2471,2583,2664,2746,2764,277
                                                                                                  6,2859,2899,2949,3024,3057,3130   
 BTHRUP                     Local  112      R(4)            4     2     800                       3017,3018,3020,3026               
 BTHRUV                     Local  104      R(4)            4     2     800                       155,752,3019,3119                 
 BU                         Local  98       I(2)            2           scalar                    2185,2192                         
 BUCK                       Local  110      R(4)            4           scalar                    2092,2098                         
 BUCKET                     Subr   2192                                                           2192                              
 BUCKET1                    Subr   2098                                                           2098                              
 C                          Local  94       I(2)            2           scalar                    2245,2246,2247,2255,2265,2266,2267
                                                                                                  ,2641,2642,2643,2644,2647,2649,265
                                                                                                  2,2654,2657,2659,2665,2666,2667,27
                                                                                                  17,2718,2744,2748,2759,2777       
 CBD                        Local  130      I(4)            4     1     100                       153,1346,1350,1351,1352           
 CDIFF                      Local  108      R(4)            4     1     4                         1645,1647,1652                    
 CFAC                       Local  109      R(4)            4           scalar                    1690,1691,1693,1697               
 COEFFS                     Local  154                                  scalar                    968                               
 CONTROL                    Local  137      CHAR            80          scalar                    873,961,1300                      
 COPCT                      Local  107      R(4)            4     3     320                       169,2265,2266,2267,2642,2643,2644,
                                                                                                  2647,2649,2652,2654,2657,2659,2665
                                                                                                  ,2666,2667,2744,2748,2759,2777    
 CSUM                       Local  104      R(4)            4           scalar                    1547,1548,1551,1592,1593,1596,2371
                                                                                                  ,2374,2836,2838,2839,2842         
 CTOT                       Local  109      R(4)            4     1     4                         1511,1686,1691,1697               
 DATTIM                     Common 82                                   160                                                         
 DAY                        Scalar 82       I(4)            4           scalar   COM              869,982                           
 DIFF                       Local  104      R(4)            4           scalar                    1548,1549,1593,1594               
 DISTCORFILE                Local  138      CHAR            80          scalar                    143,1005,1053                     
 DO_GQ                      Local  140      L(4)            4           scalar                    146,189,2291                      
 DO_NONRES                  Local  140      L(4)            4           scalar                    146,189,2924                      
 DUMMY                      Local  124      R(4)            4     1     5                         170,3289                          
 DUM_01                     Scalar 80       I(4)            4           scalar   COM                                                
 EINWKAVO                   Local  123      R(4)            4           scalar                    147,167,3078                      
 EIPSN                      Local  110      R(4)            4           scalar                    2940,2941,2950                    
 EIWRKAVO                   Local  123      R(4)            4           scalar                    147,167,3077                      
 EMPADJUST                  Local  111      R(4)            4           scalar                    1961,1967                         
 EMPFACTOR                  Local  111      R(4)            4           scalar                    146,171,1960,1966                 
 ENDTR                      Local  96       I(2)            2           scalar                    145,960,1075,1090,1255,1287,1449,1
                                                                                                  561,1606,1696,1734,1761,1813,1888,
                                                                                                  1929,2076,2125,2254,2311,2333,2471
                                                                                                  ,2583,2664,2746,2764,2776,2859,289
                                                                                                  9,2949                            
 EOF                        Func   990                                  scalar                    990                               
 EQUIV                      Local  153                                  scalar                    972,1348,1372                     
 EU                         Local  109      R(4)            4     1     4                         2744,2748,2759,2760,2772,2778     
 EXP                        Func   2744                                 scalar                    2744                              
 EXTADJ                     Local  124      R(4)            4     2     10                        155,848,1095,2419,2420,2429,2430,2
                                                                                                  431,2473,2830,2831,2848,2849,2850 
 EXTATTR                    Local  122      R(4)            4     2     1000                      3073,3077,3078,3080,3088,3132     
 EXTN                       Local  115      R(4)            4           scalar                    2418,2420,2829,2831               

Page 69          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 EXTPCTC                    Local  120      R(4)            4           scalar                    2429,2432,2443,2467,2848,2851,2855
 EXTPCTH                    Local  120      R(4)            4           scalar                    2431,2434,2445,2469,2472,2850,2853
                                                                                                  ,2857,2860                        
 EXTPCTM                    Local  120      R(4)            4           scalar                    2430,2433,2444,2468,2849,2852,2856
 EXTPCTN                    Local  110      R(4)            4           scalar                    2415,2420,2422,2438,2459,2460,2461
                                                                                                  ,2462,2464,2465,2472,2831,2834,284
                                                                                                  2,2860                            
 EXTPCTW                    Local  110      R(4)            4           scalar                    2414,2419,2421,2436,2458,2463,2472
                                                                                                  ,2830,2833,2838,2860              
 EXTPROD                    Local  121      R(4)            4     2     1000                      3074,3077,3078,3080,3087,3132     
 EXTVOL                     Local  115      R(4)            4     2     1000                      3020,3021,3026,3043,3073,3074     
 EXTW                       Local  115      R(4)            4           scalar                    2417,2419,2429,2430,2431,2828,2829
                                                                                                  ,2830,2848,2849,2850              
 FACTOR                     Local  127      R(8)            8           scalar                    1803,1804,1808,1814               
 FIL                        Local  95       I(2)            2     1     5                         1001,1003,1004,1005,1007,1008     
 FILES                      Local  143                                  scalar                    964                               
 FINDIT                     Subr   1003                                                           1003,1004,1005,1007               
 FLOAT                      Func   1533                                 scalar                    1533,1534,1578,1579               
 FTHRUV                     Scalar 90       R(4)            4     2     800      COM              3111,3114,3119,3121,3122,3126,3131
 GETARG                     Intrin 873                                                            873                               
 GETDAT                     Subr   869                                                            869                               
 GETTIM                     Subr   870                                                            870                               
 GQFACT                     Local  103      R(4)            4     2     16                        154,306,2294,2296,2298,2300,2302,2
                                                                                                  304,2306,2308,2312                
 HBTOT                      Local  116      R(4)            4           scalar                    185,2927,2935,2950                
 HDIFF                      Local  97       I(2)            2           scalar                    2107,2108,2119,2121               
 HEADER                     Subr   1037                                                           1037                              
 HH                         Local  123      R(4)            4           scalar                    1506,1519,1525,1558,1603,1625,1635
 HHFILE                     Local  137      CHAR            80          scalar                    143,2004                          
 HHPOP                      Local  123      R(4)            4           scalar                    1507,1525                         
 HIGH                       Local  109      R(4)            4           scalar                    1534,1535,1579,1580               
 HIND                       Local  96       I(2)            2           scalar                    1532,1534,1539,1542,1577,1579,1584
                                                                                                  ,1587                             
 HR                         Scalar 82       I(4)            4           scalar   COM              870,982                           
 HUN                        Scalar 82       I(4)            4           scalar   COM              870                               
 I                          Local  94       I(2)            2           scalar                    962,982,991,992,1042,1082,1085,109
                                                                                                  3,1095,1147,1157,1359,1360,1383,13
                                                                                                  84,1510,1511,1512,1513,1515,1585,1
                                                                                                  586,1587,1595,1596,1602,1603,1607,
                                                                                                  1624,1625,1626,1632,1633,1644,1645
                                                                                                  ,1647,1652,1653,1657,1658,1659,167
                                                                                                  0,1671,1672,1685,1686,1689,1691,16
                                                                                                  93,1697,1698,1712,1717,1719,1730,1
                                                                                                  731,1735,1754,1755,1757,1759,1762,
                                                                                                  1796,1799,1800,1807,1808,1811,1814
                                                                                                  ,1836,1852,1855,1857,1859,1863,186
                                                                                                  8,1869,1874,1882,1884,1885,1893,18
                                                                                                  94,1911,1920,1923,1925,1926,1934,1
                                                                                                  936,2011,2024,2028,2030,2038,2040,
                                                                                                  2041,2059,2061,2065,2068,2073,2081
                                                                                                  ,2082,2094,2097,2099,2130,2132,214
                                                                                                  2,2145,2148,2169,2170,2175,2177,21
                                                                                                  78,2186,2187,2190,2203,2205,2206,2
                                                                                                  207,2208,2220,2221,2225,2229,2230,
                                                                                                  2235,2236,2259,2264,2265,2266,2267

Page 70          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,2317,2329,2330,2338,2372,2373,237
                                                                                                  4,2378,2379,2382,2383,2451,2452,24
                                                                                                  57,2458,2459,2460,2461,2462,2463,2
                                                                                                  464,2465,2473,2480,2490,2491,2500,
                                                                                                  2645,2647,2649,2652,2654,2657,2659
                                                                                                  ,2665,2666,2667,2675,2738,2739,274
                                                                                                  4,2747,2748,2771,2772,2773,2777,27
                                                                                                  78,2803,2804,2865,2878,2879,2889,2
                                                                                                  900,2925,2927,2931,2951,3051,3052,
                                                                                                  3053,3093,3096,3172,3178,3192,3193
                                                                                                  ,3245,3246,3253,3254,3264,3266,327
                                                                                                  9,3281,3287,3288,3315,3325,3330,33
                                                                                                  31,3356,3357,3364,3365            
 IABS                       Func   2119                                 scalar                    2119                              
 IENWKAVO                   Local  122      R(4)            4           scalar                    147,167,3078                      
 IEWRKAVO                   Local  122      R(4)            4           scalar                    147,166,3077                      
 IFIX                       Func   2292                                 scalar                    2292,2327                         
 IGROUP                     Local  113      R(4)            4     1     4                         170,1757,2373                     
 IHH                        Local  131      I(4)            4           scalar                    2090,2107                         
 INCDIST                    Local  108      R(4)            4     2     148                       451,1586,1587                     
 INCOME                     Local  106      R(4)            4     1     4                         1603,1607,1645,1691,1697          
 INCR                       Local  97       I(2)            2           scalar                    2119,2120,2121                    
 INCRAT                     Local  105      R(4)            4           scalar                    1570,1571,1572,1576,1582,1607     
 INT                        Func   1531                                 scalar                    1531,1576                         
 INTINC                     Local  130      I(4)            4     1     4                         2192                              
 INTZONES                   Scalar 92       I(2)            2           scalar   COM              1155,1158,1169,1170,1171,1172,1173
                                                                                                  ,1174,1175,1176,1177,1178,1179,118
                                                                                                  0,1181,1182,1183,1184,1185,1186,11
                                                                                                  87,1190,1204,1258,1276,1401,1402,1
                                                                                                  426,1427,1428,1450,1499,1501,1746,
                                                                                                  1748,1787,1789,1831,1833,1906,1908
                                                                                                  ,2006,2008,2164,2166,2687,2689,302
                                                                                                  5,3091,3110,3165,3167,3273,3308,33
                                                                                                  10,3343,3384                      
 IPCT                       Local  104      R(4)            4     1     4                         1512,1586,1592,1596,1603,1607,2373
                                                                                                  ,2374,2379,2383                   
 IR                         Local  95       I(2)            2           scalar                    2112,2118,2120                    
 ISTOP                      Local  94       I(2)            2           scalar                    958,1199,1325                     
 ISUM                       Local  105      R(4)            4           scalar                    1729,1731,1735                    
 ITAZ                       Local  129      I(4)            4           scalar                    1205,1211,1240,1256,1257,1277,1279
                                                                                                  ,1287,1288,1303,1305,1317,1319,139
                                                                                                  7,1401,1402,1412,1437,1438,1441,14
                                                                                                  49,1450,1500,1501,1561,1562,1606,1
                                                                                                  607,1696,1697,1712,1747,1748,1761,
                                                                                                  1762,1788,1789,1813,1814,1832,1833
                                                                                                  ,1888,1889,1907,1908,1929,1930,200
                                                                                                  7,2008,2049,2076,2077,2125,2126,21
                                                                                                  48,2165,2166,2245,2246,2248,2254,2
                                                                                                  255,2311,2312,2333,2334,2471,2472,
                                                                                                  2583,2586,2688,2689,2717,2718,2746
                                                                                                  ,2747,2764,2765,2776,2777,2859,286
                                                                                                  0,3166,3167,3245,3274,3275,3287,33
                                                                                                  09,3310,3330,3344,3345,3364,3385,3
                                                                                                  390                               
 IZ                         Local  94       I(2)            2           scalar                    1204,1205,1210,1216,1217,1218,1230

Page 71          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,1231,1237,1238,1249,1250,1251,125
                                                                                                  2,1253,1255,1256,1257,1276,1277,12
                                                                                                  78,1282,1284,1288,1305,1306,1319,1
                                                                                                  320,1438,1439,1446,1450,1499,1500,
                                                                                                  1501,1506,1507,1570,1618,1746,1747
                                                                                                  ,1748,1759,1787,1788,1789,1804,181
                                                                                                  1,1831,1832,1833,1853,1874,1906,19
                                                                                                  07,1908,2006,2007,2008,2049,2050,2
                                                                                                  073,2090,2164,2165,2166,2255,2292,
                                                                                                  2294,2296,2298,2300,2302,2304,2306
                                                                                                  ,2308,2312,2327,2347,2348,2349,235
                                                                                                  0,2351,2363,2370,2413,2417,2418,24
                                                                                                  72,2500,2516,2517,2518,2519,2520,2
                                                                                                  521,2522,2523,2530,2537,2549,2556,
                                                                                                  2586,2587,2588,2589,2622,2687,2688
                                                                                                  ,2689,2695,2696,2725,2726,2727,272
                                                                                                  8,2729,2730,2731,2739,2828,2860,28
                                                                                                  89,3165,3166,3167,3245,3253,3273,3
                                                                                                  274,3275,3287,3294,3308,3309,3310,
                                                                                                  3330,3343,3344,3345,3364,3384,3385
 J                          Local  94       I(2)            2           scalar                    1094,1095,1257,2473               
 JJ                         Local  131      I(4)            4           scalar                    2098,2099,2100,2145,2146,2147     
 JOINT                      Local  105      R(4)            4     2     20                        1625,1626,1633,1647,1653,1657,1658
                                                                                                  ,1659,1671,1672                   
 K                          Local  94       I(2)            2           scalar                    1351,1353,1355,1356,1375,1377,1379
                                                                                                  ,1380,1754,1796,1836,2694,2695,269
                                                                                                  6,3178,3281,3315,3350             
 L                          Local  94       I(2)            2           scalar                    1081,1085,1514,1515,1844,1845,1854
                                                                                                  ,1855,1858,1859,1862,1863,1867,186
                                                                                                  8,1869,1874,1883,1884,1885,1894,19
                                                                                                  11,1921,1923,1925,1926,1935,1936,2
                                                                                                  011,2025,2028,2030,2038,2040,2041,
                                                                                                  2060,2061,2066,2068,2073,2082,2095
                                                                                                  ,2097,2099,2131,2132,2143,2145,214
                                                                                                  8,2169,2170,2176,2177,2178,2189,21
                                                                                                  90,2204,2205,2206,2207,2208,2227,2
                                                                                                  230,2233,2236                     
 LCF                        Local  123      R(4)            4           scalar                                                      
 LCFAC                      Local  123      R(4)            4     2     12                        857,1855                          
 LD                         Local  119      R(4)            4     3     60                        1855,1857,1859,1863,1868          
 LEN_TRIM                   Func   2973                                 scalar                    2973,2975,3379                    
 LIFE                       Local  106      R(4)            4     1     3                         1845,1869                         
 LIFEDIST                   Local  112      R(4)            4     3     60                        389,1855,1863                     
 LIND                       Local  96       I(2)            2           scalar                    1531,1532,1533,1538,1541,1542,1576
                                                                                                  ,1577,1578,1583,1586,1587         
 LIST                       Local  137      CHAR            80          scalar                    143,981                           
 LOG                        Func   1218                                 scalar                    1218                              
 LOW                        Local  109      R(4)            4           scalar                    1533,1535,1537,1578,1580,1582     
 LR                         Local  95       I(2)            2           scalar                    2114,2118,2120                    
 M                          Local  94       I(2)            2           scalar                    1333,1334,1335,2367,2368,2369,2387
                                                                                                  ,2553,2554,2555,2563,3015,3017,301
                                                                                                  8,3019,3020,3021,3025,3026,3042,30
                                                                                                  43,3071,3073,3074,3077,3078,3080,3
                                                                                                  087,3088,3091,3109,3110,3111,3114,
                                                                                                  3118,3119,3121,3122,3126,3127,3131

Page 72          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,3132,3133,3320,3383,3384,3390    
 MAX                        Func   1133                                 scalar                    1133,3041                         
 MAX1                       Func   2110                                 scalar                    2110,2112,2114,2116               
 MAXZONE                    Local  98       I(2)            2           scalar                    186,1237                          
 MIN                        Scalar 82       I(4)            4           scalar   COM              870,982                           
 MIN0                       Func   2110                                 scalar                    2110,2112,2114,2116               
 MOD                        Func   1501                                 scalar                    1501,1748,1789,1833,1908,2008,2166
                                                                                                  ,2245,2689,2717,3167,3275,3310,334
                                                                                                  5                                 
 MON                        Scalar 82       I(4)            4           scalar   COM              869,982                           
 MONTH                      Scalar 83       CHAR            4     1     12       COM              175,982                           
 N                          Local  94       I(2)            2           scalar                    1200,1201,1335,1336,1345,1346,1349
                                                                                                  ,1350,1351,1352,1369,1370,1373,137
                                                                                                  4,1375,1376,1396,1397,1401,1402,14
                                                                                                  04,1412,1417,1425,1911,2011,2169,2
                                                                                                  170,2292,2294,2296,2298,2300,2302,
                                                                                                  2304,2306,2308,2312,2369,2370,2555
                                                                                                  ,2556,3025,3026,3091,3093,3096,311
                                                                                                  0,3122,3131,3172,3279,3325        
 NAMES                      Local  137      CHAR            80    1     5                         180,1003,1004,1005,1007           
 NEGFAC                     Local  105      R(4)            4           scalar                    1665,1666,1671                    
 NEWTOT                     Local  108      R(4)            4           scalar                    1635,1652,1677,1797,1800,1804,1814
 NEWTOTWKR                  Local  107      R(4)            4           scalar                    1960,1961,1962,1966               
 NEWWKRHH                   Local  111      R(4)            4           scalar                    1962,1979                         
 NEWWRK                     Local  114      R(4)            4     1     4                         1979,1985                         
 NFLD                       Local  97       I(2)            2           scalar                    1133,1141,1142,1147,1157          
 NHBADJ                     Local  116      R(4)            4           scalar                    2923,2947,2950,3211,3266          
 NHBTOT                     Local  116      R(4)            4           scalar                    185,2931,2935,2947,2950           
 NPCT                       Local  116      R(4)            4     1     4                         2772,2773,2778                    
 NRTOT                      Local  116      R(4)            4           scalar                    2941,2947,2950                    
 NSTA                       Scalar 73       I(4)            4           scalar   COM              1425,1426,1450,3015,3042,3071,3109
                                                                                                  ,3383                             
 OLDWKRHH                   Local  111      R(4)            4           scalar                    1959,1978                         
 OLDWRK                     Local  112      R(4)            4     1     4                         1978,1985                         
 P                          Local  94       I(2)            2           scalar                    1041,1042,1079,1084,1085,1332,1333
                                                                                                  ,1397,1412,1618,1625,2219,2221,222
                                                                                                  4,2226,2229,2230,2235,2236,2258,22
                                                                                                  59,2312,2316,2317,2328,2330,2337,2
                                                                                                  338,2346,2347,2348,2349,2350,2351,
                                                                                                  2352,2365,2367,2371,2374,2377,2379
                                                                                                  ,2383,2387,2450,2452,2479,2480,248
                                                                                                  9,2491,2493,2494,2500,2501,2514,25
                                                                                                  16,2517,2518,2519,2520,2521,2522,2
                                                                                                  523,2525,2529,2536,2537,2551,2553,
                                                                                                  2557,2558,2560,2563,2578,2579,2580
                                                                                                  ,2588,2589,2607,2608,2609,2610,262
                                                                                                  2,2668,2675,2676,2694,2706,2707,27
                                                                                                  33,2734,2735,2739,2740,2741,2742,2
                                                                                                  744,2747,2748,2759,2765,2773,2777,
                                                                                                  2778,2793,2794,2795,2796,2797,2802
                                                                                                  ,2804,2807,2808,2864,2865,2868,286
                                                                                                  9,2877,2879,2882,2883,2889,2890,29
                                                                                                  00,2901,2926,2927,2930,2931,2951,3
                                                                                                  016,3017,3018,3019,3020,3021,3026,
                                                                                                  3027,3050,3052,3053,3058,3059,3072

Page 73          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,3073,3074,3079,3080,3086,3087,308
                                                                                                  8,3093,3094,3096,3097,3113,3114,31
                                                                                                  17,3118,3119,3121,3122,3126,3127,3
                                                                                                  131,3132,3133,3172,3173,3178,3179,
                                                                                                  3181,3182,3183,3184,3185,3186,3188
                                                                                                  ,3193,3200,3201,3202,3203,3204,320
                                                                                                  7,3211,3219,3220,3221,3222,3223,32
                                                                                                  46,3247,3253,3254,3265,3266,3279,3
                                                                                                  280,3281,3282,3288,3289,3294,3295,
                                                                                                  3315,3320,3325,3326,3331,3332,3350
                                                                                                  ,3355,3357,3360,3361,3365,3366,336
                                                                                                  7,3390                            
 P4                         Local  96       I(2)            2           scalar                    3041,3043,3045                    
 P5                         Local  96       I(2)            2           scalar                    3040,3041,3043,3045               
 PAGE                       Scalar 83       I(4)            4           scalar   COM              171,983                           
 PARAMETERS                 Local  145                                  scalar                    966                               
 PEDUC                      Local  125      R(4)            4           scalar                    2724,2731,2742                    
 PERHH                      Local  107      R(4)            4           scalar                    1525,1526,1527,1531,1537,1562     
 PFACT                      Local  119      R(4)            4     2     32                        154,614,2230,2236,2259            
 PHIIND                     Local  125      R(4)            4           scalar                    2720,2727,2740                    
 PHWY                       Local  125      R(4)            4           scalar                    2722,2729,2741                    
 PLOIND                     Local  125      R(4)            4           scalar                    2719,2726,2740                    
 PLOSVC                     Local  125      R(4)            4           scalar                    2723,2730,2742                    
 PR1                        Local  114      R(4)            4     4     240                       500                               
 PR2                        Local  114      R(4)            4     4     240                       530                               
 PRATE                      Local  113      R(4)            4     4     480                       155,1085,2230,2236,2294,2296,2298,
                                                                                                  2300,2302,2304,2306,2308          
 PROD                       Scalar 74       R(8)            8     2     84       COM              185,2221,2229,2235,2265,2266,2267,
                                                                                                  2293,2295,2297,2299,2301,2303,2305
                                                                                                  ,2307,2317,2330,2338,2347,2371,237
                                                                                                  4,2379,2383,2436,2437,2438,2439,24
                                                                                                  40,2441,2442,2443,2444,2445,2452,2
                                                                                                  458,2459,2460,2461,2462,2463,2464,
                                                                                                  2465,2467,2468,2469,2480,2491,2494
                                                                                                  ,2500,2501,3052,3087,3093,3094,317
                                                                                                  2,3173,3220,3221,3222,3223,3229,32
                                                                                                  30,3231,3232,3234,3235,3236,3237,3
                                                                                                  245,3246,3247,3253,3279,3280,3287,
                                                                                                  3288,3289,3294,3325,3326,3350     
 PRODDICT                   Local  139      CHAR            80          scalar                    2974,2978                         
 PRODFILE                   Local  138      CHAR            80          scalar                    144,2967,2973,2974                
 PRTL                       Local  125      R(4)            4           scalar                    2721,2728,2741                    
 PUMAFILE                   Local  137      CHAR            80          scalar                    143,1007,1299                     
 PUMANO                     Local  98       I(2)            2           scalar                    1303,1306                         
 PURCODE                    Scalar 89       CHAR            4     1     21       COM              177,1085,2317,2338,2387,2480,2563,
                                                                                                  2747,2765,2777,2865,2869          
 QQ                         Local  124      R(4)            4           scalar                    2097,2098,2109,2110,2111,2112,2113
                                                                                                  ,2114,2115,2116,2147              
 RANDOM                     Subr   2109                                                           2109,2111,2113,2115               
 RANGE                      Local  109      R(4)            4           scalar                    1535,1537,1580,1582               
 RATIO                      Local  109      R(4)            4           scalar                    1536,1537,1542,1581,1582,1587,2935
                                                                                                  ,2941,2950                        
 REGAVGINC                  Local  106      R(4)            4           scalar                    1270,1284,1288                    
 REGTOT                     Scalar 89       R(4)            4     1     5        COM              174,1201,1249,1250,1251,1252,1253,
                                                                                                  1270,1954,1959,1960,1962,1966     

Page 74          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 REGTOTWKR                  Local  106      R(4)            4           scalar                    169,1925,1954,1959,1961,1966      
 REPO                       Scalar 86       L(4)            4     1     8        COM              145,169,1036,2631                 
 REPORT                     Subr   3456                                                           3456                              
 REPT                       Common 85                                   13660                                                       
 RINC                       Local  103      R(4)            4     1     4                         2187,2190,2192                    
 RIPCT                      Local  104      R(4)            4     1     4                         1731,1735,1757                    
 RTOT                       Local  105      R(4)            4     1     5                         1621,1626,1633                    
 S                          Local  94       I(2)            2           scalar                    1042,1080,1083,1084,1085,1508,1509
                                                                                                  ,1513,1515,1540,1541,1542,1550,155
                                                                                                  1,1557,1558,1562,1620,1621,1623,16
                                                                                                  25,1626,1631,1633,1639,1652,1653,1
                                                                                                  657,1658,1659,1666,1671,1672,1677,
                                                                                                  1684,1686,1692,1693,1712,1718,1719
                                                                                                  ,1754,1756,1757,1759,1762,1796,179
                                                                                                  8,1800,1806,1808,1811,1814,1836,18
                                                                                                  51,1855,1857,1859,1863,1868,1869,1
                                                                                                  874,1881,1884,1885,1892,1894,1911,
                                                                                                  1919,1923,1925,1926,1933,1936,2011
                                                                                                  ,2023,2028,2030,2038,2040,2041,206
                                                                                                  7,2068,2093,2097,2099,2129,2132,21
                                                                                                  44,2145,2148,2170,2234,2236       
 S2                         Local  94       I(2)            2           scalar                    1083,1084,1085,1646,1647,1698     
 SATTR                      Local  127      R(8)            8     2     22                        2516,2525,2530,2537,2558,2560,2579
                                                                                                  ,2580,2588,2608,2609,2610,2622,269
                                                                                                  4,2707,2735,2773,2794             
 SAVESCR                    Local  140      L(4)            4           scalar                    146,173,1057,1776,1990,3145       
 SCARD                      Local  135      CHAR            8     1     10                        991,992                           
 SEC                        Scalar 82       I(4)            4           scalar   COM              870,982                           
 SEFILE                     Local  138      CHAR            80          scalar                    143,1003,1051                     
 SHARE                      Local  108      R(4)            4     1     4                         1652,1653                         
 SISEED                     Local  104      R(4)            4     3     300                       155,212,1042,1625                 
 SIZE                       Local  106      R(4)            4     1     5                         1558,1562,1633,1652,1666,1677     
 SIZEDIST                   Local  109      R(4)            4     2     150                       415,1541,1542                     
 SIZINC                     Local  107      R(4)            4     2     20                        1513,1672,1686,1693,1698,1712,1719
                                                                                                  ,1754,1757,1759,1762,1796,1800,180
                                                                                                  8,1811,1814,1836,1868             
 SIZINCLIF                  Local  107      R(4)            4     3     60                        1515,1868,1869,1874,1884,1885,1894
                                                                                                  ,1911,1923,2011,2028,2038,2170,223
                                                                                                  6                                 
 SIZINCLIFWKR               Local  113      R(4)            4     4     240                       1923,1925,1926,1936,2028,2030,2040
                                                                                                  ,2041,2068,2097                   
 SNEG                       Local  105      R(4)            4           scalar                    1640,1658,1666                    
 SPCT                       Local  104      R(4)            4     1     5                         1509,1541,1547,1551,1558,1562     
 SPECGENATTR                Local  131      I(4)            4     2     330                       152,187,2557,2558,2560,2563       
 SPECGENPROD                Local  131      I(4)            4     2     330                       152,187,2377,2379,2383,2387       
 SPECGENZONE                Local  97       I(2)            2     2     330                       152,186,1333,2367,2553            
 SPECIAL                    Local  152                                  scalar                    970                               
 SR                         Local  95       I(2)            2           scalar                    2116,2118,2120                    
 STAT1                      Local  95       I(2)            2           scalar                    873,874                           
 STATRIPENDS                Scalar 88       R(4)            4     2     1000     COM              172,3077,3078,3080,3111,3114,3133 
 STAVOL                     Local  124      R(4)            4     2     800                       1397,1412,3111,3114               
 STITL                      Local  134      CHAR            4     1     5                         174,1042                          
 STRLTH                     Local  98       I(2)            2           scalar                    2973,2974,2975,2976,3379,3380     
 SUM                        Local  106      R(4)            4           scalar                    1857,1859                         
 SUMEU                      Local  120      R(4)            4           scalar                    2760,2765,2772                    

Page 75          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SZINLFWK                   Local  130      I(4)            4     4     240                       2099,2118,2120,2132,2145          
 T                          Local  94       I(2)            2           scalar                    1000,1001,1353,1359,1377,1383     
 TATTR1                     Local  127      R(8)            8     1     11                        176,2579,2668,2707                
 TATTR2                     Local  127      R(8)            8     1     11                        176,2580,2609,2668,2707           
 TATTR3                     Local  116      R(4)            4     2     44                        171,2804,2808                     
 TAZPUMA                    Local  98       I(2)            2     1     5000                      1306,1618                         
 TAZZONE                    Local  130      I(4)            4     1     30000                     1238,1305,1319,1335,1351,1375,1401
                                                                                                  ,1412,1438,2369,2555              
 TEMPA                      Local  117      R(4)            4           scalar                    3185,3187,3188,3203,3206,3207     
 TEMPP                      Local  117      R(4)            4           scalar                    3183,3188,3201,3207               
 TFACTOR                    Local  119      R(4)            4     1     11                        147,186,2330,2352,2525            
 TGMET                      Prog   67                                                                                               
 THH                        Local  131      I(4)            4           scalar                    2091,2100,2107                    
 TINC                       Scalar 86       R(4)            4     1     4        COM              171,1719,1729,1731,1735,2206      
 TITLE                      Scalar 83       CHAR            8     1     10       COM              962,982                           
 TJOINTSIL                  Scalar 85       R(4)            4     3     60       COM              172,1884                          
 TJOINTWIL                  Scalar 85       R(4)            4     3     48       COM              172,2205                          
 TLIFE                      Scalar 85       R(4)            4     1     3        COM              173,2208                          
 TOTEMP                     Local  123      R(4)            4           scalar                    2584                              
 TOTEXT                     Local  124      R(4)            4     1     5                         167,3021,3027,3045,3058,3073,3074 
 TOTEXTATTR                 Scalar 88       R(4)            4     1     21       COM              189,2883,2901,2940,3059,3074      
 TOTEXTPROD                 Scalar 88       R(4)            4     1     21       COM              188,2494,2676,3058,3073           
 TOTFIL                     Local  98       I(2)            2           scalar                    1008,1010                         
 TOTHH                      Local  113      R(4)            4           scalar                    2022,2041,2049                    
 TOTIIATTR                  Scalar 87       R(4)            4     2     44       COM              188,2879,2900,3185,3186,3193,3203,
                                                                                                  3204                              
 TOTIIPROD                  Scalar 89       R(4)            4     2     44       COM              188,2491,2675,3183,3184,3193,3201,
                                                                                                  3202                              
 TPROD                      Scalar 87       R(4)            4     2     84       COM              173,2452,2927,2931,2951,3266      
 TSIZE                      Scalar 86       R(4)            4     1     5        COM              170,1885                          
 TTRIP                      Scalar 90       R(4)            4     2     84       COM                                                
 TWKR                       Scalar 86       R(4)            4     1     4        COM              170,2207                          
 U                          Local  109      R(4)            4     1     4                         2739,2744,2748                    
 UPTOWN                     Local  132      I(4)            4     1     100                       153,1370,1374,1375,1376           
 V                          Local  94       I(2)            2           scalar                    2765                              
 VERINFO                    Local  136      CHAR            16          scalar                    865,875,880                       
 W                          Local  94       I(2)            2           scalar                    1922,1923,1936,1983,1984,1985,2027
                                                                                                  ,2028,2029,2030,2039,2040,2041,205
                                                                                                  8,2061,2064,2068,2073,2080,2082,20
                                                                                                  96,2097,2099,2132,2141,2145,2148,2
                                                                                                  169,2188,2190,2202,2205,2206,2207,
                                                                                                  2208,2228,2230                    
 WFACT                      Local  108      R(4)            4           scalar                    2037,2038,2040                    
 WKRDIST                    Local  111      R(4)            4     4     240                       316,1923,2028                     
 WKRINCLIF                  Local  115      R(4)            4     3     48                        2061,2068,2073,2082,2169,2177,2178
                                                                                                  ,2190,2205,2206,2207,2208,2230    
 WORKERS                    Subr   1978                                                           1978,1979                         
 WR                         Local  95       I(2)            2           scalar                    2110,2118,2120                    
 WRATIO                     Local  110      R(4)            4     1     4                         1984,1985,2029                    
 WSUM                       Local  106      R(4)            4           scalar                    2026,2030,2038                    
 X                          Local  94       I(2)            2           scalar                    3398,3399,3436,3441,3442          
 XVOLFILE                   Local  138      CHAR            80          scalar                    144,1004,1052                     
 XXDICT                     Local  139      CHAR            80          scalar                    3380,3381                         
 XXFACT                     Scalar 87       R(4)            4     2     800      COM              3118,3119,3127,3133,3390          
 XXFILE                     Scalar 87       CHAR            80          scalar   COM              144,3377,3379,3380                

Page 76          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 Y1                         Local  105      R(4)            4           scalar                    2642,2646,2647                    
 Y4                         Local  105      R(4)            4           scalar                    2643,2651,2652                    
 Y5                         Local  105      R(4)            4           scalar                    2644,2656,2657                    
 YI                         Local  129      I(4)            4           scalar                    1437                              
 YR                         Scalar 82       I(4)            4           scalar   COM              869,982                           
 YRL                        Local  103      R(4)            4           scalar                    1437,1440,1441,1446               
 Z                          Scalar 92       R(4)            4     2     155000   COM              173,1169,1170,1171,1172,1173,1174,
                                                                                                  1175,1176,1177,1178,1179,1180,1181
                                                                                                  ,1182,1183,1184,1185,1186,1187,119
                                                                                                  0,1205,1210,1216,1217,1218,1230,12
                                                                                                  31,1237,1238,1249,1250,1251,1252,1
                                                                                                  253,1255,1256,1257,1277,1278,1282,
                                                                                                  1284,1288,1320,1336,1355,1360,1379
                                                                                                  ,1384,1402,1446,1450,1500,1506,150
                                                                                                  7,1570,1747,1788,1804,1832,1853,19
                                                                                                  07,2007,2049,2050,2090,2165,2255,2
                                                                                                  292,2294,2296,2298,2300,2302,2304,
                                                                                                  2306,2308,2312,2327,2347,2348,2349
                                                                                                  ,2350,2351,2363,2413,2417,2418,247
                                                                                                  2,2516,2517,2518,2519,2520,2521,25
                                                                                                  22,2523,2530,2537,2549,2586,2587,2
                                                                                                  588,2589,2688,2696,2725,2726,2727,
                                                                                                  2728,2729,2730,2731,2739,2828,2860
                                                                                                  ,3025,3110,3166,3274,3309,3344,338
                                                                                                  5                                 
 ZAREA                      Local  101      I(2)            2           scalar                    150,1135,1190                     
 ZD                         Common 92                                   620004                                                      
 ZDAT                       Local  118      R(4)            4     1     50                        1157,1169,1170,1171,1172,1173,1174
                                                                                                  ,1175,1176,1177,1178,1179,1180,118
                                                                                                  1,1182,1183,1184,1185,1186,1187,11
                                                                                                  90                                
 ZDORM                      Local  101      I(2)            2           scalar                    150,1135,1187                     
 ZEDUC                      Local  100      I(2)            2           scalar                    149,1134,1182                     
 ZEMP_TOT                   Local  100      I(2)            2           scalar                    149,1134,1183                     
 ZHH                        Local  99       I(2)            2           scalar                    148,1133,1173                     
 ZHIIND                     Local  99       I(2)            2           scalar                    148,1134,1176                     
 ZHISVC                     Local  100      I(2)            2           scalar                    149,1134,1180                     
 ZHWY                       Local  100      I(2)            2           scalar                    149,1134,1178                     
 ZLOIND                     Local  99       I(2)            2           scalar                    148,1133,1175                     
 ZLOSVC                     Local  100      I(2)            2           scalar                    149,1134,1179                     
 ZMED_INC                   Local  99       I(2)            2           scalar                    148,1133,1174                     
 ZNAME                      Local  136      CHAR            16    1     50                        1147                              
 ZOFFGOV                    Local  100      I(2)            2           scalar                    149,1134,1181                     
 ZONES                      Scalar 73       I(4)            4           scalar   COM              1426,1450,3273,3275,3343,3345     
 ZPOP_GRP                   Local  99       I(2)            2           scalar                    148,1133,1172                     
 ZPOP_HHS                   Local  99       I(2)            2           scalar                    148,1133,1171                     
 ZPOP_TOT                   Local  99       I(2)            2           scalar                    148,1133,1170                     
 ZRTL                       Local  100      I(2)            2           scalar                    149,1134,1177                     
 ZSTU_CU                    Local  101      I(2)            2           scalar                    150,1135,1186                     
 ZSTU_HS                    Local  100      I(2)            2           scalar                    149,1135,1185                     
 ZSTU_K8                    Local  100      I(2)            2           scalar                    149,1134,1184                     
 ZTAZ                       Local  99       I(2)            2           scalar                    148,1133,1169                     
 ZTOTWKR                    Local  114      R(4)            4           scalar                    2174,2177                         
 ZZ                         Local  94       I(2)            2           scalar                    1331,1333,1356,1359,1380,1383,2366
                                                                                                  ,2367,2377,2379,2383,2387,2552,255

Page 77          Source Listing                  TGMET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  3,2557,2558,2560,2563             

Page 78          Source Listing                  TGMET
2017-10-16 10:05                                 tgmet2015_171013.for

   3465 
   3466 C====================================================================
   3467 C Subroutines for TGMET.FOR:
   3468 
   3469 C REPORT        write reports 2-8
   3470 C FINDIT        determines if a file exists
   3471 C HEADER        puts header at top of each page of the listing file
   3472 C BUCKET        bucket round N-element array (N<=10)
   3473 C BUCKET1       bucket round a scalar
   3474 C WORKERS       apply worker submodel
   3475 
   3476 C-------------------------------------------------------------------
   3477 C Subroutine 'REPORT' to write reports 2-8.
   3478 
   3479       subroutine REPORT
   3480 
   3481       implicit none
   3482 
   3483       INTEGER*4 ZONES,NSTA
   3484       REAL*8    PROD,ATTR
   3485 	INTEGER*4 DUM_01
   3486 
   3487       common /rept/ tjointWIL(4,4,3),tjointSIL(5,4,3),tlife(3),
   3488      + twkr(4),tinc(4),tsize(5),repo(8),zones,
   3489      + xxfact(4,200),xxfile,totiiattr(11,4),tprod(21,4),
   3490      + totextprod(21),totextattr(21),statripends(5,200),
   3491      + regtot(5),purcode(21),totiiprod(11,4),DUM_01,prod(21,4),
   3492      + attr(21,4),ttrip(21,4),nsta,fthruv(4,200)
   3493 
   3494       common /zd/ z(31,5000),intzones,begtr
   3495 
   3496 C Following statements to link to the HEADER subroutine.
   3497 
   3498       common /dattim/ yr,mon,day,hr,min,sec,hun,
   3499      +                month(12),title(10),page
   3500       character*8 title
   3501       character*4 month
   3502 
   3503       character*80 xxfile,headrec
   3504       integer*4 yr,mon,day,hr,min,sec,hun,page,
   3505      + zi(30),tsvol(10),sumv(10),itotwkr,itaz,ista
   3506 
   3507       integer*2 n,i,s,w,m,p,t,l,line,iz,intzones,begtr
   3508 
   3509       real*4 tsw(5),tjointSIL,tjointWIL,xx,y,tj2(3,5),tsize,twkr,
   3510      +  factor,ttrip,item(4),regtot,totiiprod,totiiattr,
   3511      +  zz,ztotwkr,z,tp(21),ta(21),statripends,fthruv,
   3512      +  tlife,tinc,xxfact,tprod,gtotp(21),gtota(21),
   3513      +  totextprod,totextattr
   3514 
   3515 
   3516       character*4 ititl(4),purcode
   3517       character*10 ltitl(3)
   3518 
   3519       logical repo
   3520 
   3521       data ititl/'  1 ','  2 ','  3 ','  4 '/,

Page 79          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3522      + ltitl/'Retired','Kids <=18','NoRet/Kids'/,sumv/10*0/,
   3523      + gtotp,gtota/42*0.0/
   3524 
   3525 C  If requested, write reports of regional HH's by income, size,
   3526 C  workers, and life cycle.
   3527 
   3528       if (repo(2)) then
   3529         call header
   3530         write(6,5600)
   3531  5600   format(/' ',35x,'Report 2a'/' ',
   3532      +    12x,'Report of Estimated HHs by Life Cycle, Income, and ',
   3533      +    'Workers'/)
   3534         do 5650 i = 1,4
   3535           zz = 0.0
   3536           do 5605 w = 1,4
   3537             tsw(w) = 0.0
   3538  5605     continue
   3539           write(6,5610) ititl(i)
   3540  5610     format(3x,'Income: ',a4/'Life',19x,'Workers'/'Cycle ',
   3541      +        '      0        1        2        3+   Total'/)
   3542           do 5640 l = 1,3
   3543             xx = tjointWIL(1,i,l) + tjointWIL(2,i,l) + tjointWIL(3,i,l)
   3544      1         + tjointWIL(4,i,l)
   3545             zz = zz + xx
   3546             write(6,5630) ltitl(l),(tjointWIL(w,i,l),w=1,4),xx
   3547  5630       format(' ',a4,5f9.0)
   3548             do 5635 w = 1,4
   3549               tsw(w) = tsw(w) + tjointWIL(w,i,l)
   3550  5635       continue
   3551  5640     continue
   3552           write(6,5645) (tsw(w),w=1,4),zz
   3553  5645     format(/'Total',5f9.0//)
   3554  5650   continue
   3555 
   3556         write(6,5660)
   3557  5660   format('Income: All'/'Life',19x,'Workers'/'Cycle ',
   3558      +   '      0        1        2        3+   Total'/)
   3559         do 5700 l = 1,3
   3560           do 5670 w = 1,4
   3561           do 5670 i = 1,4
   3562             tj2(l,w) = tj2(l,w) + tjointWIL(w,i,l)
   3563  5670     continue
   3564           write(6,5680) ltitl(l),(tj2(l,w),w=1,4),tlife(l)
   3565  5680     format(' ',a4,5f9.0)
   3566  5700   continue
   3567         write(6,5710) (twkr(w),w=1,4),regtot(2)
   3568  5710   format(/'Total',5f9.0)
   3569 
   3570 C Write companion report of HHs by life cycle, income, and size.
   3571 
   3572         call header
   3573         write(6,5720)
   3574  5720   format(/' ',35x,'Report 2b'/' ',
   3575      +    13x,'Report of Estimated HHs by Life Cycle, Income, and ',
   3576      +    'Size'/)
   3577         do 5750 i = 1,4
   3578           zz = 0.0

Page 80          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3579           do 5725 s = 1,5
   3580             tsw(s) = 0.0
   3581  5725     continue
   3582           write(6,5730) ititl(i)
   3583  5730     format(3x,'Income: ',a4/'Life',25x,'Size'/'Cycle ',
   3584      +        '      1        2        3        4        5+   Total'/)
   3585           do 5740 l = 1,3
   3586             xx = tjointSIL(1,i,l) + tjointSIL(2,i,l) + tjointSIL(3,i,l)
   3587      1         + tjointSIL(4,i,l) + tjointSIL(5,i,l)
   3588             zz = zz + xx
   3589             write(6,5735) ltitl(l),(tjointSIL(s,i,l),s=1,5),xx
   3590  5735       format(' ',a4,6f9.0)
   3591             do 5737 s = 1,5
   3592               tsw(s) = tsw(s) + tjointSIL(s,i,l)
   3593  5737       continue
   3594  5740     continue
   3595           write(6,5745) (tsw(s),s=1,5),zz
   3596  5745     format(/'Total',6f9.0//)
   3597  5750   continue
   3598 
   3599         write(6,5760)
   3600  5760     format('Income: All'/'Life',25x,'Size'/'Cycle ',
   3601      +        '      1        2        3        4        5+   Total'/)
   3602         do 5780 l = 1,3
   3603           do 5770 s = 1,5
   3604           do 5770 i = 1,4
   3605             tj2(l,s) = tj2(l,s) + tjointSIL(s,i,l)
   3606  5770     continue
   3607           write(6,5775) ltitl(l),(tj2(l,s),s=1,5),tlife(l)
   3608  5775     format(' ',a4,6f9.0)
   3609  5780   continue
   3610         write(6,5790) (tsize(s),s=1,5),regtot(2)
   3611  5790   format(/'Total',6f9.0)
   3612       end if
   3613 
   3614 C If requested, write report of normalization calculation.
   3615 
   3616       if (repo(3)) then
   3617         call header
   3618         write(6,5800)
   3619  5800   format(/' ',35x,'Report 3'/' ',
   3620      +    15x,'Report of I/I Trip End Normalization Calculation'//
   3621      +    'Purpose  Income        Productions        Init. Attractions',
   3622      +    '      Factor  Control'/)
   3623 
   3624         do 5860 p = 1,5
   3625           do 5850 i = 1,4
   3626             factor = 1.0
   3627             if (totiiattr(p,i) .gt. 0.001)
   3628      +        factor = totiiprod(p,i)/totiiattr(p,i)
   3629             if ((p .eq. 2 .or. p .eq. 3) .and. i .eq. 1)
   3630      +        factor = (totiiprod(p,1)+totiiprod(p,2)+totiiprod(p,3)+
   3631      +                  totiiprod(p,4))/totiiattr(p,1)
   3632             write(6,5810) purcode(p),ititl(i),totiiprod(p,i),
   3633      +        totiiattr(p,i),factor,'Prod'

Page 81          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3634  5810       format(' ',a4,4x,a4,10x,f10.0,13x,f10.0,8x,f6.4,3x,a4)
	........................................................1          
(1) Recommended relationship between field width 'W' and the number of fractional digits 'D' in this edit descriptor is 'W>=D+3'.

   3635  5850     continue
   3636           write(6,5855)
   3637  5855     format(/)
   3638  5860   continue
   3639 
   3640 C For NHB trips, attractions are already stored in the "income 1"
   3641 C  array position (col. 1).  Must now sum productions and store
   3642 C  them in the same position.
   3643 
   3644         do 5870 p = 6,8
   3645           totiiprod(p,1) = totiiprod(p,1) + totiiprod(p,2)
   3646      1                   + totiiprod(p,3) + totiiprod(p,4)
   3647           factor = totiiprod(p,1)/totiiattr(p,1)
   3648           write(6,5810) purcode(p),' All',totiiprod(p,1),
   3649      1     totiiattr(p,1),factor,'Prod'
   3650           write(6,5855)
   3651  5870   continue
   3652 
   3653 C Commercial and Trucks are already all "income 1".
   3654 
   3655         do 5880 p = 9,11
   3656           factor = totiiprod(p,1)/totiiattr(p,1)
   3657           write(6,5810) purcode(p),' All',totiiprod(p,1),
   3658      1     totiiattr(p,1),factor,'Prod'
   3659           write(6,5855)
   3660  5880   continue
   3661 
   3662       end if
   3663 
   3664 C If requested, write report of zonal trip ends by purpose.
   3665 
   3666       if (repo(4)) then
   3667 
   3668 C Read Real productions and attractions from scratch file 13 and sum
   3669 C  across income.  Do entire report
   3670 C  twice, first for I/I and then for External.
   3671 
   3672         rewind 13
   3673         line = 51
   3674         do 5999 iz = 1,intzones
   3675           itaz = z(1,iz)
   3676           read(13,5900) ((prod(p,i),i=1,4),p=1,11),
   3677      +      ((attr(p,i),i=1,4),p=1,11)
   3678  5900     format(5x,88f12.6)
   3679 
   3680           do p = 1,11
   3681             tp(p) = 0.0
   3682             ta(p) = 0.0
   3683           end do
   3684           do i = 1,4
   3685             do p = 1,11
   3686               tp(p) = tp(p) + prod(p,i)
   3687               ta(p) = ta(p) + attr(p,i)

Page 82          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3688             end do
   3689           end do
   3690 
   3691           do p = 1,11
   3692             gtotp(p) = gtotp(p) + tp(p)
   3693             gtota(p) = gtota(p) + ta(p)
   3694           end do
   3695 
   3696           if (line .gt. 50) then
   3697             call header
   3698             write(6,5941)
   3699  5941       format(' ',35x,'Report 4'/' ',20x,'Report of I/I',
   3700      1        ' Trip Ends by Purpose'//)
   3701 
   3702             write(6,5945) (purcode(p),p=1,11),(purcode(p),p=1,11)
   3703  5945       format(' ',t7,'Productions',t76,'Attractions'/'Zone  ',
   3704      +        11a6,3x,11a6/)
   3705             line = 1
   3706           end if
   3707           write(6,5950) itaz,(tp(p),p=1,11),(ta(p),p=1,11)
   3708  5950     format(' ',i5,11f6.0,3x,11f6.0)
   3709           line = line + 1
   3710  5999   continue
   3711 
   3712 C Write grand totals, staggered on 2 lines.
   3713 
   3714         write(6,5997) (gtotp(p),p=2,10,2),(gtota(p),p=2,10,2),
   3715      1                (gtotp(p),p=1,11,2),(gtota(p),p=1,11,2)
   3716  5997   format(/'Total ',5f12.0,9x,5f12.0/6f12.0,f9.0,5f12.0)
   3717 
   3718 c External Stations.
   3719 
   3720         line = 51
   3721         do 6099 iz = intzones+1,zones
   3722           itaz = z(1,iz)
   3723           read(13,6000) (totextprod(p),p=12,16),
   3724      +                  (totextattr(p),p=17,21)
   3725  6000     format(5x,10f12.6)
   3726 
   3727 c Switch the definitions here, since I/E trips are defined as
   3728 c  attractions and E/I trips are defined as productions, at the
   3729 c  external stations.
   3730 
   3731           do p = 17,21
   3732             tp(p) = totextattr(p)
   3733             gtotp(p) = gtotp(p) + tp(p)
   3734           end do
   3735           do p = 12,16
   3736             ta(p) = totextprod(p)
   3737             gtota(p) = gtota(p) + ta(p)
   3738           end do
   3739 
   3740           if (line .gt. 50) then
   3741             call header
   3742             write(6,6041)
   3743  6041       format(' ',35x,'Report 4'/' ',17x,'Report of External',
   3744      1        ' Person Trip Ends by Purpose'/)

Page 83          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3745 
   3746 c     ' ',11x,'(Trip Ends Shown',
   3747 c     2        ' As Originally Calculated for Internal Zones)'/)
   3748 
   3749             write(6,6045) (purcode(p),p=12,21)
   3750  6045       format(' ',t9,'Attractions',t52,'Productions'/'Sta. ',
   3751      +        5a8,3x,5a8/)
   3752             line = 1
   3753           end if
   3754           write(6,6050) itaz,(tp(p),p=17,21),(ta(p),p=12,16)
   3755  6050     format(i5,5f8.0,3x,5f8.0)
   3756           line = line + 1
   3757  6099   continue
   3758 
   3759 C Write grand totals.
   3760 
   3761         write(6,6097) (gtotp(p),p=17,21),(gtota(p),p=12,16)
   3762  6097   format(/'Total',5f8.0,3x,5f8.0)
   3763 
   3764       end if
   3765 
   3766 C If requested, write report of trip ratios.
   3767 
   3768       if (repo(5)) then
   3769         call header
   3770         write(6,6100) (ititl(i),i=1,4)
   3771  6100   format(' ',35x,'Report 5'/' ',
   3772      +    30x,'Report of Trip Ratios'//
   3773      +    37x,'Income'/'Purpose  Item',4(7x,a4),5x,'Total'/)
   3774 
   3775         do 6200 p = 1,8
   3776           xx = tprod(p,1) + tprod(p,2) + tprod(p,3) + tprod(p,4)
   3777           write(6,6120) purcode(p),'Tot Trips ',(tprod(p,i),i=1,4),xx
   3778  6120     format(' ',a4,a10,5f11.0)
   3779 
   3780           do i = 1,4
   3781             item(i) = tprod(p,i)/regtot(1)
   3782           end do
   3783           y = xx/regtot(1)
   3784           write(6,6140) 'Trips/Empl',(item(i),i=1,4),y
   3785  6140     format(' ',4x,a10,4x,4(f5.3,6x),f6.3)
	..................................1             
(1) Recommended relationship between field width 'W' and the number of fractional digits 'D' in this edit descriptor is 'W>=D+3'.

   3786 
   3787           do i = 1,4
   3788             item(i) = tprod(p,i)/regtot(2)
   3789           end do
   3790           y = xx/regtot(2)
   3791           write(6,6140) 'Trips/HH  ',(item(i),i=1,4),y
   3792 
   3793           do i = 1,4
   3794             item(i) = tprod(p,i)/regtot(4)
   3795           end do
   3796           y = xx/regtot(4)
   3797           write(6,6140) 'Trips/Psn ',(item(i),i=1,4),y
   3798 

Page 84          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3799           write(6,5855)
   3800  6200   continue
   3801 
   3802 C Now total across purposes.
   3803 
   3804         xx = 0.0
   3805         do i = 1,4
   3806           item(i) = 0.0
   3807           do p = 1,8
   3808             item(i) = item(i) + tprod(p,i)
   3809             xx      = xx      + tprod(p,i)
   3810           end do
   3811         end do
   3812         write(6,6120) 'All ','Tot Trips ',(item(i),i=1,4),xx
   3813         write(6,6140) 'Trips/Empl',item(1)/regtot(1),item(2)/regtot(1),
   3814      +    item(3)/regtot(1),item(4)/regtot(1),xx/regtot(1)
   3815         write(6,6140) 'Trips/HH  ',item(1)/regtot(2),item(2)/regtot(2),
   3816      +    item(3)/regtot(2),item(4)/regtot(2),xx/regtot(2)
   3817         write(6,6140) 'Trips/Psn ',item(1)/regtot(4),item(2)/regtot(4),
   3818      +    item(3)/regtot(4),item(4)/regtot(4),xx/regtot(4)
   3819       end if
   3820 
   3821 C If requested, write zonal data report.
   3822 
   3823       if (repo(6)) then
   3824         line = 51
   3825         do 6300 iz = 1,intzones
   3826            ztotwkr = 0
   3827            itotwkr = 0
   3828 c          read(15,6210) ztotwkr
   3829 c 6210     format(28x,f7.0)
   3830 
   3831           if (line .gt. 50) then
   3832             call header
   3833             write(6,6220)
   3834  6220       format(' ',32x,'Report 6'/' ',28x,'Zonal Data Report'//
   3835      +        '             Tot       HH   GQ   LoIn HiIn Rtl  Hwy',
   3836      +        '  LSv  HSv  Off  Edu  K-8  HS   Uni Drm    Med Inc'
   3837      +        ' Gen CBD  Dst       Den'/
   3838      +        ' Zone  Area  Pop   HH  Pop  Pop  Emp  Emp  Emp  Emp',
   3839      +        '  Emp  Emp  ',
   3840      +        'Emp  Emp  Enr  Enr  Enr Flg    Inc Rat Flg Flg  Cor',
   3841      +        '       Fcn  AT'/)
   3842             line = 1
   3843           end if
   3844           do t = 1,30
   3845             zi(t) = ifix(z(t,iz))
   3846           end do
   3847           itaz = z(1,iz)
   3848           write(6,6240) itaz,z(20,iz),zi(2),zi(5),zi(3),zi(4),
   3849 	1	  (zi(t),t=7,14),(zi(t),t=16,19),zi(6),z(23,iz),zi(24),
   3850      2      zi(25),z(26,iz),z(29,iz),zi(28)
   3851  6240     format(i5,f6.2,15i5,i4,i7,f5.2,i3,i4,f5.1,5x,f6.0,i3)
   3852           line = line + 1
   3853  6300   continue
   3854         close (8)
   3855       end if

Page 85          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3856 
   3857 C If requested, write out report of estimated cordon vehicle volumes.
   3858 
   3859       if (repo(7)) then
   3860         line = 51
   3861         do 6600 m = 1,nsta
   3862           if (line .gt. 50) then
   3863             call header
   3864             write(6,6410)
   3865  6410       format(' ',35x,'Report 7'/' ',25x,'Vehicle Cordon Crossing',
   3866      +       ' Report'/
   3867      +       '        Through                               External'/
   3868      +       'Station Auto   COM   MedTrk HvyTrk Total      Auto  ',
   3869      +       ' COM   MedTrk HvyTrk Total'/)
   3870             line = 1
   3871           end if
   3872           ista = z(1,intzones + m)
   3873 
   3874           tsvol(5) = 0
   3875           do t = 1,4
   3876             tsvol(t) = int4(fthruv(t,m) + 0.5)
   3877             tsvol(5) = tsvol(5) + tsvol(t)
   3878           end do
   3879 
   3880           tsvol(6) = int4(statripends(1,m) + statripends(2,m) + 0.5)
   3881           tsvol(10)= tsvol(6)
   3882           do t = 3,5
   3883             tsvol(t+4) = int4(statripends(t,m) + 0.5)
   3884             tsvol(10)  = tsvol(10) + tsvol(t+4)
   3885           end do
   3886 
   3887           do t = 1,10
   3888             sumv(t) = sumv(t) + tsvol(t)
   3889           end do
   3890           write(6,6440) ista,(tsvol(t),t=1,10)
   3891  6440     format(i5,5i7,3x,5i7)
   3892           line = line + 1
   3893  6600   continue
   3894         write(6,6610) (sumv(t),t=1,10)
   3895  6610   format(/'Total',5i7,3x,5i7)
   3896       end if
   3897 
   3898 C If requested, write out report of E/E trip growth factors.
   3899 
   3900       if (repo(8)) then
   3901         open (16,file=xxfile,status='old',form='formatted')
   3902 c	  read(16,6505) headrec
   3903 c 6505   format(a80)
   3904         line = 51
   3905         do 6800 m = 1,nsta
   3906           if (line .gt. 50) then
   3907             call header
   3908             write(6,6510)
   3909  6510       format(' ',35x,'Report 8'/' ',26x,'Through Trip Growth',
   3910      +       ' Factors'//
   3911      +       '   Station      Auto      COM  Med Truck Hvy Truck'/)
   3912             line = 1

Page 86          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3913           end if
   3914           ista = z(1,intzones + m)
   3915           read(16,6530) n,(xxfact(p,m),p=1,4)
   3916  6530     format(i10,1x,f10.3,1x,f10.3,1x,f10.3,1x,f10.3)
   3917           write(6,6540) ista,(xxfact(p,m),p=1,4)
   3918  6540     format(i10,4f10.3)
   3919           line = line + 1
   3920  6800   continue
   3921         close (16)
   3922       end if
   3923 
   3924       return
   3925       end


ENTRY POINTS

  Name              
                    
 REPORT             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 5600                       Label  3531                                                           3530                              
 5605                       Label  3538                                                           3536                              
 5610                       Label  3540                                                           3539                              
 5630                       Label  3547                                                           3546                              
 5635                       Label  3550                                                           3548                              
 5640                       Label  3551                                                           3542                              
 5645                       Label  3553                                                           3552                              
 5650                       Label  3554                                                           3534                              
 5660                       Label  3557                                                           3556                              
 5670                       Label  3563                                                           3560,3561                         
 5680                       Label  3565                                                           3564                              
 5700                       Label  3566                                                           3559                              
 5710                       Label  3568                                                           3567                              
 5720                       Label  3574                                                           3573                              
 5725                       Label  3581                                                           3579                              
 5730                       Label  3583                                                           3582                              
 5735                       Label  3590                                                           3589                              
 5737                       Label  3593                                                           3591                              
 5740                       Label  3594                                                           3585                              
 5745                       Label  3596                                                           3595                              
 5750                       Label  3597                                                           3577                              
 5760                       Label  3600                                                           3599                              
 5770                       Label  3606                                                           3603,3604                         
 5775                       Label  3608                                                           3607                              
 5780                       Label  3609                                                           3602                              
 5790                       Label  3611                                                           3610                              
 5800                       Label  3619                                                           3618                              
 5810                       Label  3634                                                           3632,3648,3657                    
 5850                       Label  3635                                                           3625                              
 5855                       Label  3637                                                           3636,3650,3659,3799               
 5860                       Label  3638                                                           3624                              

Page 87          Source Listing                  REPORT
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 5870                       Label  3651                                                           3644                              
 5880                       Label  3660                                                           3655                              
 5900                       Label  3678                                                           3676                              
 5941                       Label  3699                                                           3698                              
 5945                       Label  3703                                                           3702                              
 5950                       Label  3708                                                           3707                              
 5997                       Label  3716                                                           3714                              
 5999                       Label  3710                                                           3674                              
 6000                       Label  3725                                                           3723                              
 6041                       Label  3743                                                           3742                              
 6045                       Label  3750                                                           3749                              
 6050                       Label  3755                                                           3754                              
 6097                       Label  3762                                                           3761                              
 6099                       Label  3757                                                           3721                              
 6100                       Label  3771                                                           3770                              
 6120                       Label  3778                                                           3777,3812                         
 6140                       Label  3785                                                           3784,3791,3797,3813,3815,3817     
 6200                       Label  3800                                                           3775                              
 6220                       Label  3834                                                           3833                              
 6240                       Label  3851                                                           3848                              
 6300                       Label  3853                                                           3825                              
 6410                       Label  3865                                                           3864                              
 6440                       Label  3891                                                           3890                              
 6510                       Label  3909                                                           3908                              
 6530                       Label  3916                                                           3915                              
 6540                       Label  3918                                                           3917                              
 6600                       Label  3893                                                           3861                              
 6610                       Label  3895                                                           3894                              
 6800                       Label  3920                                                           3905                              
 ATTR                       Scalar 3484     R(8)            8     2     84       COM              3677,3687                         
 BEGTR                      Scalar 3494     I(2)            2           scalar   COM                                                
 DATTIM                     Common 3498                                 160                                                         
 DAY                        Scalar 3498     I(4)            4           scalar   COM                                                
 DUM_01                     Scalar 3485     I(4)            4           scalar   COM                                                
 FACTOR                     Local  3510     R(4)            4           scalar                    3626,3628,3630,3633,3647,3649,3656
                                                                                                  ,3658                             
 FTHRUV                     Scalar 3492     R(4)            4     2     800      COM              3876                              
 GTOTA                      Local  3512     R(4)            4     1     21                        3523,3693,3714,3715,3737,3761     
 GTOTP                      Local  3512     R(4)            4     1     21                        3523,3692,3714,3715,3733,3761     
 HEADER                     Subr   3529                                                           3529,3572,3617,3697,3741,3769,3832
                                                                                                  ,3863,3907                        
 HEADREC                    Local  3503     CHAR            80          scalar                                                      
 HR                         Scalar 3498     I(4)            4           scalar   COM                                                
 HUN                        Scalar 3498     I(4)            4           scalar   COM                                                
 I                          Local  3507     I(2)            2           scalar                    3534,3539,3543,3544,3546,3549,3561
                                                                                                  ,3562,3577,3582,3586,3587,3589,359
                                                                                                  2,3604,3605,3625,3627,3628,3629,36
                                                                                                  32,3633,3676,3677,3684,3686,3687,3
                                                                                                  770,3777,3780,3781,3784,3787,3788,
                                                                                                  3791,3793,3794,3797,3805,3806,3808
                                                                                                  ,3809,3812                        
 IFIX                       Func   3845                                 scalar                    3845                              
 INT4                       Func   3876                                 scalar                    3876,3880,3883                    
 INTZONES                   Scalar 3494     I(2)            2           scalar   COM              3674,3721,3825,3872,3914          
 ISTA                       Local  3505     I(4)            4           scalar                    3872,3890,3914,3917               

Page 88          Source Listing                  REPORT
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ITAZ                       Local  3505     I(4)            4           scalar                    3675,3707,3722,3754,3847,3848     
 ITEM                       Local  3510     R(4)            4     1     4                         3781,3784,3788,3791,3794,3797,3806
                                                                                                  ,3808,3812,3813,3814,3815,3816,381
                                                                                                  7,3818                            
 ITITL                      Local  3516     CHAR            4     1     4                         3521,3539,3582,3632,3770          
 ITOTWKR                    Local  3505     I(4)            4           scalar                    3827                              
 IZ                         Local  3507     I(2)            2           scalar                    3674,3675,3721,3722,3825,3845,3847
                                                                                                  ,3848,3849,3850                   
 L                          Local  3507     I(2)            2           scalar                    3542,3543,3544,3546,3549,3559,3562
                                                                                                  ,3564,3585,3586,3587,3589,3592,360
                                                                                                  2,3605,3607                       
 LINE                       Local  3507     I(2)            2           scalar                    3673,3696,3705,3709,3720,3740,3752
                                                                                                  ,3756,3824,3831,3842,3852,3860,386
                                                                                                  2,3870,3892,3904,3906,3912,3919   
 LTITL                      Local  3517     CHAR            10    1     3                         3522,3546,3564,3589,3607          
 M                          Local  3507     I(2)            2           scalar                    3861,3872,3876,3880,3883,3905,3914
                                                                                                  ,3915,3917                        
 MIN                        Scalar 3498     I(4)            4           scalar   COM                                                
 MON                        Scalar 3498     I(4)            4           scalar   COM                                                
 MONTH                      Scalar 3499     CHAR            4     1     12       COM                                                
 N                          Local  3507     I(2)            2           scalar                    3915                              
 NSTA                       Scalar 3483     I(4)            4           scalar   COM              3861,3905                         
 P                          Local  3507     I(2)            2           scalar                    3624,3627,3628,3629,3630,3631,3632
                                                                                                  ,3633,3644,3645,3646,3647,3648,364
                                                                                                  9,3655,3656,3657,3658,3676,3677,36
                                                                                                  80,3681,3682,3685,3686,3687,3691,3
                                                                                                  692,3693,3702,3707,3714,3715,3723,
                                                                                                  3724,3731,3732,3733,3735,3736,3737
                                                                                                  ,3749,3754,3761,3775,3776,3777,378
                                                                                                  1,3788,3794,3807,3808,3809,3915,39
                                                                                                  17                                
 PAGE                       Scalar 3499     I(4)            4           scalar   COM                                                
 PROD                       Scalar 3484     R(8)            8     2     84       COM              3676,3686                         
 PURCODE                    Scalar 3491     CHAR            4     1     21       COM              3632,3648,3657,3702,3749,3777     
 REGTOT                     Scalar 3491     R(4)            4     1     5        COM              3567,3610,3781,3783,3788,3790,3794
                                                                                                  ,3796,3813,3814,3815,3816,3817,381
                                                                                                  8                                 
 REPO                       Scalar 3488     L(4)            4     1     8        COM              3528,3616,3666,3768,3823,3859,3900
 REPORT                     Subr   3479                                                                                             
 REPT                       Common 3487                                 13660                                                       
 S                          Local  3507     I(2)            2           scalar                    3579,3580,3589,3591,3592,3595,3603
                                                                                                  ,3605,3607,3610                   
 SEC                        Scalar 3498     I(4)            4           scalar   COM                                                
 STATRIPENDS                Scalar 3490     R(4)            4     2     1000     COM              3880,3883                         
 SUMV                       Local  3505     I(4)            4     1     10                        3522,3888,3894                    
 T                          Local  3507     I(2)            2           scalar                    3844,3845,3849,3875,3876,3877,3882
                                                                                                  ,3883,3884,3887,3888,3890,3894    
 TA                         Local  3511     R(4)            4     1     21                        3682,3687,3693,3707,3736,3737,3754
 TINC                       Scalar 3488     R(4)            4     1     4        COM                                                
 TITLE                      Scalar 3499     CHAR            8     1     10       COM                                                
 TJ2                        Local  3509     R(4)            4     2     15                        3562,3564,3605,3607               
 TJOINTSIL                  Scalar 3487     R(4)            4     3     60       COM              3586,3587,3589,3592,3605          
 TJOINTWIL                  Scalar 3487     R(4)            4     3     48       COM              3543,3544,3546,3549,3562          
 TLIFE                      Scalar 3487     R(4)            4     1     3        COM              3564,3607                         
 TOTEXTATTR                 Scalar 3490     R(4)            4     1     21       COM              3724,3732                         

Page 89          Source Listing                  REPORT
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TOTEXTPROD                 Scalar 3490     R(4)            4     1     21       COM              3723,3736                         
 TOTIIATTR                  Scalar 3489     R(4)            4     2     44       COM              3627,3628,3631,3633,3647,3649,3656
                                                                                                  ,3658                             
 TOTIIPROD                  Scalar 3491     R(4)            4     2     44       COM              3628,3630,3631,3632,3645,3646,3647
                                                                                                  ,3648,3656,3657                   
 TP                         Local  3511     R(4)            4     1     21                        3681,3686,3692,3707,3732,3733,3754
 TPROD                      Scalar 3489     R(4)            4     2     84       COM              3776,3777,3781,3788,3794,3808,3809
 TSIZE                      Scalar 3488     R(4)            4     1     5        COM              3610                              
 TSVOL                      Local  3505     I(4)            4     1     10                        3874,3876,3877,3880,3881,3883,3884
                                                                                                  ,3888,3890                        
 TSW                        Local  3509     R(4)            4     1     5                         3537,3549,3552,3580,3592,3595     
 TTRIP                      Scalar 3492     R(4)            4     2     84       COM                                                
 TWKR                       Scalar 3488     R(4)            4     1     4        COM              3567                              
 W                          Local  3507     I(2)            2           scalar                    3536,3537,3546,3548,3549,3552,3560
                                                                                                  ,3562,3564,3567                   
 XX                         Local  3509     R(4)            4           scalar                    3543,3545,3546,3586,3588,3589,3776
                                                                                                  ,3777,3783,3790,3796,3804,3809,381
                                                                                                  2,3814,3816,3818                  
 XXFACT                     Scalar 3489     R(4)            4     2     800      COM              3915,3917                         
 XXFILE                     Scalar 3489     CHAR            80          scalar   COM              3901                              
 Y                          Local  3509     R(4)            4           scalar                    3783,3784,3790,3791,3796,3797     
 YR                         Scalar 3498     I(4)            4           scalar   COM                                                
 Z                          Scalar 3494     R(4)            4     2     155000   COM              3675,3722,3845,3847,3848,3849,3850
                                                                                                  ,3872,3914                        
 ZD                         Common 3494                                 620004                                                      
 ZI                         Local  3505     I(4)            4     1     30                        3845,3848,3849,3850               
 ZONES                      Scalar 3483     I(4)            4           scalar   COM              3721                              
 ZTOTWKR                    Local  3511     R(4)            4           scalar                    3826                              
 ZZ                         Local  3511     R(4)            4           scalar                    3535,3545,3552,3578,3588,3595     

Page 90          Source Listing                  REPORT
2017-10-16 10:05                                 tgmet2015_171013.for

   3926 
   3927 C-------------------------------------------------------------------
   3928 C Subroutine 'FINDIT' to determine if input files really exist.
   3929 C  Returns FERR = 1 if file FNO does not exist.  Returns FERR = 0
   3930 C  otherwise.
   3931 
   3932       subroutine findit (fno,fname,ferr)
   3933 
   3934       integer*2 ferr
   3935       character*80 fno,fname
   3936       logical infile
   3937 
   3938       ferr = 0
   3939       inquire (file=fno,exist=infile)
   3940       if (.NOT. infile) then
   3941         write(6,100) fname,fno 
   3942   100   format (' FINDIT 100 (F): Cannot find '/5x,a80,': ',/5x,a80)
   3943         ferr = 1
   3944       end if
   3945       return
   3946       end 


ENTRY POINTS

  Name              
                    
 FINDIT             

Page 91          Source Listing                  FINDIT
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  3942                                                           3941                              
 FERR                       Dummy  3934     I(2)            2           scalar   ARG,INOUT        3938,3943                         
 FINDIT                     Subr   3932                                                                                             
 FNAME                      Dummy  3935     CHAR            80          scalar   ARG,INOUT        3941                              
 FNO                        Dummy  3935     CHAR            80          scalar   ARG,INOUT        3939,3941                         
 INFILE                     Local  3936     L(4)            4           scalar                    3939,3940                         

Page 92          Source Listing                  FINDIT
2017-10-16 10:05                                 tgmet2015_171013.for

   3947 
   3948 C-------------------------------------------------------------------
   3949 C Subroutine 'HEADER' to place a form feed character and write a new
   3950 C  header to the listing file.
   3951 
   3952       subroutine header 
   3953 
   3954       implicit integer (a-z)
   3955 
   3956       common /dattim/ yr,mon,day,hr,min,sec,hun,
   3957      +                month(12),title(10),page
   3958 
   3959       character*8 title
   3960       character*4 month
   3961       integer*4 yr,mon,day,hr,min,sec,hun,page
   3962 	integer*2 i
   3963  
   3964 C Write header with page eject (ASCII 12) as control character.
   3965 
   3966       page = page+1
   3967       write (6,100) char(12),(title(i),i=1,10),day,month(mon),yr,
   3968      +  hr,min,sec,page
   3969   100 format(a1,9a8,a7//i2,1x,a4,i4,2x,i2,1h:,i2.2,1h:,i2.2,16x,
   3970      +  'TGMET',28x,'Page ',i3/)
   3971 
   3972       return
   3973       end


ENTRY POINTS

  Name              
                    
 HEADER             

Page 93          Source Listing                  HEADER
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  3969                                                           3967                              
 CHAR                       Func   3967                                 scalar                    3967                              
 DATTIM                     Common 3956                                 160                                                         
 DAY                        Scalar 3956     I(4)            4           scalar   COM              3967                              
 HEADER                     Subr   3952                                                                                             
 HR                         Scalar 3956     I(4)            4           scalar   COM              3968                              
 HUN                        Scalar 3956     I(4)            4           scalar   COM                                                
 I                          Local  3962     I(2)            2           scalar                    3967                              
 MIN                        Scalar 3956     I(4)            4           scalar   COM              3968                              
 MON                        Scalar 3956     I(4)            4           scalar   COM              3967                              
 MONTH                      Scalar 3957     CHAR            4     1     12       COM              3967                              
 PAGE                       Scalar 3957     I(4)            4           scalar   COM              3966,3968                         
 SEC                        Scalar 3956     I(4)            4           scalar   COM              3968                              
 TITLE                      Scalar 3957     CHAR            8     1     10       COM              3967                              
 YR                         Scalar 3956     I(4)            4           scalar   COM              3967                              

Page 94          Source Listing                  HEADER
2017-10-16 10:05                                 tgmet2015_171013.for

   3974 
   3975 C-------------------------------------------------------------------
   3976 C Subroutine 'BUCKET' to bucket round a vector (max 10 elements).
   3977 C  Input = R*4 array, Output = I*4 array
   3978 
   3979       subroutine bucket(intable,outtable,lth)
   3980 
   3981       implicit integer*2 (a-z)
   3982       integer*2 i,lth
   3983       integer*4 outtable
   3984       real*4    garb,intable
   3985       dimension garb(10),intable(lth),outtable(lth)
   3986 
   3987       do 100 i = 1,lth
   3988         garb(i) = 0.5
   3989   100 continue
   3990 
   3991       do 200 i = 1,lth
   3992         outtable(i) = INT4(intable(i) + garb(i))
   3993         garb(i)     = intable(i) - outtable(i) + garb(i)
   3994   200 continue
   3995 
   3996       return
   3997       end


ENTRY POINTS

  Name              
                    
 BUCKET             

Page 95          Source Listing                  BUCKET
2017-10-16 10:05 Symbol Table                    tgmet2015_171013.for



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  3989                                                           3987                              
 200                        Label  3994                                                           3991                              
 BUCKET                     Subr   3979                                                                                             
 GARB                       Local  3984     R(4)            4     1     10                        3988,3992,3993                    
 I                          Local  3982     I(2)            2           scalar                    3987,3988,3991,3992,3993          
 INT4                       Func   3992                                 scalar                    3992                              
 INTABLE                    Dummy  3984     R(4)            4     1     0        ARG,INOUT        3992,3993                         
 LTH                        Dummy  3982     I(2)            2           scalar   ARG,INOUT        3985,3987,3991                    
 OUTTABLE                   Dummy  3983     I(4)            4     1     0        ARG,INOUT        3992,3993                         

Page 96          Source Listing                  BUCKET
2017-10-16 10:05                                 tgmet2015_171013.for

   3998 
   3999 C-------------------------------------------------------------------
   4000 C Subroutine 'BUCKET1' to bucket round a single scalar value
   4001 C  Input = R*4 scalar, Output = I*4 scalar
   4002 
   4003       subroutine bucket1(inval,outval,garb)
   4004 
   4005       implicit  none
   4006       integer*4 outval
   4007       real*4    garb,inval
   4008 
   4009       outval = INT4(inval + garb)
   4010       garb   = inval - outval + garb
   4011 
   4012       return
   4013       end


ENTRY POINTS

  Name               
                     
 BUCKET1             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BUCKET1                    Subr   4003                                                                                             
 GARB                       Dummy  4007     R(4)            4           scalar   ARG,INOUT        4009,4010                         
 INT4                       Func   4009                                 scalar                    4009                              
 INVAL                      Dummy  4007     R(4)            4           scalar   ARG,INOUT        4009,4010                         
 OUTVAL                     Dummy  4006     I(4)            4           scalar   ARG,INOUT        4009,4010                         

Page 97          Source Listing                  BUCKET1
2017-10-16 10:05                                 tgmet2015_171013.for

   4014 
   4015 C-------------------------------------------------------------------
   4016 C Subroutine 'WORKERS' to apply worker submodel to translate an
   4017 C  average no. of workers/HH to the percent of HHs with 0, 1, 2, and
   4018 C  3+ workers.
   4019 
   4020       subroutine workers(wkrhh,wpct)
   4021 
   4022       implicit none
   4023 
   4024       integer*2 lind,hind,w
   4025 
   4026       real*4 low,high,range,ratio,wpct(4),csum,diff,
   4027      +  wkrhh,wkrmodl(4,16)
   4028 
   4029 C  'WKRMODL' array: regional base workers/HH model.
   4030 C   (Derived from 2000 CTPP, part 1, table 62, WorkerModel.xls).
   4031 C   Dimensions: WKRMODL(workers, avg workers/HH index)
   4032 C                                       DATA OK
   4033 C           workers:    0      1      1      3+
   4034       data wkrmodl / 65.59, 26.22,  8.19,  0.00,        ! 0.4
   4035      +               60.69, 29.45,  9.86,  0.00,        ! 0.5
   4036      +               55.79, 32.68, 11.53,  0.00,
   4037      +               48.84, 37.33, 11.22,  2.61,
   4038      +               41.28, 39.42, 16.23,  3.07,
   4039      +               38.08, 37.89, 19.61,  4.42,
   4040      +               33.55, 38.13, 23.45,  4.87,        ! 1.0
   4041      +               27.78, 39.88, 27.50,  4.84,
   4042      +               23.89, 39.26, 30.82,  6.03,
   4043      +               20.02, 38.66, 34.50,  6.82,
   4044      +               16.75, 37.45, 37.80,  8.00,
   4045      +               12.47, 36.48, 42.67,  8.38,        ! 1.5
   4046      +                8.19, 36.61, 46.88,  8.32,
   4047      +                6.80, 33.39, 45.89, 13.92,
   4048      +                5.55, 33.01, 45.77, 18.31,
   4049      +                2.00, 18.00, 59.00, 21.00/        ! 2.0
   4050 
   4051 C Check for min/max input workers/HH.
   4052 
   4053           if (wkrhh .gt. 2.0) wkrhh = 2.0
   4054           if (wkrhh .lt. 0.4) wkrhh = 0.4
   4055 
   4056 C Interpolate within the look-up table to get the initial proportion
   4057 C  of HHs by number of workers.
   4058 
   4059           lind  = INT(10.0*wkrhh + 1.0)
   4060           hind  = lind + 1
   4061           low   = 0.10*float(lind) - 0.1
   4062           high  = 0.10*float(hind) - 0.1
   4063           range = high - low
   4064           ratio = 0.0
   4065           if (range .gt. 0.001) ratio = (wkrhh - low)/range
   4066           if (lind .lt. 1)  lind = 1
   4067           if (lind .gt. 36) lind = 16
   4068           if (hind .lt. 1)  hind = 1
   4069           if (hind .gt. 36) hind = 16
   4070           do w = 1,4

Page 98          Source Listing                  WORKERS
2017-10-16 10:05                                 tgmet2015_171013.for

   4071             wpct(w) = 0.01 * (wkrmodl(w,lind) +
   4072      +                ratio* (wkrmodl(w,hind) - wkrmodl(w,lind)))
   4073           end do
   4074 
   4075 C Ensure that total percentages sum to 1.0.
   4076 
   4077           csum = wpct(1) + wpct(2) + wpct(3) + wpct(4)
   4078           diff = abs(csum - 1.000)
   4079           if (diff .gt. 0.001) then
   4080             do w = 1,4
   4081               wpct(w) = wpct(w)/csum
   4082             end do
   4083           end if
   4084 
   4085       return
   4086       end


ENTRY POINTS

  Name               
                     
 WORKERS             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ABS                        Func   4078                                 scalar                    4078                              
 CSUM                       Local  4026     R(4)            4           scalar                    4077,4078,4081                    
 DIFF                       Local  4026     R(4)            4           scalar                    4078,4079                         
 FLOAT                      Func   4061                                 scalar                    4061,4062                         
 HIGH                       Local  4026     R(4)            4           scalar                    4062,4063                         
 HIND                       Local  4024     I(2)            2           scalar                    4060,4062,4068,4069,4072          
 INT                        Func   4059                                 scalar                    4059                              
 LIND                       Local  4024     I(2)            2           scalar                    4059,4060,4061,4066,4067,4071,4072
 LOW                        Local  4026     R(4)            4           scalar                    4061,4063,4065                    
 RANGE                      Local  4026     R(4)            4           scalar                    4063,4065                         
 RATIO                      Local  4026     R(4)            4           scalar                    4064,4065,4072                    
 W                          Local  4024     I(2)            2           scalar                    4070,4071,4072,4080,4081          
 WKRHH                      Dummy  4027     R(4)            4           scalar   ARG,INOUT        4053,4054,4059,4065               
 WKRMODL                    Local  4027     R(4)            4     2     64                        4034,4071,4072                    
 WORKERS                    Subr   4020                                                                                             
 WPCT                       Dummy  4026     R(4)            4     1     4        ARG,INOUT        4071,4077,4081                    

Page 99          Source Listing                  WORKERS
2017-10-16 10:05                                 tgmet2015_171013.for

   4087 
   4088 
   4089 

Page 100         Source Listing                  WORKERS
2017-10-16 10:05 Subprograms/Common Blocks       tgmet2015_171013.for



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BUCKET                     Subr   3979                                                                                             
 BUCKET1                    Subr   4003                                                                                             
 DATTIM                     Common 82                                   160                                                         
 DATTIM                     Common 3498                                 160                                                         
 DATTIM                     Common 3956                                 160                                                         
 FINDIT                     Subr   3932                                                                                             
 HEADER                     Subr   3952                                                                                             
 REPORT                     Subr   3479                                                                                             
 REPT                       Common 85                                   13660                                                       
 REPT                       Common 3487                                 13660                                                       
 TGMET                      Prog   67                                                                                               
 WORKERS                    Subr   4020                                                                                             
 ZD                         Common 92                                   620004                                                      
 ZD                         Common 3494                                 620004                                                      

COMPILER OPTIONS BEING USED

  /align:noall                          /align:nonone
  /align:nocommons                      /align:nodcommons
  /align:noqcommons                     /align:nozcommons
  /align:records                        /align:nosequence
  /align:norec1byte                     /align:norec2byte
  /align:norec4byte                     /align:norec8byte
  /align:norec16byte                    /align:norec32byte
  /align:norec64byte                    /align:noarray8byte
  /align:noarray16byte                  /align:noarray32byte
  /align:noarray64byte                  /align:noarray128byte
  /align:noarray256byte                 /altparam
  /assume:accuracy_sensitive            /assume:nobscc
  /assume:nobuffered_io                 /assume:nobyterecl
  /assume:nocc_omp                      /assume:nocstring
  /assume:nodummy_aliases               /assume:nofpe_summary
  /assume:noieee_fpe_flags              /assume:nominus0
  /assume:noold_boz                     /assume:old_complex_align
  /assume:old_unit_star                 /assume:old_ldout_format
  /assume:noold_logical_ldio            /assume:old_maxminloc
  /assume:old_xor                       /assume:protect_constants
  /assume:noprotect_parens              /assume:split_common
  /assume:source_include                /assume:nostd_intent_in
  /assume:nostd_mod_proc_name           /assume:norealloc_lhs
  /assume:nounderscore                  /assume:no2underscores
  /noauto                               /auto_scalar
  /nobintext                            /ccdefault:default
  /check:noargs                         /check:noarg_temp_created
  /check:nobounds                       /check:noformat
  /check:nooutput_conversion            /check:nooverflow
  /check:nopointers                     /check:nopower
  /check:noshape                        /check:nostack
  /check:nounderflow                    /check:nouninitialized
  /Qcoarray-num-procs:0                 /noQcoarray-config-file
  /convert:native                       /cross_reference

Page 101         Source Listing                  WORKERS
2017-10-16 10:05                                 tgmet2015_171013.for

  /D:__INTEL_COMPILER=1310              /D:_WIN32
  /D:_M_AMD64                           /D:_M_X64
  /D:_WIN64                             /D:_MSC_VER=1020
  /D:_MSC_FULL_VER=10200000             /D:_MSC_EXTENSIONS
  /D:_MT                                /D:__INTEL_COMPILER_BUILD_DATE=20130607
  /D:__SSE2__                           /D:__SSE__
  /D:__MMX__                            /double_size:64
  /nod_lines                            /noQdyncom
  /error_limit:30                       /nof66
  /nof77rtl                             /nofast
  /fpscomp:filesfromcmd                 /fpscomp:general
  /fpscomp:noioformat                   /fpscomp:ldio_spacing
  /fpscomp:nolibs                       /fpscomp:nologicals
  /fixed                                /nofpconstant
  /fpe3                                 /noftz
  /fp_model:noprecise                   /fp_model:fast
  /fp_model:nostrict                    /fp_model:nosource
  /fp_model:nodouble                    /fp_model:noextended
  /fp_model:novery_fast                 /fp_model:noexcept
  /fp_model:nono_except                 /heap_arrays:0
  /nothreadprivate_compat               /debug0
  /iface:noc                            /iface:nocref
  /iface:nocvf                          /iface:default
  /iface:nostdcall                      /iface:nostdref
  /iface:nomixed_str_len_arg            /iface:nono_mixed_str_len_arg
  /nointconstant                        /integer_size:32
  /libdir:automatic                     /libdir:user
  /nomodule                             /names:
  /nonoinclude                          /O2
  /nopad_source                         /real_size:32
  /norecursive                          /reentrancy:none
  /nosharable_localsaves                /Qvec:simd
  /show:noinclude                       /show:map
  /show:options                         /nosyntax_only
  /nothreadcom                          /noU
  /novms                                /warn:noall
  /warn:nonone                          /warn:alignments
  /warn:noargument_checking             /warn:nodeclarations
  /warn:general                         /warn:noignore_bounds
  /warn:noignore_loc                    /warn:nointerfaces
  /warn:notruncated_source              /warn:uncalled
  /warn:uninitialized                   /warn:nounused
  /warn:usage

  /include   path : C:\Program Files (x86)\Intel\Composer XE 2013\compiler\include\intel64\,C:\Program Files (x86)\Intel\Composer XE 2013\ipp\include\,
           .F90,.\.F90,C:\PROGRA~2\Intel\COMPOS~1\compiler\include\.F90,C:\Program Files (x86)\Intel\Composer XE 2013\compiler\include\.F90,
           C:\Program Files (x86)\Intel\Composer XE 2013\compiler\include\intel64\.F90,C:\Program Files (x86)\Microsoft Visual Studio 10.0\\Intel Fortran\Microsoft Files\VC\atlmfc\include\.F90,
           C:\Program Files (x86)\Microsoft Visual Studio 10.0\\Intel Fortran\Microsoft Files\VC\include\.F90,C:\Program Files (x86)\Microsoft Visual Studio 10.0\\include\.F90,
           C:\Program Files (x86)\Intel\Composer XE 2013\ipp\include\.F90,C:\Program Files (x86)\Intel\Composer XE 2013\mkl\include\.F90,
           C:\Program Files (x86)\Intel\Composer XE 2013\tbb\bin\..\include\.F90,C:\PROGRA~2\Intel\COMPOS~1\compiler\include\intel64\.F90,
           C:\Program Files (x86)\Intel\Composer XE 2013\compiler\include\.F90,C:\Program Files (x86)\Intel\Composer XE 2013\compiler\include\intel64\.F90,
           C:\Program Files (x86)\Microsoft Visual Studio 10.0\\Intel Fortran\Microsoft Files\VC\atlmfc\include\.F90,
           C:\Program Files (x86)\Microsoft Visual Studio 10.0\\Intel Fortran\Microsoft Files\VC\include\.F90,C:\Program Files (x86)\Microsoft Visual Studio 10.0\\include\.F90,
           C:\Program Files (x86)\Intel\Composer XE 2013\ipp\include\.F90,C:\Program Files (x86)\Intel\Composer XE 2013\mkl\include\.F90,
           C:\Program Files (x86)\Intel\Composer XE 2013\tbb\bin\..\include\.F90
  /list      filename : tgmet2015_171013.lst
  /object    filename : none

Page 102         Source Listing                  WORKERS
2017-10-16 10:05                                 tgmet2015_171013.for

  /nobrowser
  /Fd        filename : none

COMPILER: Intel(R) Fortran 13.1-2161
